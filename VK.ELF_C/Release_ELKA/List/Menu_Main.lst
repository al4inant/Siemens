##############################################################################
#                                                                            #
# IAR ARM ANSI C/C++ Compiler V4.42A/W32 EVALUATION    16/Feb/2023  22:41:12 #
# Copyright 1999-2005 IAR Systems. All rights reserved.                      #
#                                                                            #
#    Cpu mode        =  interwork                                            #
#    Endian          =  little                                               #
#    Stack alignment =  4                                                    #
#    Source file     =  D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C #
#                       \Menu_Main.c                                         #
#    Command line    =  D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C #
#                       \Menu_Main.c -D NEWSGOLD -D ELKA -D DEBUG -lCN       #
#                       D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C #
#                       \Release_ELKA\List\ -la D:\Users\alfinant\Documents\ #
#                       Siemens\Dev\IAR\VK.ELF_C\Release_ELKA\List\ -o       #
#                       D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C #
#                       \Release_ELKA\Obj\ -z9 --cpu_mode arm --endian       #
#                       little --cpu ARM926EJ-S --stack_align 4 --interwork  #
#                       --diag_suppress Pe301 -e --fpu None --dlib_config    #
#                       D:\Users\alfinant\Documents\Siemens\IAR\ARM\LIB\dl5t #
#                       painl8n.h -I D:\Users\alfinant\Documents\Siemens\IAR #
#                       \ARM\INC\ --inline_threshold=2                       #
#    List file       =  D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C #
#                       \Release_ELKA\List\Menu_Main.lst                     #
#    Object file     =  D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C #
#                       \Release_ELKA\Obj\Menu_Main.r79                      #
#                                                                            #
#                                                                            #
##############################################################################

D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C\Menu_Main.c
      1          #include <siemens\swilib.h>
      2          #include "rect_patcher.h"

   \                                 In segment CODE, align 4, keep-with-next
   \   __??Code32?? __code __interwork __atpcs void patch_header(HEADER_DESC const *)
   \                     patch_header:
   \   00000000   10402DE9           PUSH     {R4,LR}
   \   00000004   0040A0E1           MOV      R4,R0
   \   00000008   0000A0E3           MOV      R0,#+0
   \   0000000C   B000C4E1           STRH     R0,[R4, #+0]
   \   00000010   1800A0E3           MOV      R0,#+24
   \   00000014   B200C4E1           STRH     R0,[R4, #+2]
   \   00000018   888100EF           SWI      +33160
   \   0000001C   010040E2           SUB      R0,R0,#+1
   \   00000020   B400C4E1           STRH     R0,[R4, #+4]
   \   00000024   8A8100EF           SWI      +33162
   \   00000028   170080E2           ADD      R0,R0,#+23
   \   0000002C   B600C4E1           STRH     R0,[R4, #+6]
   \   00000030   1080BDE8           POP      {R4,PC}          ;; return
      3          #include "dyn_images.h"
      4          #include "dyn_theme.h"
      5          #include "process.h"
      6          #include "http.h"
      7          #include "vk_api.h"
      8          #include "main.h"
      9          

   \                                 In segment DATA_C, align 4, align-sorted
     10          static const char percent_t[]="%t";
   \                     percent_t:
   \   00000000   257400             DC8 "%t"
   \   00000003   00                 DC8 0
   \   00000004   D1EEEEE1F9E5       DC8 "\321\356\356\341\371\345\355\350\377"
   \              EDE8FF00    
   \   0000000E   0000               DC8 0, 0
   \   00000010   C4F0F3E7FCFF       DC8 "\304\360\363\347\374\377"
   \              00          
   \   00000017   00                 DC8 0
   \   00000018   C3F0F3EFEFFB       DC8 "\303\360\363\357\357\373"
   \              00          
   \   0000001F   00                 DC8 0
   \   00000020   CEE120FDEBFC       DC8 "\316\341 \375\353\374\364\345"
   \              F4E500      
   \   00000029   000000             DC8 0, 0, 0
   \   0000002C   C2FBE9F2E800       DC8 "\302\373\351\362\350"
   \   00000032   0000               DC8 0, 0
   \   00000034   C2EAEEEDF2E0       DC8 "\302\352\356\355\362\340\352\362\345"
   \              EAF2E500    
   \   0000003E   0000               DC8 0, 0
     11          static const char HEADER_TEXT[]="Вконтакте";
     12          
     13          extern int CreateDebugGUI();
     14          

   \                                 In segment DATA_I, align 4, align-sorted
     15          static HEADER_DESC hdr={0,0,0,0,NULL,NULL,LGP_NULL};
   \                     hdr:
   \   00000000                      DS8 20
   \   00000014                      REQUIRE `?<Initializer for hdr>`

   \                                 In segment DATA_Z, align 4, align-sorted
     16          static WSHDR* hdr_ws=NULL;
   \                     hdr_ws:
   \   00000000                      DS8 4
     17          

   \                                 In segment DATA_C, align 4, align-sorted
     18          static const int menusoftkeys[]={0,1,2};
   \                     menusoftkeys:
   \   00000000   000000000100       DC32 0, 1, 2
   \              000002000000
     19          

   \                                 In segment DATA_I, align 4, align-sorted
     20          static SOFTKEY_DESC sk[]=
   \                     sk:
   \   00000000                      DS8 24
   \   00000018                      REQUIRE `?<Initializer for sk>`
     21          {
     22            {0x0018,0x0000,(int)"Опции"},
     23            {0x0001,0x0000, (int)"Назад"},
     24            {0x003D,0x0000,(int)LGP_DOIT_PIC}
     25          };
     26          

   \                                 In segment DATA_I, align 4, align-sorted
     27          static SOFTKEYSTAB skt=
   \                     skt:
   \   00000000                      DS8 8
   \   00000008                      REQUIRE `?<Initializer for skt>`
     28          {
     29            sk,0
     30          };
     31          
     32          extern void CreateDialogsMenu();
     33          extern int CreateGroupsMenu();
     34          extern void OpenAboutMenu();
     35          extern void Logout();
     36          

   \                                 In segment CODE, align 4, keep-with-next
     37          static int items_menu_onkey(void *gui, GUI_MSG *msg)
     38          { 
   \                     items_menu_onkey:
   \   00000000   10402DE9           PUSH     {R4,LR}
   \   00000004   0140A0E1           MOV      R4,R1
     39            int i=GetCurMenuItem(gui);
   \   00000008   8F0100EF           SWI      +399
     40            
     41            if ((msg->gbsmsg->msg==KEY_DOWN)||(msg->gbsmsg->msg==LONG_PRESS))
   \   0000000C   041094E5           LDR      R1,[R4, #+4]
   \   00000010   9330A0E3           MOV      R3,#+147
   \   00000014   042091E5           LDR      R2,[R1, #+4]
   \   00000018   403F83E3           ORR      R3,R3,#0x100
   \   0000001C   030052E1           CMP      R2,R3
   \   00000020   02308312           ADDNE    R3,R3,#+2
   \   00000024   03005211           CMPNE    R2,R3
   \   00000028   1A00001A           BNE      ??items_menu_onkey_0
     42            { 
     43              switch(msg->gbsmsg->submess)
   \   0000002C   081091E5           LDR      R1,[R1, #+8]
   \   00000030   041051E2           SUBS     R1,R1,#+4
   \   00000034   0400000A           BEQ      ??items_menu_onkey_1
   \   00000038   071051E2           SUBS     R1,R1,#+7
   \   0000003C   0400000A           BEQ      ??items_menu_onkey_2
   \   00000040   0F1051E2           SUBS     R1,R1,#+15
   \   00000044   0400000A           BEQ      ??items_menu_onkey_3
   \   00000048   120000EA           B        ??items_menu_onkey_0
     44              {
     45              case RIGHT_SOFT:
     46                return(1);
   \                     ??items_menu_onkey_1:
   \   0000004C   0100A0E3           MOV      R0,#+1
   \   00000050   1080BDE8           POP      {R4,PC}
     47                
     48              case GREEN_BUTTON:
     49                CreateDebugGUI();
   \                     ??items_menu_onkey_2:
   \   00000054   ........           _BLF     CreateDebugGUI,??CreateDebugGUI??rA
   \   00000058   0E0000EA           B        ??items_menu_onkey_0
     50                break;
     51                
     52              case ENTER_BUTTON:
     53                if (i==0)
   \                     ??items_menu_onkey_3:
   \   0000005C   000050E3           CMP      R0,#+0
   \   00000060   0100001A           BNE      ??items_menu_onkey_4
     54                  CreateDialogsMenu();
   \   00000064   ........           _BLF     CreateDialogsMenu,??CreateDialogsMenu??rA
   \   00000068   0A0000EA           B        ??items_menu_onkey_0
     55              /*  else
     56                  if (i==1)
     57                    CreateFriendsMenu(); */
     58                else
     59                  if (i==2)
   \                     ??items_menu_onkey_4:
   \   0000006C   020050E3           CMP      R0,#+2
   \   00000070   0100001A           BNE      ??items_menu_onkey_5
     60                    CreateGroupsMenu();
   \   00000074   ........           _BLF     CreateGroupsMenu,??CreateGroupsMenu??rA
   \   00000078   060000EA           B        ??items_menu_onkey_0
     61                  else
     62                    if (i==3)
   \                     ??items_menu_onkey_5:
   \   0000007C   030050E3           CMP      R0,#+3
   \   00000080   0100001A           BNE      ??items_menu_onkey_6
     63                      OpenAboutMenu();
   \   00000084   ........           _BLF     OpenAboutMenu,??OpenAboutMenu??rA
   \   00000088   020000EA           B        ??items_menu_onkey_0
     64                else
     65                  if (i == 4)
   \                     ??items_menu_onkey_6:
   \   0000008C   040050E3           CMP      R0,#+4
   \   00000090   0000001A           BNE      ??items_menu_onkey_0
     66                    Logout();
   \   00000094   ........           _BLF     Logout,??Logout??rA
     67                  break;
     68              }
     69            }
     70            return (0); 
   \                     ??items_menu_onkey_0:
   \   00000098   0000A0E3           MOV      R0,#+0
   \   0000009C   1080BDE8           POP      {R4,PC}          ;; return
     71          }
     72          

   \                                 In segment CODE, align 4, keep-with-next
     73          static void items_menu_ghook(void *gui, int cmd)
     74          {
   \                     items_menu_ghook:
   \   00000000   70402DE9           PUSH     {R4-R6,LR}
     75            if (cmd==TI_CMD_CREATE)
   \   00000004   020051E3           CMP      R1,#+2
   \   00000008   1100001A           BNE      ??items_menu_ghook_0
     76            { 
     77              void* hdr_pointer=GetHeaderPointer(gui);
     78              hdr_ws=AllocWS(128);
   \   0000000C   80509FE5           LDR      R5,??items_menu_ghook_1  ;; hdr_ws
   \   00000010   AE0200EF           SWI      +686
   \   00000014   0040A0E1           MOV      R4,R0
   \   00000018   8000A0E3           MOV      R0,#+128
   \   0000001C   250100EF           SWI      +293
     79              wsprintf(hdr_ws, percent_t, HEADER_TEXT);
   \   00000020   ........           LDR      R1,??DataTable1  ;; percent_t
   \   00000024   000085E5           STR      R0,[R5, #+0]
   \   00000028   342081E2           ADD      R2,R1,#+52
   \   0000002C   240100EF           SWI      +292
     80              SetHeaderText(hdr_pointer, hdr_ws, malloc_adr(), mfree_adr());    
   \   00000030   158000EF           SWI      +32789
   \   00000034   0060A0E1           MOV      R6,R0
   \   00000038   148000EF           SWI      +32788
   \   0000003C   001095E5           LDR      R1,[R5, #+0]
   \   00000040   0020A0E1           MOV      R2,R0
   \   00000044   0630A0E1           MOV      R3,R6
   \   00000048   0400A0E1           MOV      R0,R4
   \   0000004C   AF0200EF           SWI      +687
   \   00000050   7080BDE8           POP      {R4-R6,PC}
     81            }
     82               
     83            if (cmd==TI_CMD_UNFOCUS)
   \                     ??items_menu_ghook_0:
   \   00000054   090051E3           CMP      R1,#+9
   \   00000058   0B00000A           BEQ      ??items_menu_ghook_2
     84            {
     85              //DisableDynImages();
     86              DisableDynTheme();
     87            }
     88            
     89            if (cmd==TI_CMD_FOCUS)
   \                     ??items_menu_ghook_3:
   \   0000005C   0A0051E3           CMP      R1,#+10
   \   00000060   0300001A           BNE      ??items_menu_ghook_4
     90            {
     91              EnableDynImages();
   \   00000064   ........           _BLF     EnableDynImages,??EnableDynImages??rA
     92              EnableDynTheme();  
   \   00000068   ........           _BLF     EnableDynTheme,??EnableDynTheme??rA
     93              DisableIDLETMR();
   \   0000006C   7F0100EF           SWI      +383
   \   00000070   7080BDE8           POP      {R4-R6,PC}
     94            }  
     95            
     96            if (cmd==TI_CMD_REDRAW)
   \                     ??items_menu_ghook_4:
   \   00000074   070051E3           CMP      R1,#+7
   \   00000078   0100001A           BNE      ??items_menu_ghook_5
     97            {
     98              EnableDynImages();
   \   0000007C   ........           _BLF     EnableDynImages,??EnableDynImages??rA
   \   00000080   7080BDE8           POP      {R4-R6,PC}
     99            }
    100            
    101            if (cmd==TI_CMD_DESTROY)
   \                     ??items_menu_ghook_5:
   \   00000084   030051E3           CMP      R1,#+3
   \   00000088   7080BD18           POPNE    {R4-R6,PC}
    102            {
    103              DisableDynTheme();
   \                     ??items_menu_ghook_2:
   \   0000008C   ........           _BLF     DisableDynTheme,??DisableDynTheme??rA
    104              //DisableDynImages();
    105            }
    106          }
   \   00000090   7080BDE8           POP      {R4-R6,PC}       ;; return
   \                     ??items_menu_ghook_1:
   \   00000094   ........           DC32     hdr_ws
    107          

   \                                 In segment CODE, align 4, keep-with-next
    108          static void items_menu_iconhndl(void *gui, int curitem, void *user_pointer)
    109          {
   \                     items_menu_iconhndl:
   \   00000000   F0402DE9           PUSH     {R4-R7,LR}
   \   00000004   0040A0E1           MOV      R4,R0
   \   00000008   0150A0E1           MOV      R5,R1
    110            WSHDR* ws=AllocMenuWS(gui,64);
   \   0000000C   4010A0E3           MOV      R1,#+64
   \   00000010   980100EF           SWI      +408
   \   00000014   0060A0E1           MOV      R6,R0
    111            void* item=AllocMenuItem(gui);
   \   00000018   0400A0E1           MOV      R0,R4
   \   0000001C   970100EF           SWI      +407
    112            
    113            switch(curitem)
   \   00000020   ........           LDR      R1,??DataTable1  ;; percent_t
   \   00000024   0070A0E1           MOV      R7,R0
   \   00000028   0500A0E1           MOV      R0,R5
   \   0000002C   040050E3           CMP      R0,#+4
   \   00000030   0F00008A           BHI      ??items_menu_iconhndl_1
   \   00000034   012F8FE2           ADR      R2,??items_menu_iconhndl_0
   \   00000038   0020D2E7           LDRB     R2,[R2, R0]
   \   0000003C   02F18FE0           ADD      PC,PC,R2, LSL #+2
   \                     ??items_menu_iconhndl_0:
   \   00000040   01030507           DC8      +1,+3,+5,+7
   \   00000044   09000000           DC8      +9,+0,+0,+0
    114            {
    115            case 0:
    116              wsprintf(ws, percent_t, "Сообщения");
   \                     ??items_menu_iconhndl_2:
   \   00000048   042081E2           ADD      R2,R1,#+4
   \   0000004C   060000EA           B        ??items_menu_iconhndl_3
    117              break;
    118            case 1:
    119              wsprintf(ws, percent_t, "Друзья");    
   \                     ??items_menu_iconhndl_4:
   \   00000050   102081E2           ADD      R2,R1,#+16
   \   00000054   040000EA           B        ??items_menu_iconhndl_3
    120              break;
    121            case 2:
    122              wsprintf(ws, percent_t, "Группы");    
   \                     ??items_menu_iconhndl_5:
   \   00000058   182081E2           ADD      R2,R1,#+24
   \   0000005C   020000EA           B        ??items_menu_iconhndl_3
    123              break;    
    124            case 3:
    125              wsprintf(ws, percent_t, "Об эльфе");
   \                     ??items_menu_iconhndl_6:
   \   00000060   202081E2           ADD      R2,R1,#+32
   \   00000064   000000EA           B        ??items_menu_iconhndl_3
    126              break;
    127            case 4:
    128              wsprintf(ws, percent_t, "Выйти");
   \                     ??items_menu_iconhndl_7:
   \   00000068   2C2081E2           ADD      R2,R1,#+44
   \                     ??items_menu_iconhndl_3:
   \   0000006C   0600A0E1           MOV      R0,R6
   \   00000070   240100EF           SWI      +292
    129              break;    
    130            }
    131          
    132            //SetMenuItemIconArray(gui, item, &i1_pic); //первым рисуется картинка из SetMenuItemIconArray
    133            SetMenuItemText(gui, item, ws, curitem);
   \                     ??items_menu_iconhndl_1:
   \   00000074   0530A0E1           MOV      R3,R5
   \   00000078   0620A0E1           MOV      R2,R6
   \   0000007C   0710A0E1           MOV      R1,R7
   \   00000080   0400A0E1           MOV      R0,R4
   \   00000084   9A0100EF           SWI      +410
    134          
    135          }
   \   00000088   F080BDE8           POP      {R4-R7,PC}       ;; return
    136          

   \                                 In segment DATA_C, align 4, align-sorted
    137          static const MENU_DESC items_menu_desc=
   \                     items_menu_desc:
   \   00000000   08000000....       DC32 8, items_menu_onkey, items_menu_ghook, 0H, menusoftkeys, skt, 17
   \              ............
   \              00000000....
   \              ............
   \              11000000    
   \   0000001C   ........0000       DC32 items_menu_iconhndl, 0H, 0H, 0
   \              000000000000
   \              00000000    
    138          {
    139            8,
    140            items_menu_onkey,
    141            items_menu_ghook,
    142            NULL,
    143            menusoftkeys,
    144            &skt,
    145            0x11,
    146            items_menu_iconhndl,
    147            NULL,   //Items
    148            NULL,   //Procs
    149            0   //n
    150          };
    151          
    152          //******************************************************************************
    153          

   \                                 In segment CODE, align 4, keep-with-next
    154          int CreateMainMenu()
    155          {
   \                     CreateMainMenu:
   \   00000000   70402DE9           PUSH     {R4-R6,LR}
    156            void *ma=malloc_adr(); 
    157            void *mf=mfree_adr();
    158            void *gui=GetMenuGUI(ma, mf); 
    159            SetMenuToGUI(gui,&items_menu_desc); 
    160            SetMenuItemCount(gui, 5);
    161            patch_header(&hdr);
   \   00000004   50609FE5           LDR      R6,??CreateMainMenu_0  ;; hdr
   \   00000008   148000EF           SWI      +32788
   \   0000000C   0040A0E1           MOV      R4,R0
   \   00000010   158000EF           SWI      +32789
   \   00000014   0010A0E1           MOV      R1,R0
   \   00000018   0400A0E1           MOV      R0,R4
   \   0000001C   A40200EF           SWI      +676
   \   00000020   38109FE5           LDR      R1,??CreateMainMenu_0+0x4  ;; items_menu_desc
   \   00000024   0050A0E1           MOV      R5,R0
   \   00000028   A70200EF           SWI      +679
   \   0000002C   0510A0E3           MOV      R1,#+5
   \   00000030   0500A0E1           MOV      R0,R5
   \   00000034   C30100EF           SWI      +451
   \   00000038   0600A0E1           MOV      R0,R6
   \   0000003C   ........           _BLF     patch_header,??patch_header??rA
    162            SetHeaderToMenu(gui,&hdr,ma); 
   \   00000040   0420A0E1           MOV      R2,R4
   \   00000044   0610A0E1           MOV      R1,R6
   \   00000048   0500A0E1           MOV      R0,R5
   \   0000004C   A60200EF           SWI      +678
    163            return CreateGUI(gui);
   \   00000050   0500A0E1           MOV      R0,R5
   \   00000054   370100EF           SWI      +311
   \   00000058   7080BDE8           POP      {R4-R6,PC}       ;; return
   \                     ??CreateMainMenu_0:
   \   0000005C   ........           DC32     hdr
   \   00000060   ........           DC32     items_menu_desc
    164          }

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable1:
   \   00000000   ........           DC32     percent_t

   \                                 In segment DATA_ID, align 4, align-sorted
   \                     `?<Initializer for hdr>`:
   \   00000000   000000000000       DC16 0, 0, 0, 0
   \              0000        
   \   00000008   000000000000       DC32 0H, 0, 2147483647
   \              0000FFFFFF7F

   \                                 In segment DATA_ID, align 4, align-sorted
   \                     `?<Initializer for sk>`:
   \   00000000   18000000           DC16 24, 0
   \   00000004   ........           DC32 `?<Constant "\\316\\357\\366\\350\\350">`
   \   00000008   01000000           DC16 1, 0
   \   0000000C   ........           DC32 `?<Constant "\\315\\340\\347\\340\\344">`
   \   00000010   3D000000           DC16 61, 0
   \   00000014   FBC0FF7F           DC32 2147467515

   \                                 In segment DATA_ID, align 4, align-sorted
   \                     `?<Initializer for skt>`:
   \   00000000   ........0000       DC32 sk, 0
   \              0000        

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant "\\316\\357\\366\\350\\350">`:
   \   00000000   CEEFF6E8E800       DC8 "\316\357\366\350\350"
   \   00000006   0000               DC8 0, 0

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant "\\315\\340\\347\\340\\344">`:
   \   00000000   CDE0E7E0E400       DC8 "\315\340\347\340\344"
   \   00000006   0000               DC8 0, 0
    165          
    166          

   Maximum stack usage in bytes:

     Function            CSTACK
     --------            ------
     CreateMainMenu         16
     items_menu_ghook       16
     items_menu_iconhndl    20
     items_menu_onkey        8
     patch_header            8


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     patch_header                     52
     percent_t                        64
     hdr                              20
     hdr_ws                            4
     menusoftkeys                     12
     sk                               24
     skt                               8
     items_menu_onkey                160
     items_menu_ghook                152
     items_menu_iconhndl             140
     items_menu_desc                  44
     CreateMainMenu                  100
     ??DataTable1                      4
     ?<Initializer for hdr>           20
     ?<Initializer for sk>            24
     ?<Initializer for skt>            8
     ?<Constant "\316\357\366\350\350">
                                       8
     ?<Constant "\315\340\347\340\344">
                                       8
      Others                         148

 
 732 bytes in segment CODE
 136 bytes in segment DATA_C
  52 bytes in segment DATA_I
  52 bytes in segment DATA_ID
   4 bytes in segment DATA_Z
  24 bytes in segment INITTAB
 
 556 bytes of CODE  memory (+ 200 bytes shared)
 188 bytes of CONST memory
  56 bytes of DATA  memory

Errors: none
Warnings: none

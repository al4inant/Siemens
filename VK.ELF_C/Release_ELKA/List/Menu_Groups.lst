##############################################################################
#                                                                            #
# IAR ARM ANSI C/C++ Compiler V4.42A/W32 EVALUATION    16/Feb/2023  22:41:12 #
# Copyright 1999-2005 IAR Systems. All rights reserved.                      #
#                                                                            #
#    Cpu mode        =  interwork                                            #
#    Endian          =  little                                               #
#    Stack alignment =  4                                                    #
#    Source file     =  D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C #
#                       \Menu_Groups.c                                       #
#    Command line    =  D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C #
#                       \Menu_Groups.c -D NEWSGOLD -D ELKA -D DEBUG -lCN     #
#                       D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C #
#                       \Release_ELKA\List\ -la D:\Users\alfinant\Documents\ #
#                       Siemens\Dev\IAR\VK.ELF_C\Release_ELKA\List\ -o       #
#                       D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C #
#                       \Release_ELKA\Obj\ -z9 --cpu_mode arm --endian       #
#                       little --cpu ARM926EJ-S --stack_align 4 --interwork  #
#                       --diag_suppress Pe301 -e --fpu None --dlib_config    #
#                       D:\Users\alfinant\Documents\Siemens\IAR\ARM\LIB\dl5t #
#                       painl8n.h -I D:\Users\alfinant\Documents\Siemens\IAR #
#                       \ARM\INC\ --inline_threshold=2                       #
#    List file       =  D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C #
#                       \Release_ELKA\List\Menu_Groups.lst                   #
#    Object file     =  D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C #
#                       \Release_ELKA\Obj\Menu_Groups.r79                    #
#                                                                            #
#                                                                            #
##############################################################################

D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C\Menu_Groups.c
      1          #include <siemens\swilib.h>
      2          #include "rect_patcher.h"

   \                                 In segment CODE, align 4, keep-with-next
   \   __??Code32?? __code __interwork __atpcs void patch_header(HEADER_DESC const *)
   \                     patch_header:
   \   00000000   10402DE9           PUSH     {R4,LR}
   \   00000004   0040A0E1           MOV      R4,R0
   \   00000008   0000A0E3           MOV      R0,#+0
   \   0000000C   B000C4E1           STRH     R0,[R4, #+0]
   \   00000010   1800A0E3           MOV      R0,#+24
   \   00000014   B200C4E1           STRH     R0,[R4, #+2]
   \   00000018   888100EF           SWI      +33160
   \   0000001C   010040E2           SUB      R0,R0,#+1
   \   00000020   B400C4E1           STRH     R0,[R4, #+4]
   \   00000024   8A8100EF           SWI      +33162
   \   00000028   170080E2           ADD      R0,R0,#+23
   \   0000002C   B600C4E1           STRH     R0,[R4, #+6]
   \   00000030   1080BDE8           POP      {R4,PC}          ;; return
      3          #include "dyn_images.h"
      4          #include "dyn_theme.h"
      5          #include "socket_work.h"
      6          #include "http.h"
      7          #include "process.h"
      8          #include "vk_api.h"
      9          #include "main.h"
     10          //#include "chat.h"
     11          #include "anim_widget.h"
     12          
     13          static int gui_id = 0;
     14          static int timer_id;
     15          

   \                                 In segment DATA_C, align 4, align-sorted
     16          static const char percent_t[]="%t";
   \                     percent_t:
   \   00000000   257400             DC8 "%t"
   \   00000003   00                 DC8 0
   \   00000004   C3F0F3EFEFFB       DC8 "\303\360\363\357\357\373"
   \              00          
   \   0000000B   00                 DC8 0
   \   0000000C   25642F256400       DC8 "%d/%d"
   \   00000012   0000               DC8 0, 0

   \                                 In segment DATA_C, align 1, align-sorted
     17          static const char percent_d[]="%d";
   \                     percent_d:
   \   00000000   256400             DC8 "%d"

   \                                 In segment DATA_I, align 4, align-sorted
     18          
     19          extern int CreateDebugGUI();
     20          extern void LoadSavedGroups();
     21          
     22          #ifdef ELKA
     23          static int hdr_icon=0x599;
     24          #else
     25          static int hdr_icon=0x5C5;
     26          #endif
     27          
     28          static HEADER_DESC hdr={0,0,0,0,NULL,NULL,LGP_NULL};
   \                     hdr:
   \   00000000                      DS8 20
   \   00000014                      REQUIRE `?<Initializer for hdr>`
   \   00000014                      DS8 4
   \   00000018                      REQUIRE `?<Initializer for gui_id>`
   \   00000018                      DS8 4
   \   0000001C                      REQUIRE `?<Initializer for timer_id>`
   \   0000001C                      DS8 4
   \   00000020                      REQUIRE `?<Initializer for ws_hdr>`
   \   00000020                      DS8 4
   \   00000024                      REQUIRE `?<Initializer for groups_count>`
   \   00000024                      DS8 4
   \   00000028                      REQUIRE `?<Initializer for cursor_pos>`
   \   00000028                      DS8 4
   \   0000002C                      REQUIRE `?<Initializer for loaded_count>`
   \   0000002C                      DS8 4
   \   00000030                      REQUIRE `?<Initializer for hdr_icon>`
     29          static WSHDR *ws_hdr = NULL;
     30          static int groups_count = 0;
     31          static int cursor_pos = 0;
     32          static int loaded_count = 0;
     33          

   \                                 In segment DATA_C, align 4, align-sorted
     34          static const int menusoftkeys[]={0,1,2};
   \                     menusoftkeys:
   \   00000000   000000000100       DC32 0, 1, 2
   \              000002000000
     35          

   \                                 In segment DATA_I, align 4, align-sorted
     36          static SOFTKEY_DESC sk[]=
   \                     sk:
   \   00000000                      DS8 24
   \   00000018                      REQUIRE `?<Initializer for sk>`
     37          {
     38            {0x0018,0x0000,(int)"обновить"},
     39            {0x0001,0x0000, (int)"Назад"},
     40            {0x003D,0x0000,(int)LGP_DOIT_PIC}
     41          };
     42          

   \                                 In segment DATA_I, align 4, align-sorted
     43          static SOFTKEYSTAB skt=
   \                     skt:
   \   00000000                      DS8 8
   \   00000008                      REQUIRE `?<Initializer for skt>`
     44          {
     45            sk,0
     46          };
     47          
     48          //extern int CreateWall(VkGroup *group);
     49          

   \                                 In segment CODE, align 4, keep-with-next
     50          static void UpdateHeader()
     51          {
   \                     UpdateHeader:
   \   00000000   30402DE9           PUSH     {R4,R5,LR}
     52            ws_hdr->wsbody[0] = 0; 
   \   00000004   ........           LDR      R4,??DataTable8  ;; hdr
     53            wsAppendChar(ws_hdr, UTF16_ENA_CENTER);
     54            wsprintf(ws_hdr, percent_t, "Группы");
   \   00000008   50509FE5           LDR      R5,??UpdateHeader_0  ;; percent_t
   \   0000000C   1C0094E5           LDR      R0,[R4, #+28]
   \   00000010   0020A0E3           MOV      R2,#+0
   \   00000014   001090E5           LDR      R1,[R0, #+0]
   \   00000018   B020C1E1           STRH     R2,[R1, #+0]
   \   0000001C   1E10A0E3           MOV      R1,#+30
   \   00000020   E01C81E3           ORR      R1,R1,#0xE000
   \   00000024   1C0000EF           SWI      +28
   \   00000028   1C0094E5           LDR      R0,[R4, #+28]
   \   0000002C   042085E2           ADD      R2,R5,#+4
   \   00000030   0510A0E1           MOV      R1,R5
   \   00000034   240100EF           SWI      +292
     55            wsAppendChar(ws_hdr, UTF16_ALIGN_RIGHT);
   \   00000038   1C0094E5           LDR      R0,[R4, #+28]
   \   0000003C   1D10A0E3           MOV      R1,#+29
   \   00000040   E01C81E3           ORR      R1,R1,#0xE000
   \   00000044   1C0000EF           SWI      +28
     56            wstrcatprintf(ws_hdr, "%d/%d", cursor_pos, groups_count);
   \   00000048   203094E5           LDR      R3,[R4, #+32]
   \   0000004C   242094E5           LDR      R2,[R4, #+36]
   \   00000050   1C0094E5           LDR      R0,[R4, #+28]
   \   00000054   0C1085E2           ADD      R1,R5,#+12
   \   00000058   160200EF           SWI      +534
     57          }
   \   0000005C   3080BDE8           POP      {R4,R5,PC}       ;; return
   \                     ??UpdateHeader_0:
   \   00000060   ........           DC32     percent_t
     58          

   \                                 In segment CODE, align 4, keep-with-next
     59          void set_GroupsCount(int count)
     60          {
     61            groups_count = count;
   \                     set_GroupsCount:
   \   00000000   ........           LDR      R1,??DataTable2  ;; hdr + 32
   \   00000004   000081E5           STR      R0,[R1, #+0]
     62          }
   \   00000008   1EFF2FE1           BX       LR               ;; return
     63          

   \                                 In segment CODE, align 4, keep-with-next
     64          int get_GroupsCount()
     65          {
     66            return groups_count;
   \                     get_GroupsCount:
   \   00000000   ........           LDR      R0,??DataTable2  ;; hdr + 32
   \   00000004   000090E5           LDR      R0,[R0, #+0]
   \   00000008   1EFF2FE1           BX       LR               ;; return
     67          }
     68          

   \                                 In segment CODE, align 4, keep-with-next
     69          static int items_menu_onkey(void *gui, GUI_MSG *msg)
     70          { 
   \                     items_menu_onkey:
   \   00000000   00402DE9           PUSH     {LR}
     71            int i;
     72            VkGroup *group;
     73            struct list_head *pos;
     74            
     75            if ((msg->gbsmsg->msg==KEY_DOWN)||(msg->gbsmsg->msg==LONG_PRESS))
   \   00000004   041091E5           LDR      R1,[R1, #+4]
   \   00000008   9330A0E3           MOV      R3,#+147
   \   0000000C   042091E5           LDR      R2,[R1, #+4]
   \   00000010   403F83E3           ORR      R3,R3,#0x100
   \   00000014   030052E1           CMP      R2,R3
   \   00000018   02308312           ADDNE    R3,R3,#+2
   \   0000001C   03005211           CMPNE    R2,R3
   \   00000020   0C00001A           BNE      ??items_menu_onkey_0
     76            {
     77              switch(msg->gbsmsg->submess)
   \   00000024   081091E5           LDR      R1,[R1, #+8]
   \   00000028   011051E2           SUBS     R1,R1,#+1
   \   0000002C   0D00000A           BEQ      ??items_menu_onkey_1
   \   00000030   031051E2           SUBS     R1,R1,#+3
   \   00000034   2000000A           BEQ      ??items_menu_onkey_2
   \   00000038   071051E2           SUBS     R1,R1,#+7
   \   0000003C   0700000A           BEQ      ??items_menu_onkey_3
   \   00000040   0F1051E2           SUBS     R1,R1,#+15
   \   00000044   0300001A           BNE      ??items_menu_onkey_0
     78              {
     79              case UP_BUTTON:
     80                break;
     81                
     82              case ENTER_BUTTON:
     83                i=GetCurMenuItem(gui);
   \   00000048   8F0100EF           SWI      +399
     84                pos = get_ListByIndex(&my_groups, i);
   \   0000004C   0010A0E1           MOV      R1,R0
   \   00000050   ........           LDR      R0,??DataTable11  ;; my_groups
   \   00000054   ........           _BLF     get_ListByIndex,??get_ListByIndex??rA
     85                group = list_entry(pos, VkGroup, list);
     86          //      CreateWall(group);
     87                break;
     88              
     89              case GREEN_BUTTON:
     90          #ifdef DEBUG
     91                CreateDebugGUI();
     92          #endif
     93                break;
     94              
     95              case LEFT_SOFT:
     96                if (IsGPRSEnabled())
     97                {
     98                  if (INET_PROCESS==0)
     99                  {
    100                    //INET_PROCESS=TEST_SSL_CON;
    101                    //SUBPROC((void *)HttpSendReq, "https://team-sc.ru", 1);
    102                    INET_PROCESS=LOAD_GROUPS;
    103                    int offset= groups_count-loaded_count;
    104                    SUBPROC((void *)HttpSendReq, url_groups_get(offset, 100), 1);
    105                    AnimWidget_Wait_headline();
    106                    //AnimWidget_Wait_center();
    107                  }
    108                }      
    109                break;
    110                
    111              case RIGHT_SOFT:
    112                return(1);//close
    113              }
    114            }
    115            return (0); 
   \                     ??items_menu_onkey_0:
   \   00000058   0000A0E3           MOV      R0,#+0
   \   0000005C   0080BDE8           POP      {PC}             ;; return
   \                     ??items_menu_onkey_3:
   \   00000060   ........           _BLF     CreateDebugGUI,??CreateDebugGUI??rA
   \   00000064   FBFFFFEA           B        ??items_menu_onkey_0
   \                     ??items_menu_onkey_1:
   \   00000068   A70000EF           SWI      +167
   \   0000006C   000050E3           CMP      R0,#+0
   \   00000070   0080BD08           POPEQ    {PC}
   \   00000074   48009FE5           LDR      R0,??items_menu_onkey_4  ;; INET_PROCESS
   \   00000078   001090E5           LDR      R1,[R0, #+0]
   \   0000007C   000051E3           CMP      R1,#+0
   \   00000080   F4FFFF1A           BNE      ??items_menu_onkey_0
   \   00000084   1510A0E3           MOV      R1,#+21
   \   00000088   001080E5           STR      R1,[R0, #+0]
   \   0000008C   ........           LDR      R0,??DataTable8  ;; hdr
   \   00000090   6410A0E3           MOV      R1,#+100
   \   00000094   202090E5           LDR      R2,[R0, #+32]
   \   00000098   280090E5           LDR      R0,[R0, #+40]
   \   0000009C   000042E0           SUB      R0,R2,R0
   \   000000A0   ........           _BLF     url_groups_get,??url_groups_get??rA
   \   000000A4   0120A0E3           MOV      R2,#+1
   \   000000A8   0010A0E1           MOV      R1,R0
   \   000000AC   14009FE5           LDR      R0,??items_menu_onkey_4+0x4  ;; HttpSendReq
   \   000000B0   710100EF           SWI      +369
   \   000000B4   ........           _BLF     AnimWidget_Wait_headline,??AnimWidget_Wait_headline??rA
   \   000000B8   E6FFFFEA           B        ??items_menu_onkey_0
   \                     ??items_menu_onkey_2:
   \   000000BC   0100A0E3           MOV      R0,#+1
   \   000000C0   0080BDE8           POP      {PC}
   \                     ??items_menu_onkey_4:
   \   000000C4   ........           DC32     INET_PROCESS
   \   000000C8   ........           DC32     HttpSendReq
    116          }
    117          

   \                                 In segment CODE, align 4, keep-with-next
    118          static void items_menu_ghook(void *gui, int cmd)
    119          {
   \                     items_menu_ghook:
   \   00000000   F0402DE9           PUSH     {R4-R7,LR}
    120            if (cmd==TI_CMD_CREATE)
   \   00000004   ........           LDR      R4,??DataTable10  ;; hdr
   \   00000008   0050A0E1           MOV      R5,R0
   \   0000000C   020051E3           CMP      R1,#+2
   \   00000010   1D00001A           BNE      ??items_menu_ghook_0
    121            { 
    122              timer_id = GUI_NewTimer(gui);
   \   00000014   A70300EF           SWI      +935
   \   00000018   180084E5           STR      R0,[R4, #+24]
    123              hdr.icon = &hdr_icon;
   \   0000001C   2C0084E2           ADD      R0,R4,#+44
   \   00000020   080084E5           STR      R0,[R4, #+8]
    124              void *hdr_pointer=  GetHeaderPointer(gui);
   \   00000024   0500A0E1           MOV      R0,R5
   \   00000028   AE0200EF           SWI      +686
   \   0000002C   0060A0E1           MOV      R6,R0
    125              ws_hdr=AllocWS(64);
   \   00000030   4000A0E3           MOV      R0,#+64
   \   00000034   250100EF           SWI      +293
   \   00000038   1C0084E5           STR      R0,[R4, #+28]
    126              //wsprintf(hdr_ws, percent_t, HEADER_TEXT);
    127              //SetHeaderText(hdr_pointer, hdr_ws, malloc_adr(), mfree_adr());     
    128              UpdateHeader();
   \   0000003C   ........           BL       UpdateHeader
    129              SetHeaderText(hdr_pointer, ws_hdr, malloc_adr(), mfree_adr());
   \   00000040   158000EF           SWI      +32789
   \   00000044   0070A0E1           MOV      R7,R0
   \   00000048   148000EF           SWI      +32788
   \   0000004C   1C1094E5           LDR      R1,[R4, #+28]
   \   00000050   0730A0E1           MOV      R3,R7
   \   00000054   0020A0E1           MOV      R2,R0
   \   00000058   0600A0E1           MOV      R0,R6
   \   0000005C   AF0200EF           SWI      +687
    130              
    131              //LoadDynTheme();
    132              //LoadDynImages();
    133              
    134              if (list_empty(&my_groups))
   \   00000060   ........           LDR      R0,??DataTable11  ;; my_groups
   \   00000064   001090E5           LDR      R1,[R0, #+0]
   \   00000068   000051E1           CMP      R1,R0
   \   0000006C   F080BD18           POPNE    {R4-R7,PC}
    135              {
    136                AnimWidget_Wait_center();
   \   00000070   ........           _BLF     AnimWidget_Wait_center,??AnimWidget_Wait_center??rA
    137                GUI_StartTimerProc(gui, timer_id, 100, LoadSavedGroups);//загружаем сохраненные диалоги
   \   00000074   8C309FE5           LDR      R3,??items_menu_ghook_1  ;; LoadSavedGroups
   \   00000078   181094E5           LDR      R1,[R4, #+24]
   \   0000007C   6420A0E3           MOV      R2,#+100
   \   00000080   0500A0E1           MOV      R0,R5
   \   00000084   A90300EF           SWI      +937
    138                return;
   \   00000088   F080BDE8           POP      {R4-R7,PC}
    139              }    
    140          /*    
    141              if (IsGPRSEnabled())
    142                {
    143                  if (INET_PROCESS==0 && list_empty(&my_groups))
    144                  {
    145                    INET_PROCESS=LOAD_GROUPS;
    146                    SUBPROC((void *)HttpSendReq, url_groups_get(0, 100), 1);
    147                    //AnimWidget_Wait_center();
    148                  }
    149                }
    150              */
    151            }
    152               
    153            if (cmd==TI_CMD_UNFOCUS)
   \                     ??items_menu_ghook_0:
   \   0000008C   090051E3           CMP      R1,#+9
   \   00000090   0200001A           BNE      ??items_menu_ghook_2
    154            {
    155              AnimWidget_Close();
   \   00000094   ........           _BLF     AnimWidget_Close,??AnimWidget_Close??rA
    156              //DisableDynImages();
    157              DisableDynTheme();
   \   00000098   ........           _BLF     DisableDynTheme,??DisableDynTheme??rA
   \   0000009C   F080BDE8           POP      {R4-R7,PC}
    158            }
    159            
    160            if (cmd==TI_CMD_FOCUS)
   \                     ??items_menu_ghook_2:
   \   000000A0   0A0051E3           CMP      R1,#+10
   \   000000A4   0300001A           BNE      ??items_menu_ghook_3
    161            {
    162              //if (GetMenuItemCount(gui)==0)
    163                //AnimWidget_Wait_body();
    164              
    165              EnableDynImages();
   \   000000A8   ........           _BLF     EnableDynImages,??EnableDynImages??rA
    166              EnableDynTheme();  
   \   000000AC   ........           _BLF     EnableDynTheme,??EnableDynTheme??rA
    167              DisableIDLETMR();
   \   000000B0   7F0100EF           SWI      +383
   \   000000B4   F080BDE8           POP      {R4-R7,PC}
    168            }  
    169            
    170            if (cmd==TI_CMD_REDRAW)
   \                     ??items_menu_ghook_3:
   \   000000B8   070051E3           CMP      R1,#+7
   \   000000BC   0700001A           BNE      ??items_menu_ghook_4
    171            {
    172              cursor_pos = GetCurMenuItem(gui);
   \   000000C0   8F0100EF           SWI      +399
    173              if (loaded_count)
   \   000000C4   281094E5           LDR      R1,[R4, #+40]
   \   000000C8   000051E3           CMP      R1,#+0
    174                cursor_pos++;
   \   000000CC   01008012           ADDNE    R0,R0,#+1
   \   000000D0   240084E5           STR      R0,[R4, #+36]
    175              UpdateHeader();
   \   000000D4   ........           BL       UpdateHeader
    176              EnableDynImages();
   \   000000D8   ........           _BLF     EnableDynImages,??EnableDynImages??rA
   \   000000DC   F080BDE8           POP      {R4-R7,PC}
    177            }
    178            
    179            if (cmd==TI_CMD_DESTROY)
   \                     ??items_menu_ghook_4:
   \   000000E0   030051E3           CMP      R1,#+3
   \   000000E4   F080BD18           POPNE    {R4-R7,PC}
    180            {
    181              GUI_DeleteTimer(gui, timer_id);
   \   000000E8   181094E5           LDR      R1,[R4, #+24]
   \   000000EC   A80300EF           SWI      +936
    182              gui_id=0;
   \   000000F0   0000A0E3           MOV      R0,#+0
   \   000000F4   140084E5           STR      R0,[R4, #+20]
    183              AnimWidget_Close();
   \   000000F8   ........           _BLF     AnimWidget_Close,??AnimWidget_Close??rA
    184              DisableDynTheme();
   \   000000FC   ........           _BLF     DisableDynTheme,??DisableDynTheme??rA
    185              DisableDynImages();
   \   00000100   ........           _BLF     DisableDynImages,??DisableDynImages??rA
   \   00000104   F080BDE8           POP      {R4-R7,PC}       ;; return
   \                     ??items_menu_ghook_1:
   \   00000108   ........           DC32     LoadSavedGroups
    186            }
    187          }
    188          

   \                                 In segment CODE, align 4, keep-with-next
    189          static void items_menu_iconhndl(void *gui, int curitem, void *user_pointer)
    190          {
   \                     items_menu_iconhndl:
   \   00000000   F0432DE9           PUSH     {R4-R9,LR}
   \   00000004   0040A0E1           MOV      R4,R0
    191            
    192            IMGHDR *item_icon = NULL;
    193            struct list_head *pos;
    194            VkGroup *group;
    195            
    196            pos = get_ListByIndex(&my_groups, curitem);
   \   00000008   ........           LDR      R0,??DataTable11  ;; my_groups
   \   0000000C   0150A0E1           MOV      R5,R1
   \   00000010   ........           _BLF     get_ListByIndex,??get_ListByIndex??rA
   \   00000014   0060A0E1           MOV      R6,R0
    197            group = list_entry(pos, VkGroup, list);
    198            
    199            WSHDR *ws1=AllocMenuWS(gui,64);
   \   00000018   4010A0E3           MOV      R1,#+64
   \   0000001C   0400A0E1           MOV      R0,R4
   \   00000020   980100EF           SWI      +408
   \   00000024   0070A0E1           MOV      R7,R0
    200            WSHDR *ws2=AllocMenuWS(gui,64);
   \   00000028   4010A0E3           MOV      R1,#+64
   \   0000002C   0400A0E1           MOV      R0,R4
   \   00000030   980100EF           SWI      +408
   \   00000034   0080A0E1           MOV      R8,R0
    201            void* item=AllocMLMenuItem(gui);
   \   00000038   0400A0E1           MOV      R0,R4
   \   0000003C   190200EF           SWI      +537
   \   00000040   0090A0E1           MOV      R9,R0
    202          
    203            wsAppendChar(ws1, UTF16_FONT_SMALL_BOLD);
   \   00000044   1310A0E3           MOV      R1,#+19
   \   00000048   E01C81E3           ORR      R1,R1,#0xE000
   \   0000004C   0700A0E1           MOV      R0,R7
   \   00000050   1C0000EF           SWI      +28
    204            wsAppendChar(ws2, UTF16_FONT_SMALL);
   \   00000054   1210A0E3           MOV      R1,#+18
   \   00000058   E01C81E3           ORR      R1,R1,#0xE000
   \   0000005C   0800A0E1           MOV      R0,R8
   \   00000060   1C0000EF           SWI      +28
    205            
    206            if (group)
   \   00000064   000056E3           CMP      R6,#+0
   \   00000068   3200000A           BEQ      ??items_menu_iconhndl_0
    207            {
    208              /*wsAppendChar(ws1, UTF16_INK_RGBA);
    209              wsAppendChar(ws1, 0x5D80);//RG
    210              wsAppendChar(ws1, 0xA664);//BA - вк синий  */
    211              
    212              if (group->name)
   \   0000006C   0C0096E5           LDR      R0,[R6, #+12]
   \   00000070   000050E3           CMP      R0,#+0
   \   00000074   0300000A           BEQ      ??items_menu_iconhndl_1
    213                wstrcat(ws1, group->name);
   \   00000078   0010A0E1           MOV      R1,R0
   \   0000007C   0700A0E1           MOV      R0,R7
   \   00000080   210100EF           SWI      +289
   \   00000084   030000EA           B        ??items_menu_iconhndl_2
    214              else
    215                wstrcatprintf(ws1,percent_d, group->id);
   \                     ??items_menu_iconhndl_1:
   \   00000088   082096E5           LDR      R2,[R6, #+8]
   \   0000008C   C4109FE5           LDR      R1,??items_menu_iconhndl_3  ;; percent_d
   \   00000090   0700A0E1           MOV      R0,R7
   \   00000094   160200EF           SWI      +534
    216              
    217              wsAppendChar(ws2, UTF16_INK_RGBA);
   \                     ??items_menu_iconhndl_2:
   \   00000098   0610A0E3           MOV      R1,#+6
   \   0000009C   E01C81E3           ORR      R1,R1,#0xE000
   \   000000A0   0800A0E1           MOV      R0,R8
   \   000000A4   1C0000EF           SWI      +28
    218              wsAppendChar(ws2, 0x8080);//RG
   \   000000A8   8010A0E3           MOV      R1,#+128
   \   000000AC   801C81E3           ORR      R1,R1,#0x8000
   \   000000B0   0800A0E1           MOV      R0,R8
   \   000000B4   1C0000EF           SWI      +28
    219              wsAppendChar(ws2, 0x8064);//BA - серый
   \   000000B8   6410A0E3           MOV      R1,#+100
   \   000000BC   801C81E3           ORR      R1,R1,#0x8000
   \   000000C0   0800A0E1           MOV      R0,R8
   \   000000C4   1C0000EF           SWI      +28
    220              /*wsAppendChar(ws2, 0x5D80);//RG
    221              wsAppendChar(ws2, 0xA664);//BA - вк синий */
    222              
    223              if (group->screen_name)
   \   000000C8   100096E5           LDR      R0,[R6, #+16]
   \   000000CC   000050E3           CMP      R0,#+0
   \   000000D0   0200000A           BEQ      ??items_menu_iconhndl_4
    224                wstrcat(ws2, group->screen_name);    
   \   000000D4   0010A0E1           MOV      R1,R0
   \   000000D8   0800A0E1           MOV      R0,R8
   \   000000DC   210100EF           SWI      +289
    225              
    226              //SetMenuItemIconArray(gui, item, &i1_pic); //первым рисуется картинка из SetMenuItemIconArray
    227          #ifdef NEWSGOLD
    228              
    229              if (group->photo_50_img)
   \                     ??items_menu_iconhndl_4:
   \   000000E0   240096E5           LDR      R0,[R6, #+36]
   \   000000E4   000050E3           CMP      R0,#+0
   \   000000E8   0400001A           BNE      ??items_menu_iconhndl_5
    230                item_icon = group->photo_50_img;
    231              else
    232                if (group->deactivated)
   \   000000EC   140096E5           LDR      R0,[R6, #+20]
   \   000000F0   000050E3           CMP      R0,#+0
   \   000000F4   0300000A           BEQ      ??items_menu_iconhndl_6
    233                  item_icon = PNGLIST_GetImgByIndex(0);//deactivated.png
   \   000000F8   0000A0E3           MOV      R0,#+0
   \   000000FC   ........           _BLF     PNGLIST_GetImgByIndex,??PNGLIST_GetImgByIndex??rA
    234              
    235              if (item_icon == NULL)
   \                     ??items_menu_iconhndl_5:
   \   00000100   000050E3           CMP      R0,#+0
   \   00000104   0100001A           BNE      ??items_menu_iconhndl_7
    236                item_icon = PNGLIST_GetImgByIndex(1);//camera.png
   \                     ??items_menu_iconhndl_6:
   \   00000108   0100A0E3           MOV      R0,#+1
   \   0000010C   ........           _BLF     PNGLIST_GetImgByIndex,??PNGLIST_GetImgByIndex??rA
    237              
    238              if (item_icon)
   \                     ??items_menu_iconhndl_7:
   \   00000110   000050E3           CMP      R0,#+0
   \   00000114   0300000A           BEQ      ??items_menu_iconhndl_8
    239                SetMenuItemIconIMGHDR(gui, item, item_icon);
   \   00000118   0020A0E1           MOV      R2,R0
   \   0000011C   0910A0E1           MOV      R1,R9
   \   00000120   0400A0E1           MOV      R0,R4
   \   00000124   A30300EF           SWI      +931
    240          #endif
    241           /*     
    242                if (process==0) 
    243                {
    244                  csm->cl=csm->groups_list;
    245                  csm->c=csm->cl;
    246                  process=LOAD_USERS_PHOTO_FROM_INET;
    247                  ipc.name_to=ipc_my_name;
    248                  ipc.name_from=ipc_my_name;
    249                  ipc.data=0;
    250                  GBS_SendMessage(MMI_CEPID, MSG_IPC, IPC_RUN_MAIN_PROCESS, &ipc);        
    251                } 
    252            */
    253              SetMLMenuItemText(gui, item, ws1, ws2, curitem);
   \                     ??items_menu_iconhndl_8:
   \   00000128   20002DE9           PUSH     {R5}
   \   0000012C   0830A0E1           MOV      R3,R8
   \   00000130   0720A0E1           MOV      R2,R7
   \   00000134   020000EA           B        ??items_menu_iconhndl_9
    254            }
    255            else
    256              SetMLMenuItemText(gui, item, 0, 0, curitem);
   \                     ??items_menu_iconhndl_0:
   \   00000138   20002DE9           PUSH     {R5}
   \   0000013C   0030A0E3           MOV      R3,#+0
   \   00000140   0020A0E3           MOV      R2,#+0
   \                     ??items_menu_iconhndl_9:
   \   00000144   0910A0E1           MOV      R1,R9
   \   00000148   0400A0E1           MOV      R0,R4
   \   0000014C   180200EF           SWI      +536
   \   00000150   04D08DE2           ADD      SP,SP,#+4
    257          }
   \   00000154   F083BDE8           POP      {R4-R9,PC}       ;; return
   \                     ??items_menu_iconhndl_3:
   \   00000158   ........           DC32     percent_d
    258          

   \                                 In segment DATA_C, align 4, align-sorted
    259          static const ML_MENU_DESC items_menu_desc=
   \                     items_menu_desc:
   \   00000000   08000000....       DC32 8, items_menu_onkey, items_menu_ghook, 0H, menusoftkeys, skt
   \              ............
   \              00000000....
   \              ............
   \   00000018   92000140....       DC32 1073807506, items_menu_iconhndl, 0H, 0H, 0, 1
   \              ....00000000
   \              000000000000
   \              000001000000
    260          {
    261            8,
    262            items_menu_onkey,
    263            items_menu_ghook,
    264            NULL,
    265            menusoftkeys,
    266            &skt,
    267            0x40010092, //0x40010092//0x80000083
    268            items_menu_iconhndl,
    269            NULL,   //Items
    270            NULL,   //Procs
    271            0,   //n
    272            1 //Добавочных строк  
    273          };
    274          
    275          //******************************************************************************

   \                                 In segment CODE, align 4, keep-with-next
    276          void RefreshGroupsMenu()
    277          {  
   \                     RefreshGroupsMenu:
   \   00000000   30402DE9           PUSH     {R4,R5,LR}
    278            if (gui_id)
   \   00000004   ........           LDR      R4,??DataTable8  ;; hdr
   \   00000008   140094E5           LDR      R0,[R4, #+20]
   \   0000000C   000050E3           CMP      R0,#+0
   \   00000010   3080BD08           POPEQ    {R4,R5,PC}
    279            {
    280              GUI* gui = FindGUIbyId(gui_id, NULL);
   \   00000014   0010A0E3           MOV      R1,#+0
   \   00000018   090200EF           SWI      +521
   \   0000001C   0050A0E1           MOV      R5,R0
    281              //csm->list = &dialogs;
    282              //GUI_StartTimerProc(gui, timer_id, 100, LoadUserPhoto);//ищем авки в cache    
    283              loaded_count = count_ListElements(&my_groups);
   \   00000020   ........           LDR      R0,??DataTable11  ;; my_groups
   \   00000024   ........           _BLF     count_ListElements,??count_ListElements??rA
   \   00000028   280084E5           STR      R0,[R4, #+40]
    284              Menu_SetItemCountDyn(gui, loaded_count);
   \   0000002C   0010A0E1           MOV      R1,R0
   \   00000030   0500A0E1           MOV      R0,R5
   \   00000034   E60100EF           SWI      +486
    285            }
    286          }
   \   00000038   3080BDE8           POP      {R4,R5,PC}       ;; return
    287          //******************************************************************************
    288          

   \                                 In segment CODE, align 4, keep-with-next
    289          int CreateGroupsMenu()
    290          {
   \                     CreateGroupsMenu:
   \   00000000   70402DE9           PUSH     {R4-R6,LR}
    291            void *ma=malloc_adr(); 
    292            void *mf= mfree_adr();
    293            void *gui=GetMultiLinesMenuGUI(ma, mf); 
    294            SetMenuToGUI(gui,&items_menu_desc); 
    295            SetMenuItemCount(gui, count_ListElements(&my_groups));
    296            patch_header(&hdr);
   \   00000004   ........           LDR      R6,??DataTable10  ;; hdr
   \   00000008   148000EF           SWI      +32788
   \   0000000C   0040A0E1           MOV      R4,R0
   \   00000010   158000EF           SWI      +32789
   \   00000014   0010A0E1           MOV      R1,R0
   \   00000018   0400A0E1           MOV      R0,R4
   \   0000001C   A50200EF           SWI      +677
   \   00000020   40109FE5           LDR      R1,??CreateGroupsMenu_0  ;; items_menu_desc
   \   00000024   0050A0E1           MOV      R5,R0
   \   00000028   A70200EF           SWI      +679
   \   0000002C   ........           LDR      R0,??DataTable11  ;; my_groups
   \   00000030   ........           _BLF     count_ListElements,??count_ListElements??rA
   \   00000034   0010A0E1           MOV      R1,R0
   \   00000038   0500A0E1           MOV      R0,R5
   \   0000003C   C30100EF           SWI      +451
   \   00000040   0600A0E1           MOV      R0,R6
   \   00000044   ........           _BLF     patch_header,??patch_header??rA
    297            SetHeaderToMenu(gui,&hdr,ma); 
   \   00000048   0420A0E1           MOV      R2,R4
   \   0000004C   0610A0E1           MOV      R1,R6
   \   00000050   0500A0E1           MOV      R0,R5
   \   00000054   A60200EF           SWI      +678
    298            return gui_id=CreateGUI(gui); 
   \   00000058   0500A0E1           MOV      R0,R5
   \   0000005C   370100EF           SWI      +311
   \   00000060   140086E5           STR      R0,[R6, #+20]
   \   00000064   7080BDE8           POP      {R4-R6,PC}       ;; return
   \                     ??CreateGroupsMenu_0:
   \   00000068   ........           DC32     items_menu_desc
    299          }

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable2:
   \   00000000   ........           DC32     hdr + 32

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable8:
   \   00000000   ........           DC32     hdr

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable10:
   \   00000000   ........           DC32     hdr

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable11:
   \   00000000   ........           DC32     my_groups

   \                                 In segment DATA_ID, align 4, align-sorted
   \                     `?<Initializer for hdr>`:
   \   00000000   000000000000       DC16 0, 0, 0, 0
   \              0000        
   \   00000008   000000000000       DC32 0H, 0, 2147483647
   \              0000FFFFFF7F
   \                     `?<Initializer for gui_id>`:
   \   00000014   00000000           DC32 0
   \                     `?<Initializer for timer_id>`:
   \   00000018   00000000           DC8 0, 0, 0, 0
   \                     `?<Initializer for ws_hdr>`:
   \   0000001C   00000000           DC32 0H
   \                     `?<Initializer for groups_count>`:
   \   00000020   00000000           DC32 0
   \                     `?<Initializer for cursor_pos>`:
   \   00000024   00000000           DC32 0
   \                     `?<Initializer for loaded_count>`:
   \   00000028   00000000           DC32 0
   \                     `?<Initializer for hdr_icon>`:
   \   0000002C   99050000           DC32 1433

   \                                 In segment DATA_ID, align 4, align-sorted
   \                     `?<Initializer for sk>`:
   \   00000000   18000000           DC16 24, 0
   \   00000004   ........           DC32 `?<Constant "\\356\\341\\355\\356\\342\\350\\362\\374">`
   \   00000008   01000000           DC16 1, 0
   \   0000000C   ........           DC32 `?<Constant "\\315\\340\\347\\340\\344">`
   \   00000010   3D000000           DC16 61, 0
   \   00000014   FBC0FF7F           DC32 2147467515

   \                                 In segment DATA_ID, align 4, align-sorted
   \                     `?<Initializer for skt>`:
   \   00000000   ........0000       DC32 sk, 0
   \              0000        

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant "\\356\\341\\355\\356\\342\\350\\362\\374">`:
   \   00000000   EEE1EDEEE2E8       DC8 "\356\341\355\356\342\350\362\374"
   \              F2FC00      
   \   00000009   000000             DC8 0, 0, 0

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant "\\315\\340\\347\\340\\344">`:
   \   00000000   CDE0E7E0E400       DC8 "\315\340\347\340\344"
   \   00000006   0000               DC8 0, 0
    300          
    301          
    302          

   Maximum stack usage in bytes:

     Function            CSTACK
     --------            ------
     CreateGroupsMenu       16
     RefreshGroupsMenu      12
     UpdateHeader           12
     get_GroupsCount         0
     items_menu_ghook       20
     items_menu_iconhndl    32
     items_menu_onkey        4
     patch_header            8
     set_GroupsCount         0


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     patch_header                     52
     percent_t                        20
     percent_d                         3
     hdr                              48
     menusoftkeys                     12
     sk                               24
     skt                               8
     UpdateHeader                    100
     set_GroupsCount                  12
     get_GroupsCount                  12
     items_menu_onkey                204
     items_menu_ghook                268
     items_menu_iconhndl             348
     items_menu_desc                  48
     RefreshGroupsMenu                60
     CreateGroupsMenu                108
     ??DataTable2                      4
     ??DataTable8                      4
     ??DataTable10                     4
     ??DataTable11                     4
     ?<Initializer for hdr>           48
     ?<Initializer for sk>            24
     ?<Initializer for skt>            8
     ?<Constant "\356\341\355\356\342\350\362\374">
                                      12
     ?<Constant "\315\340\347\340\344">
                                       8
      Others                         200

 
 1 368 bytes in segment CODE
   103 bytes in segment DATA_C
    80 bytes in segment DATA_I
    80 bytes in segment DATA_ID
    12 bytes in segment INITTAB
 
 1 128 bytes of CODE  memory (+ 252 bytes shared)
   183 bytes of CONST memory
    80 bytes of DATA  memory

Errors: none
Warnings: 1

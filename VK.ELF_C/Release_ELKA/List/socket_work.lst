##############################################################################
#                                                                            #
# IAR ARM ANSI C/C++ Compiler V4.42A/W32 EVALUATION    16/Feb/2023  22:41:13 #
# Copyright 1999-2005 IAR Systems. All rights reserved.                      #
#                                                                            #
#    Cpu mode        =  interwork                                            #
#    Endian          =  little                                               #
#    Stack alignment =  4                                                    #
#    Source file     =  D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C #
#                       \socket_work.c                                       #
#    Command line    =  D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C #
#                       \socket_work.c -D NEWSGOLD -D ELKA -D DEBUG -lCN     #
#                       D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C #
#                       \Release_ELKA\List\ -la D:\Users\alfinant\Documents\ #
#                       Siemens\Dev\IAR\VK.ELF_C\Release_ELKA\List\ -o       #
#                       D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C #
#                       \Release_ELKA\Obj\ -z9 --cpu_mode arm --endian       #
#                       little --cpu ARM926EJ-S --stack_align 4 --interwork  #
#                       --diag_suppress Pe301 -e --fpu None --dlib_config    #
#                       D:\Users\alfinant\Documents\Siemens\IAR\ARM\LIB\dl5t #
#                       painl8n.h -I D:\Users\alfinant\Documents\Siemens\IAR #
#                       \ARM\INC\ --inline_threshold=2                       #
#    List file       =  D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C #
#                       \Release_ELKA\List\socket_work.lst                   #
#    Object file     =  D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C #
#                       \Release_ELKA\Obj\socket_work.r79                    #
#                                                                            #
#                                                                            #
##############################################################################

D:\Users\alfinant\Documents\Siemens\Dev\IAR\VK.ELF_C\socket_work.c
      1          #include "socket_work.h"
      2          #include "buffer.h"
      3          
      4          #define TMR_SECOND 216
      5          static unsigned int RECONNECT_TIME=3;//сек
      6          int disautorecconect=0;
      7          
      8          extern char logmsg[];
      9          extern void SMART_REDRAW();
     10          
     11          int (*sock_data_read_handler)(CONNDATA *conn)=NULL;
     12          void (*sock_remote_closed_handler)(short sock)=NULL;
     13          void (*sock_error_handler)(int err)=NULL;
     14          
     15          int is_gprs_online=1;
     16          
     17          static GBSTMR reconnect_tmr;
     18          
     19          //******************************************************************************
     20          

   \                                 In segment CODE, align 4, keep-with-next
     21          void socket_work_init(void* error_handler, void* data_read_handler, void* remote_close_handler)
     22          {
     23            sock_data_read_handler=(int(*)(CONNDATA*))data_read_handler;
   \                     socket_work_init:
   \   00000000   ........           LDR      R3,??DataTable4  ;; disautorecconect
   \   00000004   041083E5           STR      R1,[R3, #+4]
     24            sock_remote_closed_handler=(void(*)(short))remote_close_handler;
   \   00000008   082083E5           STR      R2,[R3, #+8]
     25            sock_error_handler=(void(*)(int))error_handler;
   \   0000000C   0C0083E5           STR      R0,[R3, #+12]
     26          }
   \   00000010   1EFF2FE1           BX       LR               ;; return
     27          
     28          //******************************************************************************
     29          

   \                                 In segment CODE, align 4, keep-with-next
     30          void end_socket(int sock)
     31          {
   \                     end_socket:
   \   00000000   10402DE9           PUSH     {R4,LR}
   \   00000004   0040A0E1           MOV      R4,R0
     32            GBS_DelTimer(&reconnect_tmr);
   \   00000008   ........           LDR      R0,??DataTable3  ;; disautorecconect + 24
   \   0000000C   8C0100EF           SWI      +396
     33          
     34            if (sock !=-1)
   \   00000010   010074E3           CMN      R4,#+1
   \   00000014   1080BD08           POPEQ    {R4,PC}
     35            {
     36              shutdown(sock, 2);
   \   00000018   0210A0E3           MOV      R1,#+2
   \   0000001C   0400A0E1           MOV      R0,R4
   \   00000020   770100EF           SWI      +375
     37              closesocket(sock);
   \   00000024   0400A0E1           MOV      R0,R4
   \   00000028   760100EF           SWI      +374
     38            }
     39            
     40          }
   \   0000002C   1080BDE8           POP      {R4,PC}          ;; return
     41          

   \                                 In segment CODE, align 4, keep-with-next
     42          void end_socket_work()
     43          {
     44            GBS_DelTimer(&reconnect_tmr);
   \                     end_socket_work:
   \   00000000   ........           LDR      R0,??DataTable3  ;; disautorecconect + 24
   \   00000004   00402DE9           PUSH     {LR}
   \   00000008   8C0100EF           SWI      +396
     45            CONNDATA *conn=CONNDATA_getTop();
   \   0000000C   ........           _BLF     CONNDATA_getTop,??CONNDATA_getTop??rA
     46            if (conn)
   \   00000010   000050E3           CMP      R0,#+0
   \   00000014   0100000A           BEQ      ??end_socket_work_0
     47              end_socket(conn->sock);
   \   00000018   4C0090E5           LDR      R0,[R0, #+76]
   \   0000001C   ........           BL       end_socket
     48            free_buffers();
   \                     ??end_socket_work_0:
   \   00000020   0040BDE8           POP      {LR}             ;; Pop
   \   00000024   ........           _BF      free_buffers,??free_buffers??rA  ;; tailcall
     49          }
     50          
     51          //******************************************************************************
     52          

   \                                 In segment CODE, align 4, keep-with-next
     53          static void reconnect_tmr_handler()
     54          {
     55            if (is_gprs_online)
   \                     reconnect_tmr_handler:
   \   00000000   28009FE5           LDR      R0,??reconnect_tmr_handler_0  ;; disautorecconect + 16
   \   00000004   00402DE9           PUSH     {LR}
   \   00000008   000090E5           LDR      R0,[R0, #+0]
   \   0000000C   000050E3           CMP      R0,#+0
   \   00000010   0080BD08           POPEQ    {PC}
     56            {
     57              CONNDATA_getTop()->DNR_TRIES=3;
   \   00000014   ........           _BLF     CONNDATA_getTop,??CONNDATA_getTop??rA
   \   00000018   0310A0E3           MOV      R1,#+3
   \   0000001C   601080E5           STR      R1,[R0, #+96]
     58              SUBPROC((void*)connect_socket, NULL);
   \   00000020   0C009FE5           LDR      R0,??reconnect_tmr_handler_0+0x4  ;; connect_socket
   \   00000024   0010A0E3           MOV      R1,#+0
   \   00000028   710100EF           SWI      +369
     59            }
     60          }
   \   0000002C   0080BDE8           POP      {PC}             ;; return
   \                     ??reconnect_tmr_handler_0:
   \   00000030   ........           DC32     disautorecconect + 16
   \   00000034   ........           DC32     connect_socket
     61          

   \                                 In segment CODE, align 4, keep-with-next
     62          void reconnect()
     63          {
     64            GBS_StartTimerProc(&reconnect_tmr,TMR_SECOND*RECONNECT_TIME, reconnect_tmr_handler);
   \                     reconnect:
   \   00000000   10209FE5           LDR      R2,??reconnect_0  ;; reconnect_tmr_handler
   \   00000004   ........           LDR      R0,??DataTable3  ;; disautorecconect + 24
   \   00000008   00402DE9           PUSH     {LR}
   \   0000000C   A21FA0E3           MOV      R1,#+648
   \   00000010   4D0000EF           SWI      +77
     65          }
   \   00000014   0080BDE8           POP      {PC}             ;; return
   \                     ??reconnect_0:
   \   00000018   ........           DC32     reconnect_tmr_handler
     66          
     67          //******************************************************************************

   \                                 In segment CODE, align 4, keep-with-next
     68          void connect_socket(CONNDATA *conn)
     69          {
   \                     connect_socket:
   \   00000000   F0402DE9           PUSH     {R4-R7,LR}
     70            static CONNDATA *__conn;
     71            HOSTENT *hst=NULL;
     72            SOCK_ADDR sa;
     73            int err;
     74            
     75            if (conn)
   \   00000004   ........           LDR      R4,??DataTable4  ;; disautorecconect
     76            {
     77              __conn = conn;
     78              conn->sock_state=0;
     79            }
     80             
     81            GBS_DelTimer(&reconnect_tmr);
     82            
     83            if (!IsGPRSEnabled())
   \   00000008   ........           LDR      R5,??DataTable8  ;; logmsg
   \   0000000C   E8619FE5           LDR      R6,??connect_socket_0  ;; `?<Constant "Waiting for GPRS up...">`
   \   00000010   14D04DE2           SUB      SP,SP,#+20
   \   00000014   0070A0E3           MOV      R7,#+0
   \   00000018   00708DE5           STR      R7,[SP, #+0]
   \   0000001C   000050E3           CMP      R0,#+0
   \   00000020   14008415           STRNE    R0,[R4, #+20]
   \   00000024   54708015           STRNE    R7,[R0, #+84]
   \   00000028   180084E2           ADD      R0,R4,#+24
   \   0000002C   8C0100EF           SWI      +396
   \   00000030   A70000EF           SWI      +167
   \   00000034   000050E3           CMP      R0,#+0
   \   00000038   0800001A           BNE      ??connect_socket_1
     84            {
     85          #ifdef DEBUG     
     86              sprintf(logmsg, "Waiting for GPRS up...");
   \   0000003C   0610A0E1           MOV      R1,R6
   \   00000040   0500A0E1           MOV      R0,R5
   \   00000044   160000EF           SWI      +22
     87              SMART_REDRAW();
   \   00000048   ........           _BLF     SMART_REDRAW,??SMART_REDRAW??rA
     88          #endif
     89              is_gprs_online = 0;
   \   0000004C   107084E5           STR      R7,[R4, #+16]
     90              sock_error_handler(WAITING_FOR_GPRS_UP);
   \   00000050   0100A0E3           MOV      R0,#+1
   \                     ??connect_socket_2:
   \   00000054   0C1094E5           LDR      R1,[R4, #+12]
   \                     ??connect_socket_3:
   \   00000058   31FF2FE1           BLX      R1
     91              return;
   \   0000005C   640000EA           B        ??connect_socket_4
     92            }
     93            
     94            __conn->DNR_ID=0;
   \                     ??connect_socket_1:
   \   00000060   140094E5           LDR      R0,[R4, #+20]
   \   00000064   5C7080E5           STR      R7,[R0, #+92]
     95            *socklasterr()=0;
   \   00000068   7C8100EF           SWI      +33148
   \   0000006C   007080E5           STR      R7,[R0, #+0]
     96            
     97          #ifdef DEBUG   
     98            sprintf(logmsg, "Connect to: %s Using port: %d", __conn->hostname, __conn->port);
   \   00000070   140094E5           LDR      R0,[R4, #+20]
   \   00000074   181086E2           ADD      R1,R6,#+24
   \   00000078   B035D0E1           LDRH     R3,[R0, #+80]
   \   0000007C   0C2080E2           ADD      R2,R0,#+12
   \   00000080   0500A0E1           MOV      R0,R5
   \   00000084   160000EF           SWI      +22
     99            SMART_REDRAW();
   \   00000088   ........           _BLF     SMART_REDRAW,??SMART_REDRAW??rA
    100          #endif  
    101            
    102            //err=gethostbyname(host, &hst, &DNR_ID, 0); //используется в браузере. Если флаг==1, то вернет counter.rambler.ru и err==0xD3, connect не всегда удается с этой функцией
    103            err=async_gethostbyname(__conn->hostname, &hst, &__conn->DNR_ID);
   \   0000008C   140094E5           LDR      R0,[R4, #+20]
   \   00000090   0D10A0E1           MOV      R1,SP
   \   00000094   5C2080E2           ADD      R2,R0,#+92
   \   00000098   0C0080E2           ADD      R0,R0,#+12
   \   0000009C   B60100EF           SWI      +438
    104            if (err)
   \   000000A0   000050E3           CMP      R0,#+0
   \   000000A4   0D00000A           BEQ      ??connect_socket_5
    105            {
    106              if ((err==0xC9)||(err==0xD6))
   \   000000A8   C90050E3           CMP      R0,#+201
   \   000000AC   D6005013           CMPNE    R0,#+214
   \   000000B0   0800001A           BNE      ??connect_socket_6
    107              {
    108                if (__conn->DNR_ID)
   \   000000B4   140094E5           LDR      R0,[R4, #+20]
   \   000000B8   5C0090E5           LDR      R0,[R0, #+92]
   \   000000BC   000050E3           CMP      R0,#+0
   \   000000C0   0600000A           BEQ      ??connect_socket_5
    109                {
    110          #ifdef DEBUG         
    111                  strcpy(logmsg, "Wait DNR..");
   \   000000C4   381086E2           ADD      R1,R6,#+56
   \   000000C8   0500A0E1           MOV      R0,R5
   \   000000CC   1A0000EF           SWI      +26
    112                  SMART_REDRAW();
   \                     ??connect_socket_7:
   \   000000D0   ........           _BLF     SMART_REDRAW,??SMART_REDRAW??rA
    113          #endif        
    114          	return; //Ждем готовности DNR
   \   000000D4   460000EA           B        ??connect_socket_4
    115                }
    116              }
    117              else
    118              {
    119                //snprintf(logmsg,255,"DNR error %d",err);
    120                //SMART_REDRAW();
    121                //sendError();
    122                reconnect();
   \                     ??connect_socket_6:
   \   000000D8   ........           BL       reconnect
    123                return;
   \   000000DC   440000EA           B        ??connect_socket_4
    124              }
    125            }
    126           
    127            if (hst)
   \                     ??connect_socket_5:
   \   000000E0   00009DE5           LDR      R0,[SP, #+0]
   \   000000E4   000050E3           CMP      R0,#+0
   \   000000E8   3D00000A           BEQ      ??connect_socket_8
    128            {
    129              if (hst->h_addr_list)
   \   000000EC   0C0090E5           LDR      R0,[R0, #+12]
   \   000000F0   000050E3           CMP      R0,#+0
   \   000000F4   3E00000A           BEQ      ??connect_socket_4
    130              {
    131          #ifdef DEBUG      
    132                strcpy(logmsg,"DNR ok!");
   \   000000F8   441086E2           ADD      R1,R6,#+68
   \   000000FC   0500A0E1           MOV      R0,R5
   \   00000100   1A0000EF           SWI      +26
    133                SMART_REDRAW();
   \   00000104   ........           _BLF     SMART_REDRAW,??SMART_REDRAW??rA
    134          #endif            
    135                __conn->DNR_TRIES=0;
   \   00000108   140094E5           LDR      R0,[R4, #+20]
    136                sa.ip=**((int**)hst->h_addr_list);
    137                
    138                __conn->sock=socket(1,1,0);
   \   0000010C   0020A0E3           MOV      R2,#+0
   \   00000110   607080E5           STR      R7,[R0, #+96]
   \   00000114   00109DE5           LDR      R1,[SP, #+0]
    139                
    140                if (__conn->sock != -1)
   \   00000118   0770E0E1           MVN      R7,R7
   \   0000011C   0C1091E5           LDR      R1,[R1, #+12]
   \   00000120   001091E5           LDR      R1,[R1, #+0]
   \   00000124   001091E5           LDR      R1,[R1, #+0]
   \   00000128   08108DE5           STR      R1,[SP, #+8]
   \   0000012C   0110A0E3           MOV      R1,#+1
   \   00000130   0100A0E1           MOV      R0,R1
   \   00000134   730100EF           SWI      +371
   \   00000138   141094E5           LDR      R1,[R4, #+20]
   \   0000013C   070050E1           CMP      R0,R7
   \   00000140   4C0081E5           STR      R0,[R1, #+76]
   \   00000144   1E00000A           BEQ      ??connect_socket_9
    141                {       
    142          	sa.family=hst->h_addrtype;//1
   \   00000148   00209DE5           LDR      R2,[SP, #+0]
   \   0000014C   B820D2E1           LDRH     R2,[R2, #+8]
   \   00000150   B420CDE1           STRH     R2,[SP, #+4]
    143          	sa.port=htons(__conn->port);
   \   00000154   B005D1E1           LDRH     R0,[R1, #+80]
   \   00000158   7A0100EF           SWI      +378
   \   0000015C   B600CDE1           STRH     R0,[SP, #+6]
    144          	if (connect(__conn->sock, &sa, sizeof(sa)) != -1)
   \   00000160   140094E5           LDR      R0,[R4, #+20]
   \   00000164   1020A0E3           MOV      R2,#+16
   \   00000168   4C0090E5           LDR      R0,[R0, #+76]
   \   0000016C   04108DE2           ADD      R1,SP,#+4
   \   00000170   740100EF           SWI      +372
   \   00000174   070050E1           CMP      R0,R7
   \   00000178   0700000A           BEQ      ??connect_socket_10
    145          	{
    146          	  __conn->sock_state = 1;
   \   0000017C   140094E5           LDR      R0,[R4, #+20]
   \   00000180   0110A0E3           MOV      R1,#+1
   \   00000184   541080E5           STR      R1,[R0, #+84]
    147          #ifdef DEBUG          
    148                    snprintf(logmsg,255,"Socket connected");
   \   00000188   4C2086E2           ADD      R2,R6,#+76
   \   0000018C   FF10A0E3           MOV      R1,#+255
   \   00000190   0500A0E1           MOV      R0,R5
   \   00000194   1B0100EF           SWI      +283
    149                    SMART_REDRAW();
   \   00000198   CCFFFFEA           B        ??connect_socket_7
    150          #endif          
    151          	}
    152          	else
    153          	{
    154          #ifdef DEBUG           
    155                    snprintf(logmsg,255,"Connect fault");
   \                     ??connect_socket_10:
   \   0000019C   602086E2           ADD      R2,R6,#+96
   \   000001A0   FF10A0E3           MOV      R1,#+255
   \   000001A4   0500A0E1           MOV      R0,R5
   \   000001A8   1B0100EF           SWI      +283
    156                    SMART_REDRAW();
   \   000001AC   ........           _BLF     SMART_REDRAW,??SMART_REDRAW??rA
    157          #endif          
    158          	  closesocket(__conn->sock);          
   \   000001B0   140094E5           LDR      R0,[R4, #+20]
   \   000001B4   4C0090E5           LDR      R0,[R0, #+76]
   \   000001B8   760100EF           SWI      +374
    159                    sock_error_handler(CONNECT_FAULT);
   \   000001BC   0200A0E3           MOV      R0,#+2
   \   000001C0   A3FFFFEA           B        ??connect_socket_2
    160          	}
    161                }
    162                else
    163                {
    164          #ifdef DEBUG         
    165                  snprintf(logmsg,255,"Error Create Socket");
   \                     ??connect_socket_9:
   \   000001C4   702086E2           ADD      R2,R6,#+112
   \   000001C8   FF10A0E3           MOV      R1,#+255
   \   000001CC   0500A0E1           MOV      R0,R5
   \   000001D0   1B0100EF           SWI      +283
    166                  SMART_REDRAW();
   \   000001D4   ........           _BLF     SMART_REDRAW,??SMART_REDRAW??rA
    167          #endif        
    168                  sock_error_handler(ERROR_CREATE_SOCK);
   \   000001D8   0C1094E5           LDR      R1,[R4, #+12]
   \   000001DC   0300A0E3           MOV      R0,#+3
   \   000001E0   9CFFFFEA           B        ??connect_socket_3
    169                }
    170              }
    171            }
    172            else
    173            {
    174              __conn->DNR_TRIES--;
   \                     ??connect_socket_8:
   \   000001E4   140094E5           LDR      R0,[R4, #+20]
   \   000001E8   601090E5           LDR      R1,[R0, #+96]
   \   000001EC   011041E2           SUB      R1,R1,#+1
   \   000001F0   601080E5           STR      R1,[R0, #+96]
   \                     ??connect_socket_4:
   \   000001F4   14D08DE2           ADD      SP,SP,#+20       ;; stack cleaning
   \   000001F8   F080BDE8           POP      {R4-R7,PC}       ;; return
   \                     ??connect_socket_0:
   \   000001FC   ........           DC32     `?<Constant "Waiting for GPRS up...">`
    175            }
    176          }

   \                                 In segment DATA_I, align 4, align-sorted
   \                     disautorecconect:
   \   00000000                      DS8 4
   \   00000004                      REQUIRE `?<Initializer for disautorecconect>`
   \                     sock_data_read_handler:
   \   00000004                      DS8 4
   \   00000008                      REQUIRE `?<Initializer for sock_data_read_handler>`
   \                     sock_remote_closed_handler:
   \   00000008                      DS8 4
   \   0000000C                      REQUIRE `?<Initializer for sock_remote_closed_handler>`
   \                     sock_error_handler:
   \   0000000C                      DS8 4
   \   00000010                      REQUIRE `?<Initializer for sock_error_handler>`
   \                     is_gprs_online:
   \   00000010                      DS8 4
   \   00000014                      REQUIRE `?<Initializer for is_gprs_online>`
   \   00000014                      DS8 4
   \   00000018                      REQUIRE `?<Initializer for __conn>`
   \   00000018                      DS8 16
   \   00000028                      REQUIRE `?<Initializer for reconnect_tmr>`
    177          
    178          //******************************************************************************
    179          

   \                                 In segment CODE, align 4, keep-with-next
    180          void send_answer(const char *url, char *buf, int len, int flag)
    181          { 
   \                     send_answer:
   \   00000000   F04F2DE9           PUSH     {R4-R11,LR}
    182            static int send_q_size;
    183            CONNDATA *conn=NULL;
    184            
    185            if (url)//если первый вызов функции, проверяем наличии сокета для данного хоста
   \   00000004   20519FE5           LDR      R5,??send_answer_0  ;; ??send_q_size
   \   00000008   20619FE5           LDR      R6,??send_answer_0+0x4  ;; send_buf_len
   \   0000000C   20719FE5           LDR      R7,??send_answer_0+0x8  ;; send_buf
   \   00000010   0090A0E1           MOV      R9,R0
   \   00000014   01A0A0E1           MOV      R10,R1
   \   00000018   0280A0E1           MOV      R8,R2
   \   0000001C   03B0A0E1           MOV      R11,R3
   \   00000020   0040A0E3           MOV      R4,#+0
   \   00000024   000059E3           CMP      R9,#+0
   \   00000028   1300000A           BEQ      ??send_answer_1
    186            { 
    187              free_send_buf();
   \   0000002C   ........           _BLF     free_send_buf,??free_send_buf??rA
    188              send_buf = buf;
   \   00000030   00A087E5           STR      R10,[R7, #+0]
    189              send_buf_len=len;
   \   00000034   008086E5           STR      R8,[R6, #+0]
    190              send_q_size=len;
   \   00000038   008085E5           STR      R8,[R5, #+0]
    191              
    192              conn=CONNDATA_findByURL(url);
   \   0000003C   0900A0E1           MOV      R0,R9
   \   00000040   ........           _BLF     CONNDATA_findByURL,??CONNDATA_findByURL??rA
   \   00000044   0040B0E1           MOVS     R4,R0
    193              
    194              if (conn)
   \   00000048   0100000A           BEQ      ??send_answer_2
    195                CONNDATA_set2Top(conn);
   \   0000004C   ........           _BLF     CONNDATA_set2Top,??CONNDATA_set2Top??rA
   \   00000050   030000EA           B        ??send_answer_3
    196              else
    197                conn=CONNDATA_new(url, flag);
   \                     ??send_answer_2:
   \   00000054   0B10A0E1           MOV      R1,R11
   \   00000058   0900A0E1           MOV      R0,R9
   \   0000005C   ........           _BLF     CONNDATA_new,??CONNDATA_new??rA
   \   00000060   0040A0E1           MOV      R4,R0
    198           
    199              if (conn->sock == -1)
   \                     ??send_answer_3:
   \   00000064   4C0094E5           LDR      R0,[R4, #+76]
   \   00000068   010070E3           CMN      R0,#+1
   \   0000006C   0200001A           BNE      ??send_answer_1
    200              {
    201                connect_socket(conn);
   \   00000070   0400A0E1           MOV      R0,R4
   \   00000074   ........           BL       connect_socket
    202                return;
   \   00000078   F08FBDE8           POP      {R4-R11,PC}
    203              }
    204            }
    205            
    206            if (send_q_size==0)
   \                     ??send_answer_1:
   \   0000007C   000095E5           LDR      R0,[R5, #+0]
   \   00000080   000050E3           CMP      R0,#+0
   \   00000084   0E00001A           BNE      ??send_answer_4
    207              send_q_size=send_buf_len;
   \   00000088   000096E5           LDR      R0,[R6, #+0]
   \   0000008C   000085E5           STR      R0,[R5, #+0]
   \   00000090   0B0000EA           B        ??send_answer_4
    208            
    209            while ((len = send_q_size) != 0)
    210            {
    211              if (len > 0x400)
    212              len=0x400;
    213              
    214              int send_res = send(conn->sock, send_buf+(send_buf_len-send_q_size), len, 0);
    215          
    216              conn->recv_mode = 1;
    217              
    218              if (send_res < 0)
    219              {
    220                int err = *socklasterr();
    221                if (err == 0xC9 || err == 0xD6)
    222                {
    223          	return; //Видимо, надо ждать сообщения ENIP_BUFFER_FREE
    224                }
    225                else
    226                {
    227                  //error send
    228          	return;
    229                }
    230              }
    231              send_q_size-=send_res;
   \                     ??send_answer_5:
   \   00000094   001095E5           LDR      R1,[R5, #+0]
    232              conn->TOTALSENDED+=send_res;
    233              ALLTOTALSENDED+=send_res;
    234              
    235              if (send_res < len)
   \   00000098   080050E1           CMP      R0,R8
   \   0000009C   001041E0           SUB      R1,R1,R0
   \   000000A0   001085E5           STR      R1,[R5, #+0]
   \   000000A4   681094E5           LDR      R1,[R4, #+104]
   \   000000A8   011080E0           ADD      R1,R0,R1
   \   000000AC   681084E5           STR      R1,[R4, #+104]
   \   000000B0   80109FE5           LDR      R1,??send_answer_0+0xC  ;; ALLTOTALSENDED
   \   000000B4   002091E5           LDR      R2,[R1, #+0]
   \   000000B8   022080E0           ADD      R2,R0,R2
   \   000000BC   002081E5           STR      R2,[R1, #+0]
   \   000000C0   F08FBDB8           POPLT    {R4-R11,PC}
   \                     ??send_answer_4:
   \   000000C4   000095E5           LDR      R0,[R5, #+0]
   \   000000C8   0080B0E1           MOVS     R8,R0
   \   000000CC   1100000A           BEQ      ??send_answer_6
   \   000000D0   0110A0E3           MOV      R1,#+1
   \   000000D4   401E81E3           ORR      R1,R1,#0x400
   \   000000D8   010058E1           CMP      R8,R1
   \   000000DC   001096E5           LDR      R1,[R6, #+0]
   \   000000E0   408EA0A3           MOVGE    R8,#+1024
   \   000000E4   000041E0           SUB      R0,R1,R0
   \   000000E8   001097E5           LDR      R1,[R7, #+0]
   \   000000EC   0030A0E3           MOV      R3,#+0
   \   000000F0   011080E0           ADD      R1,R0,R1
   \   000000F4   4C0094E5           LDR      R0,[R4, #+76]
   \   000000F8   0820A0E1           MOV      R2,R8
   \   000000FC   790100EF           SWI      +377
   \   00000100   0110A0E3           MOV      R1,#+1
   \   00000104   581084E5           STR      R1,[R4, #+88]
   \   00000108   000050E3           CMP      R0,#+0
   \   0000010C   E0FFFF5A           BPL      ??send_answer_5
   \   00000110   7C8100EF           SWI      +33148
   \   00000114   F08FBDE8           POP      {R4-R11,PC}
    236              {
    237                //Передали меньше чем заказывали
    238          #ifdef SOCK_SEND_TIMER
    239                Top = this;
    240                GBS_StartTimerProc(&send_tmr, _tmr_second(5), _resend);
    241          #endif
    242                return; //Ждем сообщения ENIP_BUFFER_FREE1
    243              }    
    244            }
    245            
    246          #ifdef DEBUG  
    247            sprintf(logmsg,"sock data sended");
   \                     ??send_answer_6:
   \   00000118   1C109FE5           LDR      R1,??send_answer_0+0x10  ;; `?<Constant "sock data sended">`
   \   0000011C   ........           LDR      R0,??DataTable8  ;; logmsg
   \   00000120   160000EF           SWI      +22
    248            SMART_REDRAW();
   \   00000124   ........           _BLF     SMART_REDRAW,??SMART_REDRAW??rA
    249          #endif  
    250          }
   \   00000128   F08FBDE8           POP      {R4-R11,PC}      ;; return
   \                     ??send_answer_0:
   \   0000012C   ........           DC32     ??send_q_size
   \   00000130   ........           DC32     send_buf_len
   \   00000134   ........           DC32     send_buf
   \   00000138   ........           DC32     ALLTOTALSENDED
   \   0000013C   ........           DC32     `?<Constant "sock data sended">`

   \                                 In segment DATA_Z, align 4, align-sorted
   \                     ??send_q_size:
   \   00000000                      DS8 4
    251          
    252          //******************************************************************************
    253          

   \                                 In segment CODE, align 4, keep-with-next
    254          static int get_answer(CONNDATA *conn)
    255          {
   \                     get_answer:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
    256            static int recv_size;
    257            
    258            if (recv_buf == NULL)
   \   00000004   F8609FE5           LDR      R6,??get_answer_0  ;; recv_buf_len
   \   00000008   F8709FE5           LDR      R7,??get_answer_0+0x4  ;; recv_buf
   \   0000000C   F8809FE5           LDR      R8,??get_answer_0+0x8  ;; ??recv_size
   \   00000010   0040A0E1           MOV      R4,R0
   \   00000014   000097E5           LDR      R0,[R7, #+0]
   \   00000018   0050A0E3           MOV      R5,#+0
   \   0000001C   000050E3           CMP      R0,#+0
   \   00000020   0600001A           BNE      ??get_answer_1
    259            {
    260              recv_size = 0;
   \   00000024   005088E5           STR      R5,[R8, #+0]
    261              conn->TOTALRECEIVED = 0;
   \   00000028   6C5084E5           STR      R5,[R4, #+108]
    262              recv_buf = realloc(recv_buf, 4096);
   \   0000002C   401DA0E3           MOV      R1,#+4096
   \   00000030   BA0000EF           SWI      +186
   \   00000034   000087E5           STR      R0,[R7, #+0]
    263              recv_buf_len = 4096;
   \   00000038   400DA0E3           MOV      R0,#+4096
   \   0000003C   000086E5           STR      R0,[R6, #+0]
    264            }
    265            
    266            int n=recv(conn->sock, recv_buf+recv_size, 4096, 0);
   \                     ??get_answer_1:
   \   00000040   000098E5           LDR      R0,[R8, #+0]
   \   00000044   001097E5           LDR      R1,[R7, #+0]
    267            
    268            if (n==4096)
   \   00000048   C0809FE5           LDR      R8,??get_answer_0+0xC  ;; ALLTOTALRECEIVED
   \   0000004C   011080E0           ADD      R1,R0,R1
   \   00000050   4C0094E5           LDR      R0,[R4, #+76]
   \   00000054   0030A0E3           MOV      R3,#+0
   \   00000058   402DA0E3           MOV      R2,#+4096
   \   0000005C   780100EF           SWI      +376
   \   00000060   400D50E3           CMP      R0,#+4096
   \   00000064   0F00001A           BNE      ??get_answer_2
    269            {
    270              recv_buf = realloc(recv_buf, recv_buf_len + 4096);
   \   00000068   000096E5           LDR      R0,[R6, #+0]
   \   0000006C   401D80E2           ADD      R1,R0,#+4096
   \   00000070   000097E5           LDR      R0,[R7, #+0]
   \   00000074   BA0000EF           SWI      +186
   \   00000078   000087E5           STR      R0,[R7, #+0]
    271              recv_buf_len += 4096;
   \   0000007C   000096E5           LDR      R0,[R6, #+0]
   \   00000080   400D80E2           ADD      R0,R0,#+4096
   \   00000084   000086E5           STR      R0,[R6, #+0]
    272              conn->TOTALRECEIVED += n;
   \   00000088   6C0094E5           LDR      R0,[R4, #+108]
   \   0000008C   400D80E2           ADD      R0,R0,#+4096
   \   00000090   6C0084E5           STR      R0,[R4, #+108]
    273              ALLTOTALRECEIVED += n;
   \   00000094   000098E5           LDR      R0,[R8, #+0]
   \   00000098   400D80E2           ADD      R0,R0,#+4096
   \   0000009C   000088E5           STR      R0,[R8, #+0]
    274              return (0);
   \   000000A0   0000A0E3           MOV      R0,#+0
   \   000000A4   F081BDE8           POP      {R4-R8,PC}
    275             }
    276             
    277             else if (n >= 0 && n < 4096)//нихера не работает. Конечный размер данных брать из http заголовка.
   \                     ??get_answer_2:
   \   000000A8   ........           LDR      R2,??DataTable8  ;; logmsg
   \   000000AC   60109FE5           LDR      R1,??get_answer_0+0x10  ;; `?<Constant "recv ok">`
   \   000000B0   000050E3           CMP      R0,#+0
   \   000000B4   0D00004A           BMI      ??get_answer_3
   \   000000B8   400D50E3           CMP      R0,#+4096
   \   000000BC   0E0000AA           BGE      ??get_answer_4
    278             {
    279               conn->recv_mode = 0;//получены все данные
   \   000000C0   585084E5           STR      R5,[R4, #+88]
    280               conn->TOTALRECEIVED += n;
   \   000000C4   6C3094E5           LDR      R3,[R4, #+108]
   \   000000C8   033080E0           ADD      R3,R0,R3
   \   000000CC   6C3084E5           STR      R3,[R4, #+108]
    281               ALLTOTALRECEIVED += n;
   \   000000D0   003098E5           LDR      R3,[R8, #+0]
   \   000000D4   030080E0           ADD      R0,R0,R3
   \   000000D8   000088E5           STR      R0,[R8, #+0]
    282          #ifdef DEBUG     
    283               sprintf(logmsg,"recv ok");
   \   000000DC   0200A0E1           MOV      R0,R2
   \   000000E0   160000EF           SWI      +22
    284               SMART_REDRAW();
   \   000000E4   ........           _BLF     SMART_REDRAW,??SMART_REDRAW??rA
    285          #endif     
    286               return (1);
   \   000000E8   0100A0E3           MOV      R0,#+1
   \   000000EC   F081BDE8           POP      {R4-R8,PC}
    287             }
    288             
    289             if (n < 0)
    290               sprintf(logmsg,"recv error!");
   \                     ??get_answer_3:
   \   000000F0   081081E2           ADD      R1,R1,#+8
   \   000000F4   0200A0E1           MOV      R0,R2
   \   000000F8   160000EF           SWI      +22
    291             
    292             return (-1);
   \                     ??get_answer_4:
   \   000000FC   0500E0E1           MVN      R0,R5
   \   00000100   F081BDE8           POP      {R4-R8,PC}       ;; return
   \                     ??get_answer_0:
   \   00000104   ........           DC32     recv_buf_len
   \   00000108   ........           DC32     recv_buf
   \   0000010C   ........           DC32     ??recv_size
   \   00000110   ........           DC32     ALLTOTALRECEIVED
   \   00000114   ........           DC32     `?<Constant "recv ok">`
    293          }

   \                                 In segment DATA_Z, align 4, align-sorted
   \                     ??recv_size:
   \   00000000                      DS8 4
    294          
    295          //******************************************************************************
    296          

   \                                 In segment CODE, align 4, keep-with-next
    297          void socket_msg_handler(GBS_MSG *msg)
    298          {
   \                     socket_msg_handler:
   \   00000000   F1472DE9           PUSH     {R0,R4-R10,LR}
    299            CONNDATA *conn=NULL;
    300            
    301            switch((int)msg->data0)
   \   00000004   74519FE5           LDR      R5,??socket_msg_handler_1  ;; disautorecconect
   \   00000008   ........           LDR      R6,??DataTable8  ;; logmsg
   \   0000000C   0C1095E5           LDR      R1,[R5, #+12]
   \   00000010   6C719FE5           LDR      R7,??socket_msg_handler_1+0x4  ;; `?<Constant "GPRS offline...">`
   \   00000014   0040A0E1           MOV      R4,R0
   \   00000018   0C2094E5           LDR      R2,[R4, #+12]
   \   0000001C   100094E5           LDR      R0,[R4, #+16]
   \   00000020   0180A0E3           MOV      R8,#+1
   \   00000024   0090A0E3           MOV      R9,#+0
   \   00000028   802052E2           SUBS     R2,R2,#+128
   \   0000002C   0900000A           BEQ      ??socket_msg_handler_2
   \   00000030   022052E2           SUBS     R2,R2,#+2
   \   00000034   0200000A           BEQ      ??socket_msg_handler_3
   \   00000038   122052E2           SUBS     R2,R2,#+18
   \   0000003C   1100000A           BEQ      ??socket_msg_handler_4
   \   00000040   180000EA           B        ??socket_msg_handler_5
    302            {
    303            case LMAN_DISCONNECT_IND:
    304              is_gprs_online=0;
   \                     ??socket_msg_handler_3:
   \   00000044   109085E5           STR      R9,[R5, #+16]
    305              sock_error_handler(GPRS_OFFLINE);
   \   00000048   0400A0E3           MOV      R0,#+4
   \   0000004C   31FF2FE1           BLX      R1
    306          #ifdef DEBUG     
    307              sprintf(logmsg,"GPRS offline...");
   \   00000050   0710A0E1           MOV      R1,R7
   \   00000054   380000EA           B        ??socket_msg_handler_6
    308              SMART_REDRAW();
    309          #endif    
    310              return;
    311            
    312            case LMAN_CONNECT_CNF:
    313              //start_vibra(VIBR_ON_CONNECT);
    314              sock_error_handler(GPRS_ONLINE);
   \                     ??socket_msg_handler_2:
   \   00000058   0500A0E3           MOV      R0,#+5
   \   0000005C   31FF2FE1           BLX      R1
    315              is_gprs_online=1;
    316                if (!disautorecconect)
   \   00000060   000095E5           LDR      R0,[R5, #+0]
   \   00000064   108085E5           STR      R8,[R5, #+16]
   \   00000068   000050E3           CMP      R0,#+0
   \   0000006C   F187BD18           POPNE    {R0,R4-R10,PC}
    317                {
    318          #ifdef DEBUG         
    319                  sprintf(logmsg,"GPRS online");
   \   00000070   101087E2           ADD      R1,R7,#+16
   \   00000074   0600A0E1           MOV      R0,R6
   \   00000078   160000EF           SWI      +22
    320                  SMART_REDRAW();
   \   0000007C   ........           _BLF     SMART_REDRAW,??SMART_REDRAW??rA
    321          #endif        
    322                  reconnect();
   \   00000080   ........           BL       reconnect
   \   00000084   F187BDE8           POP      {R0,R4-R10,PC}
    323                }
    324                return;
    325            
    326            case ENIP_DNR_HOST_BY_NAME:
    327              
    328              conn=CONNDATA_findByDNR((int)msg->data1);
   \                     ??socket_msg_handler_4:
   \   00000088   ........           _BLF     CONNDATA_findByDNR,??CONNDATA_findByDNR??rA
   \   0000008C   00A0B0E1           MOVS     R10,R0
    329              
    330              if (conn && conn->DNR_TRIES)
   \   00000090   60009015           LDRNE    R0,[R0, #+96]
   \   00000094   00005013           CMPNE    R0,#+0
   \   00000098   F187BD08           POPEQ    {R0,R4-R10,PC}
    331                connect_socket(NULL);
   \   0000009C   0000A0E3           MOV      R0,#+0
   \   000000A0   ........           BL       connect_socket
   \   000000A4   F187BDE8           POP      {R0,R4-R10,PC}
    332              
    333              return;
    334            }
    335            
    336            if (conn=CONNDATA_findBySock((int)msg->data1))//если наш сокет
   \                     ??socket_msg_handler_5:
   \   000000A8   ........           _BLF     CONNDATA_findBySock,??CONNDATA_findBySock??rA
   \   000000AC   00A0B0E1           MOVS     R10,R0
   \   000000B0   F187BD08           POPEQ    {R0,R4-R10,PC}
    337            {
    338              switch((int)msg->data0)
   \   000000B4   0C0094E5           LDR      R0,[R4, #+12]
   \   000000B8   8A0040E2           SUB      R0,R0,#+138
   \   000000BC   050050E3           CMP      R0,#+5
   \   000000C0   F187BD88           POPHI    {R0,R4-R10,PC}
   \   000000C4   011F8FE2           ADR      R1,??socket_msg_handler_0
   \   000000C8   0010D1E7           LDRB     R1,[R1, R0]
   \   000000CC   01F18FE0           ADD      PC,PC,R1, LSL #+2
   \                     ??socket_msg_handler_0:
   \   000000D0   14140901           DC8      +20,+20,+9,+1
   \   000000D4   2A1E0000           DC8      +42,+30,+0,+0
    339              {
    340                
    341              case ENIP_SOCK_CONNECTED:
    342                
    343                conn->sock_state = 1;
   \                     ??socket_msg_handler_7:
   \   000000D8   54808AE5           STR      R8,[R10, #+84]
    344                conn->recv_mode = 0;
   \   000000DC   58908AE5           STR      R9,[R10, #+88]
    345                send_answer(0,0,0,0);//resend 
   \   000000E0   0030A0E3           MOV      R3,#+0
   \   000000E4   0320A0E1           MOV      R2,R3
   \   000000E8   0210A0E1           MOV      R1,R2
   \   000000EC   0100A0E1           MOV      R0,R1
   \   000000F0   ........           BL       send_answer
   \   000000F4   F187BDE8           POP      {R0,R4-R10,PC}
    346                break;
    347              
    348              case ENIP_SOCK_DATA_READ:
    349                //Если посылали send
    350                if (conn->recv_mode == 1)
   \                     ??socket_msg_handler_8:
   \   000000F8   58009AE5           LDR      R0,[R10, #+88]
   \   000000FC   010050E3           CMP      R0,#+1
   \   00000100   F187BD18           POPNE    {R0,R4-R10,PC}
    351                {
    352                  if (get_answer(conn) == 1)
   \   00000104   0A00A0E1           MOV      R0,R10
   \   00000108   ........           BL       get_answer
   \   0000010C   010050E3           CMP      R0,#+1
   \   00000110   F187BD18           POPNE    {R0,R4-R10,PC}
    353                    sock_data_read_handler(conn);
   \   00000114   041095E5           LDR      R1,[R5, #+4]
   \   00000118   0A00A0E1           MOV      R0,R10
   \   0000011C   31FF2FE1           BLX      R1
   \   00000120   F187BDE8           POP      {R0,R4-R10,PC}
    354                }
    355                break;
    356              
    357              case ENIP_BUFFER_FREE:
    358              case ENIP_BUFFER_FREE1:
    359                //Досылаем очередь
    360                send_answer(0,0,0,0);
   \                     ??socket_msg_handler_9:
   \   00000124   0030A0E3           MOV      R3,#+0
   \   00000128   0320A0E1           MOV      R2,R3
   \   0000012C   0210A0E1           MOV      R1,R2
   \   00000130   0100A0E1           MOV      R0,R1
   \   00000134   ........           BL       send_answer
    361          #ifdef DEBUG       
    362                sprintf(logmsg,"ENIP_BUFFER_FREE");
   \   00000138   1C1087E2           ADD      R1,R7,#+28
   \                     ??socket_msg_handler_6:
   \   0000013C   0600A0E1           MOV      R0,R6
   \   00000140   160000EF           SWI      +22
    363                SMART_REDRAW();
   \   00000144   ........           _BLF     SMART_REDRAW,??SMART_REDRAW??rA
   \   00000148   F187BDE8           POP      {R0,R4-R10,PC}
    364          #endif      
    365                break;
    366          
    367              case ENIP_SOCK_REMOTE_CLOSED:
    368                //Закрыт со стороны сервера
    369                conn->recv_mode=0;
   \                     ??socket_msg_handler_10:
   \   0000014C   58908AE5           STR      R9,[R10, #+88]
    370                end_socket((int)msg->data1);
   \   00000150   100094E5           LDR      R0,[R4, #+16]
   \   00000154   ........           BL       end_socket
    371          #ifdef DEBUG      
    372                sprintf(logmsg,"Сервер закрыл соед.");
   \   00000158   301087E2           ADD      R1,R7,#+48
   \   0000015C   0600A0E1           MOV      R0,R6
   \   00000160   160000EF           SWI      +22
    373                SMART_REDRAW();
   \   00000164   ........           _BLF     SMART_REDRAW,??SMART_REDRAW??rA
    374          #endif      
    375                sock_remote_closed_handler((int)msg->data1);
   \   00000168   100094E5           LDR      R0,[R4, #+16]
   \   0000016C   081095E5           LDR      R1,[R5, #+8]
   \   00000170   0008A0E1           MOV      R0,R0, LSL #+16
   \   00000174   4008A0E1           MOV      R0,R0, ASR #+16
   \   00000178   31FF2FE1           BLX      R1
   \                     ??socket_msg_handler_11:
   \   0000017C   F187BDE8           POP      {R0,R4-R10,PC}   ;; return
   \                     ??socket_msg_handler_1:
   \   00000180   ........           DC32     disautorecconect
   \   00000184   ........           DC32     `?<Constant "GPRS offline...">`
    376                break;
    377              
    378              case ENIP_SOCK_CLOSED:
    379                //Закрыт вызовом closesocket
    380                //sprintf(logmsg,"Соединение закрыто вызовом closesocket");
    381                break;
    382              }
    383            }
    384          }

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable3:
   \   00000000   ........           DC32     disautorecconect + 24

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable4:
   \   00000000   ........           DC32     disautorecconect

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable8:
   \   00000000   ........           DC32     logmsg

   \                                 In segment DATA_ID, align 4, align-sorted
   \                     `?<Initializer for disautorecconect>`:
   \   00000000   00000000           DC32 0
   \                     `?<Initializer for sock_data_read_handler>`:
   \   00000004   00000000           DC32 0H
   \                     `?<Initializer for sock_remote_closed_handler>`:
   \   00000008   00000000           DC32 0H
   \                     `?<Initializer for sock_error_handler>`:
   \   0000000C   00000000           DC32 0H
   \                     `?<Initializer for is_gprs_online>`:
   \   00000010   01000000           DC32 1
   \                     `?<Initializer for __conn>`:
   \   00000014   00000000           DC8 0, 0, 0, 0
   \                     `?<Initializer for reconnect_tmr>`:
   \   00000018   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant "Waiting for GPRS up...">`:
   \   00000000   57616974696E       DC8 "Waiting for GPRS up..."
   \              6720666F7220
   \              475052532075
   \              702E2E2E00  
   \   00000017   00                 DC8 0
   \   00000018   436F6E6E6563       DC8 "Connect to: %s Using port: %d"
   \              7420746F3A20
   \              257320557369
   \              6E6720706F72
   \              743A20256400
   \   00000036   0000               DC8 0, 0
   \   00000038   576169742044       DC8 "Wait DNR.."
   \              4E522E2E00  
   \   00000043   00                 DC8 0
   \   00000044   444E52206F6B       DC8 "DNR ok!"
   \              2100        
   \   0000004C   536F636B6574       DC8 "Socket connected"
   \              20636F6E6E65
   \              6374656400  
   \   0000005D   000000             DC8 0, 0, 0
   \   00000060   436F6E6E6563       DC8 "Connect fault"
   \              74206661756C
   \              7400        
   \   0000006E   0000               DC8 0, 0
   \   00000070   4572726F7220       DC8 "Error Create Socket"
   \              437265617465
   \              20536F636B65
   \              7400        

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant "sock data sended">`:
   \   00000000   736F636B2064       DC8 "sock data sended"
   \              617461207365
   \              6E64656400  
   \   00000011   000000             DC8 0, 0, 0

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant "recv ok">`:
   \   00000000   72656376206F       DC8 "recv ok"
   \              6B00        
   \   00000008   726563762065       DC8 "recv error!"
   \              72726F722100

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant "GPRS offline...">`:
   \   00000000   47505253206F       DC8 "GPRS offline..."
   \              66666C696E65
   \              2E2E2E00    
   \   00000010   47505253206F       DC8 "GPRS online"
   \              6E6C696E6500
   \   0000001C   454E49505F42       DC8 "ENIP_BUFFER_FREE"
   \              55464645525F
   \              4652454500  
   \   0000002D   000000             DC8 0, 0, 0
   \   00000030   D1E5F0E2E5F0       DC8 "\321\345\360\342\345\360 \347\340\352\360\373\353 \361\356\345\344."
   \              20E7E0EAF0FB
   \              EB20F1EEE5E4
   \              2E00        
    385          

   Maximum stack usage in bytes:

     Function              CSTACK
     --------              ------
     connect_socket           40
     end_socket                8
     end_socket_work           4
     get_answer               24
     reconnect                 4
     reconnect_tmr_handler     4
     send_answer              36
     socket_msg_handler       36
     socket_work_init          0


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     socket_work_init                 20
     end_socket                       48
     end_socket_work                  40
     reconnect_tmr_handler            56
     reconnect                        28
     connect_socket                  512
     disautorecconect                 40
     send_answer                     320
     send_q_size                       4
     get_answer                      280
     recv_size                         4
     socket_msg_handler              392
     ??DataTable3                      4
     ??DataTable4                      4
     ??DataTable8                      4
     ?<Initializer for disautorecconect>
                                      40
     ?<Constant "Waiting for GPRS up...">
                                     132
     ?<Constant "sock data sended">   20
     ?<Constant "recv ok">            20
     ?<Constant "GPRS offline...">    68
      Others                         168

 
 1 852 bytes in segment CODE
   240 bytes in segment DATA_C
    40 bytes in segment DATA_I
    40 bytes in segment DATA_ID
     8 bytes in segment DATA_Z
    24 bytes in segment INITTAB
 
 1 708 bytes of CODE  memory (+ 168 bytes shared)
   280 bytes of CONST memory
    48 bytes of DATA  memory

Errors: none
Warnings: none

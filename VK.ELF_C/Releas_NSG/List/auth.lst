##############################################################################
#                                                                            #
# IAR ARM ANSI C/C++ Compiler V4.42A/W32 EVALUATION    14/Dec/2018  23:20:54 #
# Copyright 1999-2005 IAR Systems. All rights reserved.                      #
#                                                                            #
#    Cpu mode        =  interwork                                            #
#    Endian          =  little                                               #
#    Stack alignment =  4                                                    #
#    Source file     =  E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\auth.c                                     #
#    Command line    =  E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\auth.c -D NEWSGOLD -D DEVELOP -lCN         #
#                       E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\Releas_NSG\List\ -la                       #
#                       E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\Releas_NSG\List\ -o                        #
#                       E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\Releas_NSG\Obj\ -z9 --cpu_mode arm         #
#                       --endian little --cpu ARM926EJ-S --stack_align 4     #
#                       --interwork --diag_suppress Pe301 -e --fpu None      #
#                       --dlib_config E:\Users\alfinant\Documents\Siemens\IA #
#                       R\ARM\LIB\dl5tpainl8n.h -I                           #
#                       E:\Users\alfinant\Documents\Siemens\IAR\ARM\INC\     #
#                       --inline_threshold=2                                 #
#    List file       =  E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\Releas_NSG\List\auth.lst                   #
#    Object file     =  E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\Releas_NSG\Obj\auth.r79                    #
#                                                                            #
#                                                                            #
##############################################################################

E:\Users\alfinant\Documents\Siemens\alfinant\src_iar\VK.ELF_C\auth.c
      1          //стандартная авторизация
      2          #include "auth.h"
      3          #include <siemens\swilib.h>
      4          #include "vk_ipc.h"
      5          #include "anim_widget.h"
      6          #include "string_util.h"
      7          #include "dyn_images.h"
      8          
      9          #include "socket_work.h"
     10          #include "http.h"
     11          #include "cookie.h"
     12          #include "process.h"
     13          
     14          static int auth_mode=AUTH_STD;
     15          

   \                                 In segment DATA_Z, align 4, align-sorted
     16          static char tmp_url[256];
   \                     tmp_url:
   \   00000000                      DS8 256
     17          
     18          extern const char ipc_my_name[];
     19          extern IPC_REQ ipc;
     20          
     21          extern int CreateAccessDialog(char* url);
     22          extern int CreateLoginDialog(int flag);
     23          extern char logmsg[];
     24          extern const char DIR[];
     25          

   \                                 In segment CODE, align 4, keep-with-next
     26          void AuthFast()
     27          {
     28          
     29            
     30          }
   \                     AuthFast:
   \   00000000   1EFF2FE1           BX       LR               ;; return
     31          
     32          

   \                                 In segment CODE, align 4, keep-with-next
     33          void AuthStd()
     34          {
     35            extern char action_url[];
     36            extern char captcha_sid[];
     37            extern char email[];
     38            extern char pass[];
     39            extern int vk_com_parsed;
     40            
     41            char fname_token[128];
     42            int f;
     43            unsigned  err; 
     44            
     45            char *s;
     46            char post_data[128];
     47            char captcha_path[128];
     48          
     49            
     50            WSHDR ws;
     51            unsigned short wsbody[128];
     52           
     53             if (HTTP_STATUS==302)//перенаправление
   \                     AuthStd:
   \   00000000   DC039FE5           LDR      R0,??AuthStd_1+0x8  ;; HTTP_STATUS
   \   00000004   F04F2DE9           PUSH     {R4-R11,LR}
   \   00000008   D8B39FE5           LDR      R11,??AuthStd_1+0xC  ;; process
   \   0000000C   D8A39FE5           LDR      R10,??AuthStd_1+0x10  ;; `?<Constant "https://oauth.vk.com/...">`
   \   00000010   A6DF4DE2           SUB      SP,SP,#+664
   \   00000014   000090E5           LDR      R0,[R0, #+0]
   \   00000018   2E10A0E3           MOV      R1,#+46
   \   0000001C   401F81E3           ORR      R1,R1,#0x100
   \   00000020   010050E1           CMP      R0,R1
   \   00000024   0F00001A           BNE      ??AuthStd_2
     54             {    
     55               if (strcmp(HTTP_LOCATION, "/")==0)//перенаправление на главную страницу-это и есть признак входа
   \   00000028   C0439FE5           LDR      R4,??AuthStd_1+0x14  ;; HTTP_LOCATION
   \   0000002C   EA1F8FE2           ADR      R1,??AuthStd_1   ;; "/"
   \   00000030   0400A0E1           MOV      R0,R4
   \   00000034   190000EF           SWI      +25
   \   00000038   000050E3           CMP      R0,#+0
   \   0000003C   0700001A           BNE      ??AuthStd_3
     56               {
     57                 if (process==AUTH_SEND_LOGIN_PASS)
   \   00000040   00009BE5           LDR      R0,[R11, #+0]
   \   00000044   020050E3           CMP      R0,#+2
   \   00000048   E100001A           BNE      ??AuthStd_4
     58                 {
     59                   process=OAUTH_AUTHORIZE;
   \   0000004C   0400A0E3           MOV      R0,#+4
   \   00000050   00008BE5           STR      R0,[R11, #+0]
     60                   HttpSendReq("https://oauth.vk.com/authorize?client_id=5582937&display=mobile&scope=offline,status,notifications,messages,friends,wall,group,photos"
     61                          "&redirect_uri=https://oauth.vk.com/blank.html"
     62                            "&response_type=token&v=5.62");
   \   00000054   0A00A0E1           MOV      R0,R10
   \                     ??AuthStd_5:
   \   00000058   ........           _BLF     HttpSendReq,??HttpSendReq??rA
   \   0000005C   DC0000EA           B        ??AuthStd_4
     63                 }
     64               }
     65               else
     66                 HttpSendReq(HTTP_LOCATION);
   \                     ??AuthStd_3:
   \   00000060   0400A0E1           MOV      R0,R4
   \   00000064   FBFFFFEA           B        ??AuthStd_5
     67             }
     68             else
     69               if (HTTP_STATUS==200)
   \                     ??AuthStd_2:
   \   00000068   C80050E3           CMP      R0,#+200
   \   0000006C   D500001A           BNE      ??AuthStd_6
   \   00000070   7C939FE5           LDR      R9,??AuthStd_1+0x18  ;; recv_buf
   \   00000074   7C039FE5           LDR      R0,??AuthStd_1+0x1C  ;; HTTP_HEADER_LENGTH
   \   00000078   001099E5           LDR      R1,[R9, #+0]
   \   0000007C   000090E5           LDR      R0,[R0, #+0]
   \   00000080   00209BE5           LDR      R2,[R11, #+0]
   \   00000084   70639FE5           LDR      R6,??AuthStd_1+0x20  ;; ipc
   \   00000088   70739FE5           LDR      R7,??AuthStd_1+0x24  ;; ipc_my_name
   \   0000008C   010080E0           ADD      R0,R0,R1
   \   00000090   0940A0E3           MOV      R4,#+9
   \   00000094   424C84E3           ORR      R4,R4,#0x4200
   \   00000098   B050A0E3           MOV      R5,#+176
   \   0000009C   DE5C85E3           ORR      R5,R5,#0xDE00
   \   000000A0   0080A0E3           MOV      R8,#+0
   \   000000A4   501FA0E3           MOV      R1,#+320
   \   000000A8   012042E2           SUB      R2,R2,#+1
   \   000000AC   040052E3           CMP      R2,#+4
   \   000000B0   C700008A           BHI      ??AuthStd_4
   \   000000B4   013F8FE2           ADR      R3,??AuthStd_0
   \   000000B8   0230D3E7           LDRB     R3,[R3, R2]
   \   000000BC   03F18FE0           ADD      PC,PC,R3, LSL #+2
   \                     ??AuthStd_0:
   \   000000C0   0101577C           DC8      +1,+1,+87,+124
   \   000000C4   8C000000           DC8      +140,+0,+0,+0
     70               {
     71                 switch(process)
     72                 {
     73                 
     74                 case AUTH_PARSE_M_VK_COM_LOGIN:
     75                 case AUTH_SEND_LOGIN_PASS: 
     76                     
     77                   if ((s=strstr(recv_buf + HTTP_HEADER_LENGTH, "<form method=\"post\"")))
   \                     ??AuthStd_7:
   \   000000C8   0A1081E0           ADD      R1,R1,R10
   \   000000CC   180100EF           SWI      +280
   \   000000D0   0090B0E1           MOVS     R9,R0
   \   000000D4   4F00000A           BEQ      ??AuthStd_8
     78                   {
     79                     if((s=strstr(s, "https:")))//начало url
   \   000000D8   4E1F8AE2           ADD      R1,R10,#+312
   \   000000DC   180100EF           SWI      +280
   \   000000E0   0090B0E1           MOVS     R9,R0
   \   000000E4   4B00000A           BEQ      ??AuthStd_8
     80                     {
     81                       *strchr(s, '\"')='\0';//конец         
     82                       strcpy(action_url, s);
   \   000000E8   14439FE5           LDR      R4,??AuthStd_1+0x28  ;; action_url
   \   000000EC   2210A0E3           MOV      R1,#+34
   \   000000F0   180000EF           SWI      +24
   \   000000F4   0080C0E5           STRB     R8,[R0, #+0]
   \   000000F8   0910A0E1           MOV      R1,R9
   \   000000FC   0400A0E1           MOV      R0,R4
   \   00000100   1A0000EF           SWI      +26
     83          
     84                       if((s=strstr(s+strlen(action_url)+2, "<img id=\"captcha\"")))//проверяем на наличие капчи
   \   00000104   0400A0E1           MOV      R0,R4
   \   00000108   1B0000EF           SWI      +27
   \   0000010C   F4108AE2           ADD      R1,R10,#+244
   \   00000110   090080E0           ADD      R0,R0,R9
   \   00000114   020080E2           ADD      R0,R0,#+2
   \   00000118   180100EF           SWI      +280
   \   0000011C   0090B0E1           MOVS     R9,R0
   \   00000120   2400000A           BEQ      ??AuthStd_9
     85                       {
     86                         if((s=strstr(s, "src=\"")))
   \   00000124   EC108AE2           ADD      R1,R10,#+236
   \   00000128   180100EF           SWI      +280
   \   0000012C   0090B0E1           MOVS     R9,R0
   \   00000130   2000000A           BEQ      ??AuthStd_9
     87                         {
     88                           s+=5;
     89                           *strchr(s, '\"')='\0';//конец
   \   00000134   2210A0E3           MOV      R1,#+34
   \   00000138   059080E2           ADD      R9,R0,#+5
   \   0000013C   0900A0E1           MOV      R0,R9
   \   00000140   180000EF           SWI      +24
   \   00000144   0080C0E5           STRB     R8,[R0, #+0]
     90                           strcpy(captcha_path, s);
   \   00000148   0910A0E1           MOV      R1,R9
   \   0000014C   860F8DE2           ADD      R0,SP,#+536
   \   00000150   1A0000EF           SWI      +26
     91                           
     92                           if((s=strstr(s+strlen(captcha_path)+2, "value=\"")))
   \   00000154   860F8DE2           ADD      R0,SP,#+536
   \   00000158   1B0000EF           SWI      +27
   \   0000015C   E4108AE2           ADD      R1,R10,#+228
   \   00000160   090080E0           ADD      R0,R0,R9
   \   00000164   020080E2           ADD      R0,R0,#+2
   \   00000168   180100EF           SWI      +280
   \   0000016C   0090B0E1           MOVS     R9,R0
   \   00000170   1000000A           BEQ      ??AuthStd_9
     93                           {
     94                             s+=7;
     95                             *strchr(s, '\"')='\0';//конец
     96                             strcpy(captcha_sid, s);
     97                             
     98                             snprintf(tmp_url, 255, "https://m.vk.com%s", captcha_path);                
   \   00000174   8C429FE5           LDR      R4,??AuthStd_1+0x2C  ;; tmp_url
   \   00000178   2210A0E3           MOV      R1,#+34
   \   0000017C   079080E2           ADD      R9,R0,#+7
   \   00000180   0900A0E1           MOV      R0,R9
   \   00000184   180000EF           SWI      +24
   \   00000188   0080C0E5           STRB     R8,[R0, #+0]
   \   0000018C   78029FE5           LDR      R0,??AuthStd_1+0x30  ;; captcha_sid
   \   00000190   0910A0E1           MOV      R1,R9
   \   00000194   1A0000EF           SWI      +26
   \   00000198   863F8DE2           ADD      R3,SP,#+536
   \   0000019C   D0208AE2           ADD      R2,R10,#+208
   \   000001A0   FF10A0E3           MOV      R1,#+255
   \   000001A4   0400A0E1           MOV      R0,R4
   \   000001A8   1B0100EF           SWI      +283
     99                             process=AUTH_LOAD_CAPTCHA;
   \   000001AC   0300A0E3           MOV      R0,#+3
   \   000001B0   00008BE5           STR      R0,[R11, #+0]
    100                             HttpSendReq(tmp_url); //грузим каптчу
   \   000001B4   A9FFFFEA           B        ??AuthStd_3
    101                             return;
    102                           }
    103                         }
    104                       }
    105                       
    106                       vk_com_parsed=1;
   \                     ??AuthStd_9:
   \   000001B8   50029FE5           LDR      R0,??AuthStd_1+0x34  ;; vk_com_parsed
   \   000001BC   0110A0E3           MOV      R1,#+1
   \   000001C0   001080E5           STR      R1,[R0, #+0]
    107                       
    108                       if(process==AUTH_PARSE_M_VK_COM_LOGIN)
   \   000001C4   00009BE5           LDR      R0,[R11, #+0]
   \   000001C8   010050E3           CMP      R0,#+1
   \   000001CC   0D00001A           BNE      ??AuthStd_10
    109                       {
    110                         process=AUTH_SEND_LOGIN_PASS;
    111                         snprintf(post_data, 127, "email=%s&pass=%s", email, pass);
   \   000001D0   3C329FE5           LDR      R3,??AuthStd_1+0x38  ;; email
   \   000001D4   0200A0E3           MOV      R0,#+2
   \   000001D8   00008BE5           STR      R0,[R11, #+0]
   \   000001DC   34029FE5           LDR      R0,??AuthStd_1+0x3C  ;; pass
   \   000001E0   422F8AE2           ADD      R2,R10,#+264
   \   000001E4   01002DE9           PUSH     {R0}
   \   000001E8   7F10A0E3           MOV      R1,#+127
   \   000001EC   670F8DE2           ADD      R0,SP,#+412
   \   000001F0   1B0100EF           SWI      +283
    112                         HttpSendPostReq(action_url, post_data); 
   \   000001F4   671F8DE2           ADD      R1,SP,#+412
   \   000001F8   0400A0E1           MOV      R0,R4
   \   000001FC   ........           _BLF     HttpSendPostReq,??HttpSendPostReq??rA
    113                         return;
   \   00000200   04D08DE2           ADD      SP,SP,#+4
   \   00000204   720000EA           B        ??AuthStd_4
    114                       }
    115                       
    116                       AnimWidget_Close();
   \                     ??AuthStd_10:
   \   00000208   ........           _BLF     AnimWidget_Close,??AnimWidget_Close??rA
    117                       ShowMSG(1, (int)"Неверный логин или пароль");
   \   0000020C   471F8AE2           ADD      R1,R10,#+284
   \   00000210   0100A0E3           MOV      R0,#+1
   \   00000214   480100EF           SWI      +328
    118                     }
    119                   }
    120                   AnimWidget_Close();
   \                     ??AuthStd_8:
   \   00000218   ........           _BLF     AnimWidget_Close,??AnimWidget_Close??rA
   \   0000021C   6C0000EA           B        ??AuthStd_4
    121                   break;
    122                 
    123                 case AUTH_LOAD_CAPTCHA:
    124                   
    125                   if (stricmp(HTTP_CONTENT_TYPE, "image/jpeg")==0)
   \                     ??AuthStd_11:
   \   00000220   F4019FE5           LDR      R0,??AuthStd_1+0x40  ;; HTTP_CONTENT_TYPE
   \   00000224   551F8AE2           ADD      R1,R10,#+340
   \   00000228   ........           _BLF     stricmp,??stricmp??rA
   \   0000022C   000050E3           CMP      R0,#+0
   \   00000230   6700001A           BNE      ??AuthStd_4
    126                   {
    127                     CreateLocalWS(&ws, wsbody, 127);
   \   00000234   7F20A0E3           MOV      R2,#+127
   \   00000238   18108DE2           ADD      R1,SP,#+24
   \   0000023C   04008DE2           ADD      R0,SP,#+4
   \   00000240   270100EF           SWI      +295
    128                     wsprintf(&ws, "jpg");
   \   00000244   651F8FE2           ADR      R1,??AuthStd_1+0x4  ;; "jpg"
   \   00000248   04008DE2           ADD      R0,SP,#+4
   \   0000024C   240100EF           SWI      +292
    129          #ifdef ELKA           
    130                     CreateDynImage(130, 50, GetExtUid_ws(&ws), 0, recv_buf+HTTP_HEADER_LENGTH, HTTP_CONTENT_LENGTH);//индех капчи 0
    131          #else
    132                     CreateDynImage(124, 35, GetExtUid_ws(&ws), 0, recv_buf+HTTP_HEADER_LENGTH, HTTP_CONTENT_LENGTH);//ограничим разрешение капчи, иначе можем сломать editcontrol    
   \   00000250   04008DE2           ADD      R0,SP,#+4
   \   00000254   D00100EF           SWI      +464
   \   00000258   0020A0E1           MOV      R2,R0
   \   0000025C   BC019FE5           LDR      R0,??AuthStd_1+0x44  ;; HTTP_CONTENT_LENGTH
   \   00000260   0030A0E3           MOV      R3,#+0
   \   00000264   000090E5           LDR      R0,[R0, #+0]
   \   00000268   01002DE9           PUSH     {R0}
   \   0000026C   001099E5           LDR      R1,[R9, #+0]
   \   00000270   80019FE5           LDR      R0,??AuthStd_1+0x1C  ;; HTTP_HEADER_LENGTH
   \   00000274   000090E5           LDR      R0,[R0, #+0]
   \   00000278   010080E0           ADD      R0,R0,R1
   \   0000027C   01002DE9           PUSH     {R0}
   \   00000280   2310A0E3           MOV      R1,#+35
   \   00000284   7C00A0E3           MOV      R0,#+124
   \   00000288   ........           _BLF     CreateDynImage,??CreateDynImage??rA
    133          #endif           
    134                     ipc.name_to=ipc_my_name;
   \   0000028C   007086E5           STR      R7,[R6, #+0]
    135                     ipc.name_from=ipc_my_name;
   \   00000290   047086E5           STR      R7,[R6, #+4]
    136                     ipc.data=0;
   \   00000294   088086E5           STR      R8,[R6, #+8]
    137                     GBS_SendMessage(MMI_CEPID, MSG_IPC, IPC_SHOW_CAPTCHA, &ipc);
   \   00000298   0630A0E1           MOV      R3,R6
   \   0000029C   0220A0E3           MOV      R2,#+2
   \   000002A0   0510A0E1           MOV      R1,R5
   \   000002A4   0400A0E1           MOV      R0,R4
   \   000002A8   000100EF           SWI      +256
   \   000002AC   08D08DE2           ADD      SP,SP,#+8
   \   000002B0   470000EA           B        ??AuthStd_4
    138                   }
    139                   break;
    140                 
    141                 case OAUTH_AUTHORIZE:
    142                   
    143                   if (s=strstr(recv_buf + HTTP_HEADER_LENGTH, "<form method=\"post\""))
   \                     ??AuthStd_12:
   \   000002B4   0A1081E0           ADD      R1,R1,R10
   \   000002B8   180100EF           SWI      +280
   \   000002BC   0090B0E1           MOVS     R9,R0
   \   000002C0   0B00000A           BEQ      ??AuthStd_13
    144                   {
    145                     process=0;
   \   000002C4   00808BE5           STR      R8,[R11, #+0]
    146                     AnimWidget_Close();
   \   000002C8   ........           _BLF     AnimWidget_Close,??AnimWidget_Close??rA
    147                     s=strstr(s, "https:");//начало url
   \   000002CC   4E1F8AE2           ADD      R1,R10,#+312
   \   000002D0   0900A0E1           MOV      R0,R9
   \   000002D4   180100EF           SWI      +280
   \   000002D8   0090A0E1           MOV      R9,R0
    148                     *strchr(s, '\"')='\0';//конец
   \   000002DC   2210A0E3           MOV      R1,#+34
   \   000002E0   180000EF           SWI      +24
   \   000002E4   0080C0E5           STRB     R8,[R0, #+0]
    149                     CreateAccessDialog(s);
   \   000002E8   0900A0E1           MOV      R0,R9
   \   000002EC   ........           _BLF     CreateAccessDialog,??CreateAccessDialog??rA
    150                     return;
   \   000002F0   370000EA           B        ??AuthStd_4
    151                   }
    152                 
    153                 case OAUTH_GET_TOKEN:
    154                   
    155                   if (s=strstr(HTTP_URL, "error="))
   \                     ??AuthStd_13:
   \   000002F4   28B19FE5           LDR      R11,??AuthStd_1+0x48  ;; HTTP_URL
   \   000002F8   5E1F8AE2           ADD      R1,R10,#+376
   \   000002FC   0B00A0E1           MOV      R0,R11
   \   00000300   180100EF           SWI      +280
   \   00000304   0090B0E1           MOVS     R9,R0
    156                     ShowMSG(1, (int)s+6);
   \   00000308   06108012           ADDNE    R1,R0,#+6
   \   0000030C   2E00001A           BNE      ??AuthStd_14
    157                   else
    158                     if (s=strstr(HTTP_URL, "access_token="))
   \   00000310   5A1F8AE2           ADD      R1,R10,#+360
   \   00000314   0B00A0E1           MOV      R0,R11
   \   00000318   180100EF           SWI      +280
   \   0000031C   0090B0E1           MOVS     R9,R0
   \   00000320   2B00000A           BEQ      ??AuthStd_4
    159                     {
    160                       snprintf(fname_token, 127, "%stoken", DIR);
   \   00000324   FC309FE5           LDR      R3,??AuthStd_1+0x4C  ;; DIR
   \   00000328   582F8AE2           ADD      R2,R10,#+352
   \   0000032C   7F10A0E3           MOV      R1,#+127
   \   00000330   460F8DE2           ADD      R0,SP,#+280
   \   00000334   1B0100EF           SWI      +283
    161                       if((f=fopen(fname_token, A_ReadWrite+A_Create+A_Truncate+A_BIN, P_WRITE+P_READ, &err))!=-1)
   \   00000338   0D30A0E1           MOV      R3,SP
   \   0000033C   602FA0E3           MOV      R2,#+384
   \   00000340   0210A0E3           MOV      R1,#+2
   \   00000344   831C81E3           ORR      R1,R1,#0x8300
   \   00000348   460F8DE2           ADD      R0,SP,#+280
   \   0000034C   0A0000EF           SWI      +10
   \   00000350   00A0A0E1           MOV      R10,R0
   \   00000354   01007AE3           CMN      R10,#+1
   \   00000358   0E00000A           BEQ      ??AuthStd_15
    162                       {
    163                         s+=13;
    164                         *strchr(s, '&')='\0';
   \   0000035C   2610A0E3           MOV      R1,#+38
   \   00000360   0D9089E2           ADD      R9,R9,#+13
   \   00000364   0900A0E1           MOV      R0,R9
   \   00000368   180000EF           SWI      +24
   \   0000036C   0080C0E5           STRB     R8,[R0, #+0]
    165                         fwrite(f, s, strlen(s), &err);
   \   00000370   0900A0E1           MOV      R0,R9
   \   00000374   1B0000EF           SWI      +27
   \   00000378   0D30A0E1           MOV      R3,SP
   \   0000037C   0020A0E1           MOV      R2,R0
   \   00000380   0910A0E1           MOV      R1,R9
   \   00000384   0A00A0E1           MOV      R0,R10
   \   00000388   0C0000EF           SWI      +12
    166                         fclose(f, &err);
   \   0000038C   0D10A0E1           MOV      R1,SP
   \   00000390   0A00A0E1           MOV      R0,R10
   \   00000394   0D0000EF           SWI      +13
    167                       }
    168                     
    169                       AnimWidget_Close();
   \                     ??AuthStd_15:
   \   00000398   ........           _BLF     AnimWidget_Close,??AnimWidget_Close??rA
    170                       vk_com_parsed=0;
   \   0000039C   6C009FE5           LDR      R0,??AuthStd_1+0x34  ;; vk_com_parsed
    171                       //ShowMSG(1,(int)"Ключ доступа получен");
    172                       
    173                       ipc.name_to=ipc_my_name;
   \   000003A0   007086E5           STR      R7,[R6, #+0]
   \   000003A4   008080E5           STR      R8,[R0, #+0]
    174                       ipc.name_from=ipc_my_name;
   \   000003A8   047086E5           STR      R7,[R6, #+4]
    175                       ipc.data=s;//token
   \   000003AC   089086E5           STR      R9,[R6, #+8]
    176                       GBS_SendMessage(MMI_CEPID, MSG_IPC, IPC_TOKEN_READED, &ipc);            
   \   000003B0   0630A0E1           MOV      R3,R6
   \   000003B4   0320A0E3           MOV      R2,#+3
   \   000003B8   0510A0E1           MOV      R1,R5
   \   000003BC   0400A0E1           MOV      R0,R4
   \   000003C0   000100EF           SWI      +256
   \   000003C4   020000EA           B        ??AuthStd_4
    177                     }      
    178                   break;
    179                   
    180                 }//switch
    181                 
    182               }//200
    183             else
    184             {
    185               ShowMSG(1,(int)"ERROR: HTTP UNK STATUS");     
   \                     ??AuthStd_6:
   \   000003C8   601F8AE2           ADD      R1,R10,#+384
   \                     ??AuthStd_14:
   \   000003CC   0100A0E3           MOV      R0,#+1
   \   000003D0   480100EF           SWI      +328
   \                     ??AuthStd_4:
   \   000003D4   A6DF8DE2           ADD      SP,SP,#+664      ;; stack cleaning
   \   000003D8   F08FBDE8           POP      {R4-R11,PC}      ;; return
   \                     ??AuthStd_1:
   \   000003DC   2F000000           DC8      "/",+0,+0
   \   000003E0   6A706700           DC8      "jpg"
   \   000003E4   ........           DC32     HTTP_STATUS
   \   000003E8   ........           DC32     process
   \   000003EC   ........           DC32     `?<Constant "https://oauth.vk.com/...">`
   \   000003F0   ........           DC32     HTTP_LOCATION
   \   000003F4   ........           DC32     recv_buf
   \   000003F8   ........           DC32     HTTP_HEADER_LENGTH
   \   000003FC   ........           DC32     ipc
   \   00000400   ........           DC32     ipc_my_name
   \   00000404   ........           DC32     action_url
   \   00000408   ........           DC32     tmp_url
   \   0000040C   ........           DC32     captcha_sid
   \   00000410   ........           DC32     vk_com_parsed
   \   00000414   ........           DC32     email
   \   00000418   ........           DC32     pass
   \   0000041C   ........           DC32     HTTP_CONTENT_TYPE
   \   00000420   ........           DC32     HTTP_CONTENT_LENGTH
   \   00000424   ........           DC32     HTTP_URL
   \   00000428   ........           DC32     DIR
    186             }
    187          }
    188          

   \                                 In segment CODE, align 4, keep-with-next
    189          void AuthProcess()
    190          {
    191            if (auth_mode==AUTH_FAST)
    192              AuthFast();
    193            else
    194              if (auth_mode==AUTH_STD)
    195                AuthStd();
   \                     AuthProcess:
   \   00000000   ........           B        AuthStd          ;; tailcall
    196          }

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant "https://oauth.vk.com/...">`:
   \   00000000   68747470733A       DC8 68H, 74H, 74H, 70H, 73H, 3AH, 2FH, 2FH
   \              2F2F        
   \   00000008   6F617574682E       DC8 6FH, 61H, 75H, 74H, 68H, 2EH, 76H, 6BH
   \              766B        
   \   00000010   2E636F6D2F61       DC8 2EH, 63H, 6FH, 6DH, 2FH, 61H, 75H, 74H
   \              7574        
   \   00000018   686F72697A65       DC8 68H, 6FH, 72H, 69H, 7AH, 65H, 3FH, 63H
   \              3F63        
   \   00000020   6C69656E745F       DC8 6CH, 69H, 65H, 6EH, 74H, 5FH, 69H, 64H
   \              6964        
   \   00000028   3D3535383239       DC8 3DH, 35H, 35H, 38H, 32H, 39H, 33H, 37H
   \              3337        
   \   00000030   26646973706C       DC8 26H, 64H, 69H, 73H, 70H, 6CH, 61H, 79H
   \              6179        
   \   00000038   3D6D6F62696C       DC8 3DH, 6DH, 6FH, 62H, 69H, 6CH, 65H, 26H
   \              6526        
   \   00000040   73636F70653D       DC8 73H, 63H, 6FH, 70H, 65H, 3DH, 6FH, 66H
   \              6F66        
   \   00000048   666C696E652C       DC8 66H, 6CH, 69H, 6EH, 65H, 2CH, 73H, 74H
   \              7374        
   \   00000050   617475732C6E       DC8 61H, 74H, 75H, 73H, 2CH, 6EH, 6FH, 74H
   \              6F74        
   \   00000058   696669636174       DC8 69H, 66H, 69H, 63H, 61H, 74H, 69H, 6FH
   \              696F        
   \   00000060   6E732C6D6573       DC8 6EH, 73H, 2CH, 6DH, 65H, 73H, 73H, 61H
   \              7361        
   \   00000068   6765732C6672       DC8 67H, 65H, 73H, 2CH, 66H, 72H, 69H, 65H
   \              6965        
   \   00000070   6E64732C7761       DC8 6EH, 64H, 73H, 2CH, 77H, 61H, 6CH, 6CH
   \              6C6C        
   \   00000078   2C67726F7570       DC8 2CH, 67H, 72H, 6FH, 75H, 70H, 2CH, 70H
   \              2C70        
   \   00000080   686F746F7326       DC8 68H, 6FH, 74H, 6FH, 73H, 26H, 72H, 65H
   \              7265        
   \   00000088   646972656374       DC8 64H, 69H, 72H, 65H, 63H, 74H, 5FH, 75H
   \              5F75        
   \   00000090   72693D687474       DC8 72H, 69H, 3DH, 68H, 74H, 74H, 70H, 73H
   \              7073        
   \   00000098   3A2F2F6F6175       DC8 3AH, 2FH, 2FH, 6FH, 61H, 75H, 74H, 68H
   \              7468        
   \   000000A0   2E766B2E636F       DC8 2EH, 76H, 6BH, 2EH, 63H, 6FH, 6DH, 2FH
   \              6D2F        
   \   000000A8   626C616E6B2E       DC8 62H, 6CH, 61H, 6EH, 6BH, 2EH, 68H, 74H
   \              6874        
   \   000000B0   6D6C26726573       DC8 6DH, 6CH, 26H, 72H, 65H, 73H, 70H, 6FH
   \              706F        
   \   000000B8   6E73655F7479       DC8 6EH, 73H, 65H, 5FH, 74H, 79H, 70H, 65H
   \              7065        
   \   000000C0   3D746F6B656E       DC8 3DH, 74H, 6FH, 6BH, 65H, 6EH, 26H, 76H
   \              2676        
   \   000000C8   3D352E363200       DC8 3DH, 35H, 2EH, 36H, 32H, 0
   \   000000CE   0000               DC8 0, 0
   \   000000D0   68747470733A       DC8 "https://m.vk.com%s"
   \              2F2F6D2E766B
   \              2E636F6D2573
   \              00          
   \   000000E3   00                 DC8 0
   \   000000E4   76616C75653D       DC8 "value=\""
   \              2200        
   \   000000EC   7372633D2200       DC8 "src=\""
   \   000000F2   0000               DC8 0, 0
   \   000000F4   3C696D672069       DC8 "<img id=\"captcha\""
   \              643D22636170
   \              746368612200
   \   00000106   0000               DC8 0, 0
   \   00000108   656D61696C3D       DC8 "email=%s&pass=%s"
   \              257326706173
   \              733D257300  
   \   00000119   000000             DC8 0, 0, 0
   \   0000011C   CDE5E2E5F0ED       DC8 "\315\345\342\345\360\355\373\351 \353\356\343\350\355 \350\353\350 \357\340\360\356\353\374"
   \              FBE920EBEEE3
   \              E8ED20E8EBE8
   \              20EFE0F0EEEB
   \              FC00        
   \   00000136   0000               DC8 0, 0
   \   00000138   68747470733A       DC8 "https:"
   \              00          
   \   0000013F   00                 DC8 0
   \   00000140   3C666F726D20       DC8 "<form method=\"post\""
   \              6D6574686F64
   \              3D22706F7374
   \              2200        
   \   00000154   696D6167652F       DC8 "image/jpeg"
   \              6A70656700  
   \   0000015F   00                 DC8 0
   \   00000160   2573746F6B65       DC8 "%stoken"
   \              6E00        
   \   00000168   616363657373       DC8 "access_token="
   \              5F746F6B656E
   \              3D00        
   \   00000176   0000               DC8 0, 0
   \   00000178   6572726F723D       DC8 "error="
   \              00          
   \   0000017F   00                 DC8 0
   \   00000180   4552524F523A       DC8 "ERROR: HTTP UNK STATUS"
   \              204854545020
   \              554E4B205354
   \              4154555300  
   \   00000197   00                 DC8 0

   \                                 In segment DATA_C, align 1, align-sorted
   \   00000000   2F00               DC8 "/"

   \                                 In segment DATA_C, align 4, align-sorted
   \   00000000   6A706700           DC8 "jpg"

   Maximum stack usage in bytes:

     Function    CSTACK
     --------    ------
     AuthFast        0
     AuthProcess     4
     AuthStd       708


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     tmp_url                         256
     AuthFast                          4
     AuthStd                        1068
     AuthProcess                       4
     ?<Constant "https://oauth.vk.com/...">
                                     408
     ?<Constant "/">                   2
     ?<Constant "jpg">                 4
      Others                          96

 
 1 160 bytes in segment CODE
   414 bytes in segment DATA_C
   256 bytes in segment DATA_Z
    12 bytes in segment INITTAB
 
 1 076 bytes of CODE  memory (+ 96 bytes shared)
   414 bytes of CONST memory
   256 bytes of DATA  memory

Errors: none
Warnings: none

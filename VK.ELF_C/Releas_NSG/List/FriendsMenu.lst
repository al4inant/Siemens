##############################################################################
#                                                                            #
# IAR ARM ANSI C/C++ Compiler V4.42A/W32 EVALUATION    01/Nov/2018  21:43:40 #
# Copyright 1999-2005 IAR Systems. All rights reserved.                      #
#                                                                            #
#    Cpu mode        =  interwork                                            #
#    Endian          =  little                                               #
#    Stack alignment =  4                                                    #
#    Source file     =  E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\FriendsMenu.c                              #
#    Command line    =  E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\FriendsMenu.c -D NEWSGOLD -D DEVELOP -lCN  #
#                       E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\Releas_NSG\List\ -la                       #
#                       E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\Releas_NSG\List\ -o                        #
#                       E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\Releas_NSG\Obj\ -z9 --cpu_mode arm         #
#                       --endian little --cpu ARM926EJ-S --stack_align 4     #
#                       --interwork --diag_suppress Pe301 -e --fpu None      #
#                       --dlib_config E:\Users\alfinant\Documents\Siemens\IA #
#                       R\ARM\LIB\dl5tpainl8n.h -I                           #
#                       E:\Users\alfinant\Documents\Siemens\IAR\ARM\INC\     #
#                       --inline_threshold=2                                 #
#    List file       =  E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\Releas_NSG\List\FriendsMenu.lst            #
#    Object file     =  E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\Releas_NSG\Obj\FriendsMenu.r79             #
#                                                                            #
#                                                                            #
##############################################################################

E:\Users\alfinant\Documents\Siemens\alfinant\src_iar\VK.ELF_C\FriendsMenu.c
      1          #include <siemens\swilib.h>
      2          #include "rect_patcher.h"

   \                                 In segment CODE, align 4, keep-with-next
   \   __??Code32?? __code __interwork __atpcs void patch_header(HEADER_DESC const *)
   \                     patch_header:
   \   00000000   10402DE9           PUSH     {R4,LR}
   \   00000004   0040A0E1           MOV      R4,R0
   \   00000008   0000A0E3           MOV      R0,#+0
   \   0000000C   B000C4E1           STRH     R0,[R4, #+0]
   \   00000010   B200C4E1           STRH     R0,[R4, #+2]
   \   00000014   888100EF           SWI      +33160
   \   00000018   010040E2           SUB      R0,R0,#+1
   \   0000001C   B400C4E1           STRH     R0,[R4, #+4]
   \   00000020   8A8100EF           SWI      +33162
   \   00000024   010040E2           SUB      R0,R0,#+1
   \   00000028   B600C4E1           STRH     R0,[R4, #+6]
   \   0000002C   1080BDE8           POP      {R4,PC}          ;; return
      3          #include "dyn_images.h"
      4          #include "dyn_theme.h"
      5          #include "socket_work.h"
      6          #include "http.h"
      7          #include "process.h"
      8          #include "vk_api.h"
      9          #include "main.h"
     10          #include "chat.h"
     11          #include "anim_widget.h"
     12          

   \                                 In segment DATA_C, align 4, align-sorted
     13          static const char percent_t[]="%t";
   \                     percent_t:
   \   00000000   257400             DC8 "%t"
   \   00000003   00                 DC8 0
   \   00000004   6D6F62696C65       DC8 "mobile"
   \              00          
   \   0000000B   00                 DC8 0
   \   0000000C   70686F746F5F       DC8 "photo_50"
   \              353000      
   \   00000015   000000             DC8 0, 0, 0
   \   00000018   C4F0F3E7FCFF       DC8 "\304\360\363\347\374\377"
   \              00          
   \   0000001F   00                 DC8 0

   \                                 In segment DATA_C, align 1, align-sorted
     14          static const char percent_d[]="%d";
   \                     percent_d:
   \   00000000   256400             DC8 "%d"
     15          static const char HEADER_TEXT[]="Друзья";
     16          
     17          extern int CreateDebugGUI();
     18          

   \                                 In segment DATA_I, align 4, align-sorted
     19          static HEADER_DESC hdr={0,0,0,0,NULL,NULL,LGP_NULL};
   \                     hdr:
   \   00000000                      DS8 20
   \   00000014                      REQUIRE `?<Initializer for hdr>`

   \                                 In segment DATA_Z, align 4, align-sorted
     20          static WSHDR* hdr_ws=NULL;
   \                     hdr_ws:
   \   00000000                      DS8 4
     21          

   \                                 In segment DATA_C, align 4, align-sorted
     22          static const int menusoftkeys[]={0,1,2};
   \                     menusoftkeys:
   \   00000000   000000000100       DC32 0, 1, 2
   \              000002000000
     23          

   \                                 In segment DATA_I, align 4, align-sorted
     24          static SOFTKEY_DESC sk[]=
   \                     sk:
   \   00000000                      DS8 24
   \   00000018                      REQUIRE `?<Initializer for sk>`
     25          {
     26            {0x0018,0x0000,(int)"Еще+50"},
     27            {0x0001,0x0000, (int)"Назад"},
     28            {0x003D,0x0000,(int)LGP_DOIT_PIC}
     29          };
     30          

   \                                 In segment DATA_I, align 4, align-sorted
     31          static SOFTKEYSTAB skt=
   \                     skt:
   \   00000000                      DS8 8
   \   00000008                      REQUIRE `?<Initializer for skt>`
     32          {
     33            sk,0
     34          };
     35          

   \                                 In segment CODE, align 4, keep-with-next
     36          static int items_menu_onkey(void *gui, GUI_MSG *msg)
     37          {
   \                     items_menu_onkey:
   \   00000000   30402DE9           PUSH     {R4,R5,LR}
     38            CLIST* c;
     39            CLIST* c2;
     40            int i;
     41            
     42            if ((msg->gbsmsg->msg==KEY_DOWN)||(msg->gbsmsg->msg==LONG_PRESS))
   \   00000004   041091E5           LDR      R1,[R1, #+4]
   \   00000008   9330A0E3           MOV      R3,#+147
   \   0000000C   042091E5           LDR      R2,[R1, #+4]
   \   00000010   403F83E3           ORR      R3,R3,#0x100
   \   00000014   030052E1           CMP      R2,R3
   \   00000018   02308312           ADDNE    R3,R3,#+2
   \   0000001C   03005211           CMPNE    R2,R3
   \   00000020   1800001A           BNE      ??items_menu_onkey_0
     43            {
     44              switch(msg->gbsmsg->submess)
   \   00000024   ........           LDR      R4,??DataTable11  ;; csm
   \   00000028   081091E5           LDR      R1,[R1, #+8]
   \   0000002C   002094E5           LDR      R2,[R4, #+0]
   \   00000030   011051E2           SUBS     R1,R1,#+1
   \   00000034   1700000A           BEQ      ??items_menu_onkey_1
   \   00000038   031051E2           SUBS     R1,R1,#+3
   \   0000003C   2B00000A           BEQ      ??items_menu_onkey_2
   \   00000040   071051E2           SUBS     R1,R1,#+7
   \   00000044   1100000A           BEQ      ??items_menu_onkey_3
   \   00000048   0F1051E2           SUBS     R1,R1,#+15
   \   0000004C   0D00001A           BNE      ??items_menu_onkey_0
     45              {
     46              case UP_BUTTON:
     47                break;
     48                
     49              case ENTER_BUTTON:
     50                i=GetCurMenuItem(gui);
   \   00000050   8F0100EF           SWI      +399
     51                c=FindContactByN(csm->friends_list, i);
   \   00000054   0010A0E1           MOV      R1,R0
   \   00000058   000094E5           LDR      R0,[R4, #+0]
   \   0000005C   500090E5           LDR      R0,[R0, #+80]
   \   00000060   ........           _BLF     FindContactByN,??FindContactByN??rA
   \   00000064   0050A0E1           MOV      R5,R0
     52                if (c2=FindContactById(csm->dialogs_list, c->user_id))
   \   00000068   000094E5           LDR      R0,[R4, #+0]
   \   0000006C   141095E5           LDR      R1,[R5, #+20]
   \   00000070   4C0090E5           LDR      R0,[R0, #+76]
   \   00000074   ........           _BLF     FindContactById,??FindContactById??rA
   \   00000078   000050E3           CMP      R0,#+0
     53                  c=c2;
   \   0000007C   0050A011           MOVNE    R5,R0
     54                CreateChat(c); 
   \   00000080   0500A0E1           MOV      R0,R5
   \   00000084   ........           _BLF     CreateChat,??CreateChat??rA
     55                break;
     56              
     57              case GREEN_BUTTON:
     58          #ifdef DEVELOP      
     59                CreateDebugGUI();
     60          #endif
     61              break;
     62              
     63              case LEFT_SOFT:
     64                if (process==0)
     65                {
     66                  sock_keepalive=1;
     67                  process=LOAD_FRIENDS;
     68                  int count=CLIST_GetCount(csm->friends_list);
     69                  SUBPROC((void *)HttpSendReq, friends_get(50, count, "mobile", "photo_50"));
     70                  AnimWidget_Wait_headline();
     71                }
     72              break;
     73              
     74              case RIGHT_SOFT:
     75                csm->friends_menu_gui_id=NULL;
     76                return(1);//close
     77              }
     78            }
     79            return (0); 
   \                     ??items_menu_onkey_0:
   \   00000088   0000A0E3           MOV      R0,#+0
   \   0000008C   3080BDE8           POP      {R4,R5,PC}       ;; return
   \                     ??items_menu_onkey_3:
   \   00000090   ........           _BLF     CreateDebugGUI,??CreateDebugGUI??rA
   \   00000094   FBFFFFEA           B        ??items_menu_onkey_0
   \                     ??items_menu_onkey_1:
   \   00000098   ........           LDR      R0,??DataTable9  ;; process
   \   0000009C   001090E5           LDR      R1,[R0, #+0]
   \   000000A0   000051E3           CMP      R1,#+0
   \   000000A4   F7FFFF1A           BNE      ??items_menu_onkey_0
   \   000000A8   ........           LDR      R1,??DataTable6  ;; sock_keepalive
   \   000000AC   0130A0E3           MOV      R3,#+1
   \   000000B0   003081E5           STR      R3,[R1, #+0]
   \   000000B4   1110A0E3           MOV      R1,#+17
   \   000000B8   001080E5           STR      R1,[R0, #+0]
   \   000000BC   500092E5           LDR      R0,[R2, #+80]
   \   000000C0   ........           _BLF     CLIST_GetCount,??CLIST_GetCount??rA
   \   000000C4   0010A0E1           MOV      R1,R0
   \   000000C8   30009FE5           LDR      R0,??items_menu_onkey_4  ;; percent_t
   \   000000CC   0C3080E2           ADD      R3,R0,#+12
   \   000000D0   042080E2           ADD      R2,R0,#+4
   \   000000D4   3200A0E3           MOV      R0,#+50
   \   000000D8   ........           _BLF     friends_get,??friends_get??rA
   \   000000DC   0010A0E1           MOV      R1,R0
   \   000000E0   ........           LDR      R0,??DataTable7  ;; HttpSendReq
   \   000000E4   710100EF           SWI      +369
   \   000000E8   ........           _BLF     AnimWidget_Wait_headline,??AnimWidget_Wait_headline??rA
   \   000000EC   E5FFFFEA           B        ??items_menu_onkey_0
   \                     ??items_menu_onkey_2:
   \   000000F0   0000A0E3           MOV      R0,#+0
   \   000000F4   3C0082E5           STR      R0,[R2, #+60]
   \   000000F8   0100A0E3           MOV      R0,#+1
   \   000000FC   3080BDE8           POP      {R4,R5,PC}
   \                     ??items_menu_onkey_4:
   \   00000100   ........           DC32     percent_t
     80          }
     81          

   \                                 In segment CODE, align 4, keep-with-next
     82          static void items_menu_ghook(void *gui, int cmd)
     83          {
   \                     items_menu_ghook:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
     84            if (cmd==TI_CMD_CREATE)
   \   00000004   ........           LDR      R4,??DataTable11  ;; csm
   \   00000008   020051E3           CMP      R1,#+2
   \   0000000C   2D00001A           BNE      ??items_menu_ghook_0
     85            { 
     86              void* hdr_pointer=GetHeaderPointer(gui);
     87              hdr_ws=AllocWS(128);
   \   00000010   14719FE5           LDR      R7,??items_menu_ghook_1  ;; hdr_ws
     88              wsprintf(hdr_ws, percent_t, HEADER_TEXT);
   \   00000014   14519FE5           LDR      R5,??items_menu_ghook_1+0x4  ;; percent_t
   \   00000018   AE0200EF           SWI      +686
   \   0000001C   0060A0E1           MOV      R6,R0
   \   00000020   8000A0E3           MOV      R0,#+128
   \   00000024   250100EF           SWI      +293
   \   00000028   000087E5           STR      R0,[R7, #+0]
   \   0000002C   182085E2           ADD      R2,R5,#+24
   \   00000030   0510A0E1           MOV      R1,R5
   \   00000034   240100EF           SWI      +292
     89              SetHeaderText(hdr_pointer, hdr_ws, malloc_adr(), mfree_adr()); 
   \   00000038   158000EF           SWI      +32789
   \   0000003C   0080A0E1           MOV      R8,R0
   \   00000040   148000EF           SWI      +32788
   \   00000044   001097E5           LDR      R1,[R7, #+0]
   \   00000048   0020A0E1           MOV      R2,R0
   \   0000004C   0830A0E1           MOV      R3,R8
   \   00000050   0600A0E1           MOV      R0,R6
   \   00000054   AF0200EF           SWI      +687
     90              
     91              //LoadDynTheme();
     92              //LoadDynImages();
     93              
     94              if (process==0 && csm->friends_list==NULL)
   \   00000058   ........           LDR      R0,??DataTable9  ;; process
   \   0000005C   001090E5           LDR      R1,[R0, #+0]
   \   00000060   000051E3           CMP      R1,#+0
   \   00000064   00109405           LDREQ    R1,[R4, #+0]
   \   00000068   50109105           LDREQ    R1,[R1, #+80]
   \   0000006C   00005103           CMPEQ    R1,#+0
   \   00000070   F081BD18           POPNE    {R4-R8,PC}
     95              {
     96                process=LOAD_FRIENDS;
   \   00000074   1110A0E3           MOV      R1,#+17
   \   00000078   001080E5           STR      R1,[R0, #+0]
     97                sock_keepalive=1;
   \   0000007C   ........           LDR      R0,??DataTable6  ;; sock_keepalive
   \   00000080   0110A0E3           MOV      R1,#+1
   \   00000084   001080E5           STR      R1,[R0, #+0]
     98                SUBPROC((void *)HttpSendReq, friends_get(50, 0, "mobile", "photo_50"));
   \   00000088   0C3085E2           ADD      R3,R5,#+12
   \   0000008C   042085E2           ADD      R2,R5,#+4
   \   00000090   0010A0E3           MOV      R1,#+0
   \   00000094   3200A0E3           MOV      R0,#+50
   \   00000098   ........           _BLF     friends_get,??friends_get??rA
   \   0000009C   0010A0E1           MOV      R1,R0
   \   000000A0   ........           LDR      R0,??DataTable7  ;; HttpSendReq
   \   000000A4   710100EF           SWI      +369
     99                if (csm->friends_list==NULL)
   \   000000A8   000094E5           LDR      R0,[R4, #+0]
   \   000000AC   500090E5           LDR      R0,[R0, #+80]
   \   000000B0   000050E3           CMP      R0,#+0
   \   000000B4   0100001A           BNE      ??items_menu_ghook_2
    100                  AnimWidget_Wait_body();
   \   000000B8   ........           _BLF     AnimWidget_Wait_body,??AnimWidget_Wait_body??rA
   \   000000BC   F081BDE8           POP      {R4-R8,PC}
    101                else
    102                  AnimWidget_Wait_headline();
   \                     ??items_menu_ghook_2:
   \   000000C0   ........           _BLF     AnimWidget_Wait_headline,??AnimWidget_Wait_headline??rA
   \   000000C4   F081BDE8           POP      {R4-R8,PC}
    103              }     
    104            }
    105               
    106            if (cmd==TI_CMD_UNFOCUS)
   \                     ??items_menu_ghook_0:
   \   000000C8   090051E3           CMP      R1,#+9
   \   000000CC   0100001A           BNE      ??items_menu_ghook_3
    107            {
    108              AnimWidget_Close();
   \   000000D0   ........           _BLF     AnimWidget_Close,??AnimWidget_Close??rA
    109              //DisableDynImages();
    110              DisableDynTheme();
   \   000000D4   120000EA           B        ??items_menu_ghook_4
    111            }
    112            
    113            if (cmd==TI_CMD_FOCUS)
   \                     ??items_menu_ghook_3:
   \   000000D8   0A0051E3           CMP      R1,#+10
   \   000000DC   0700001A           BNE      ??items_menu_ghook_5
    114            {
    115              if (GetMenuItemCount(gui)==0)
   \   000000E0   A80200EF           SWI      +680
   \   000000E4   000050E3           CMP      R0,#+0
   \   000000E8   0000001A           BNE      ??items_menu_ghook_6
    116                AnimWidget_Wait_body();
   \   000000EC   ........           _BLF     AnimWidget_Wait_body,??AnimWidget_Wait_body??rA
    117              
    118              EnableDynImages();
   \                     ??items_menu_ghook_6:
   \   000000F0   ........           _BLF     EnableDynImages,??EnableDynImages??rA
    119              EnableDynTheme();  
   \   000000F4   ........           _BLF     EnableDynTheme,??EnableDynTheme??rA
    120              DisableIDLETMR();
   \   000000F8   7F0100EF           SWI      +383
   \   000000FC   F081BDE8           POP      {R4-R8,PC}
    121            }  
    122            
    123            if (cmd==TI_CMD_REDRAW)
   \                     ??items_menu_ghook_5:
   \   00000100   070051E3           CMP      R1,#+7
   \   00000104   0100001A           BNE      ??items_menu_ghook_7
    124            {
    125              EnableDynImages();
   \   00000108   ........           _BLF     EnableDynImages,??EnableDynImages??rA
   \   0000010C   F081BDE8           POP      {R4-R8,PC}
    126            }
    127            
    128            if (cmd==TI_CMD_DESTROY)
   \                     ??items_menu_ghook_7:
   \   00000110   030051E3           CMP      R1,#+3
   \   00000114   F081BD18           POPNE    {R4-R8,PC}
    129            {
    130              csm->friends_menu_gui_id=NULL;
   \   00000118   000094E5           LDR      R0,[R4, #+0]
   \   0000011C   0010A0E3           MOV      R1,#+0
   \   00000120   3C1080E5           STR      R1,[R0, #+60]
    131              /*csm->c=NULL;
    132              csm->cl=NULL;
    133              CLIST_Free(&csm->friends_clist); */
    134              DisableDynTheme();
   \                     ??items_menu_ghook_4:
   \   00000124   ........           _BLF     DisableDynTheme,??DisableDynTheme??rA
    135              //DisableDynImages();
    136            }
    137          }
   \   00000128   F081BDE8           POP      {R4-R8,PC}       ;; return
   \                     ??items_menu_ghook_1:
   \   0000012C   ........           DC32     hdr_ws
   \   00000130   ........           DC32     percent_t
    138          

   \                                 In segment CODE, align 4, keep-with-next
    139          static void items_menu_iconhndl(void *gui, int curitem, void *user_pointer)
    140          {
   \                     items_menu_iconhndl:
   \   00000000   F04F2DE9           PUSH     {R4-R11,LR}
    141            CLIST* c=FindContactByN(csm->friends_list, curitem);
   \   00000004   ........           LDR      R6,??DataTable11  ;; csm
   \   00000008   0040A0E1           MOV      R4,R0
   \   0000000C   000096E5           LDR      R0,[R6, #+0]
   \   00000010   0150A0E1           MOV      R5,R1
   \   00000014   500090E5           LDR      R0,[R0, #+80]
   \   00000018   ........           _BLF     FindContactByN,??FindContactByN??rA
   \   0000001C   0070A0E1           MOV      R7,R0
    142            
    143            WSHDR *ws1=AllocMenuWS(gui,64);
   \   00000020   4010A0E3           MOV      R1,#+64
   \   00000024   0400A0E1           MOV      R0,R4
   \   00000028   980100EF           SWI      +408
   \   0000002C   0080A0E1           MOV      R8,R0
    144            WSHDR *ws2=AllocMenuWS(gui,64);
   \   00000030   4010A0E3           MOV      R1,#+64
   \   00000034   0400A0E1           MOV      R0,R4
   \   00000038   980100EF           SWI      +408
   \   0000003C   0090A0E1           MOV      R9,R0
    145            void* item=AllocMLMenuItem(gui);
   \   00000040   0400A0E1           MOV      R0,R4
   \   00000044   190200EF           SWI      +537
   \   00000048   00A0A0E1           MOV      R10,R0
    146            
    147            if (c)
   \   0000004C   000057E3           CMP      R7,#+0
   \   00000050   F08FBD08           POPEQ    {R4-R11,PC}
    148            {
    149              wsAppendChar(ws1, UTF16_FONT_SMALL_BOLD);
   \   00000054   13B0A0E3           MOV      R11,#+19
   \   00000058   E0BC8BE3           ORR      R11,R11,#0xE000
   \   0000005C   0B10A0E1           MOV      R1,R11
   \   00000060   0800A0E1           MOV      R0,R8
   \   00000064   1C0000EF           SWI      +28
    150              //wsAppendChar(ws1, 0x5D80);//RG
    151              //wsAppendChar(ws1, 0xA664);//BA - вк синий    
    152              if (c->first_name)
   \   00000068   181097E5           LDR      R1,[R7, #+24]
   \   0000006C   000051E3           CMP      R1,#+0
   \   00000070   0200000A           BEQ      ??items_menu_iconhndl_0
    153                wstrcat(ws1, c->first_name);
   \   00000074   0800A0E1           MOV      R0,R8
   \   00000078   210100EF           SWI      +289
   \   0000007C   030000EA           B        ??items_menu_iconhndl_1
    154              else
    155                wstrcatprintf(ws1,percent_d, c->user_id);
   \                     ??items_menu_iconhndl_0:
   \   00000080   142097E5           LDR      R2,[R7, #+20]
   \   00000084   F4109FE5           LDR      R1,??items_menu_iconhndl_2  ;; percent_d
   \   00000088   0800A0E1           MOV      R0,R8
   \   0000008C   160200EF           SWI      +534
    156              
    157              wsAppendChar(ws2, UTF16_FONT_SMALL_BOLD);
   \                     ??items_menu_iconhndl_1:
   \   00000090   0B10A0E1           MOV      R1,R11
   \   00000094   0900A0E1           MOV      R0,R9
   \   00000098   1C0000EF           SWI      +28
    158              //wsAppendChar(ws2, 0x5D80);//RG
    159              //wsAppendChar(ws2, 0xA664);//BA - вк синий 
    160              if (c->last_name)
   \   0000009C   1C1097E5           LDR      R1,[R7, #+28]
   \   000000A0   000051E3           CMP      R1,#+0
   \   000000A4   0100000A           BEQ      ??items_menu_iconhndl_3
    161                wstrcat(ws2, c->last_name);    
   \   000000A8   0900A0E1           MOV      R0,R9
   \   000000AC   210100EF           SWI      +289
    162              
    163              //SetMenuItemIconArray(gui, item, &i1_pic); //первым рисуется картинка из SetMenuItemIconArray
    164              if (c->photo)
   \                     ??items_menu_iconhndl_3:
   \   000000B0   242097E5           LDR      R2,[R7, #+36]
   \   000000B4   000052E3           CMP      R2,#+0
   \   000000B8   0300000A           BEQ      ??items_menu_iconhndl_4
    165                SetMenuItemIconIMGHDR(gui, item, c->photo);
   \   000000BC   0A10A0E1           MOV      R1,R10
   \   000000C0   0400A0E1           MOV      R0,R4
   \   000000C4   A30300EF           SWI      +931
   \   000000C8   240000EA           B        ??items_menu_iconhndl_5
    166              else
    167              {
    168                IMGHDR* img;
    169                
    170                if (c->deactivated)
   \                     ??items_menu_iconhndl_4:
   \   000000CC   200097E5           LDR      R0,[R7, #+32]
   \   000000D0   000050E3           CMP      R0,#+0
    171                  img=PNGLIST_GetImgByIndex(0);//deactivated.png
   \   000000D4   0000A013           MOVNE    R0,#+0
    172                else
    173                  img=PNGLIST_GetImgByIndex(1);//camera.png
   \   000000D8   0100A003           MOVEQ    R0,#+1
   \   000000DC   ........           _BLF     PNGLIST_GetImgByIndex,??PNGLIST_GetImgByIndex??rA
    174                
    175                if (img)
   \   000000E0   000050E3           CMP      R0,#+0
   \   000000E4   0300000A           BEQ      ??items_menu_iconhndl_6
    176                  SetMenuItemIconIMGHDR(gui, item, img);
   \   000000E8   0020A0E1           MOV      R2,R0
   \   000000EC   0A10A0E1           MOV      R1,R10
   \   000000F0   0400A0E1           MOV      R0,R4
   \   000000F4   A30300EF           SWI      +931
    177                
    178                if (c->deactivated==0)
   \                     ??items_menu_iconhndl_6:
   \   000000F8   200097E5           LDR      R0,[R7, #+32]
   \   000000FC   000050E3           CMP      R0,#+0
    179                  c->flag_load_photo=1;//надо загрузить
   \   00000100   0100A003           MOVEQ    R0,#+1
   \   00000104   2C008705           STREQ    R0,[R7, #+44]
    180                
    181                if (process==0) 
   \   00000108   ........           LDR      R0,??DataTable9  ;; process
   \   0000010C   001090E5           LDR      R1,[R0, #+0]
   \   00000110   000051E3           CMP      R1,#+0
   \   00000114   1100001A           BNE      ??items_menu_iconhndl_5
    182                {
    183                  csm->cl=csm->friends_list;
   \   00000118   001096E5           LDR      R1,[R6, #+0]
    184                  csm->c=csm->cl;
    185                  process=LOAD_USERS_PHOTO_FROM_INET;
    186                  ipc.name_to=ipc_my_name;
   \   0000011C   60309FE5           LDR      R3,??items_menu_iconhndl_2+0x4  ;; ipc
   \   00000120   502091E5           LDR      R2,[R1, #+80]
   \   00000124   5C2081E5           STR      R2,[R1, #+92]
   \   00000128   602081E5           STR      R2,[R1, #+96]
   \   0000012C   0D10A0E3           MOV      R1,#+13
   \   00000130   001080E5           STR      R1,[R0, #+0]
   \   00000134   4C009FE5           LDR      R0,??items_menu_iconhndl_2+0x8  ;; ipc_my_name
    187                  ipc.name_from=ipc_my_name;
    188                  ipc.data=0;
    189                  GBS_SendMessage(MMI_CEPID, MSG_IPC, IPC_RUN_MAIN_PROCESS, &ipc);        
   \   00000138   0420A0E3           MOV      R2,#+4
   \   0000013C   000083E5           STR      R0,[R3, #+0]
   \   00000140   040083E5           STR      R0,[R3, #+4]
   \   00000144   0000A0E3           MOV      R0,#+0
   \   00000148   080083E5           STR      R0,[R3, #+8]
   \   0000014C   B010A0E3           MOV      R1,#+176
   \   00000150   DE1C81E3           ORR      R1,R1,#0xDE00
   \   00000154   0900A0E3           MOV      R0,#+9
   \   00000158   420C80E3           ORR      R0,R0,#0x4200
   \   0000015C   000100EF           SWI      +256
    190                }           
    191              }
    192              
    193              SetMLMenuItemText(gui, item, ws1, ws2, curitem);
   \                     ??items_menu_iconhndl_5:
   \   00000160   20002DE9           PUSH     {R5}
   \   00000164   0930A0E1           MOV      R3,R9
   \   00000168   0820A0E1           MOV      R2,R8
   \   0000016C   0A10A0E1           MOV      R1,R10
   \   00000170   0400A0E1           MOV      R0,R4
   \   00000174   180200EF           SWI      +536
   \   00000178   04D08DE2           ADD      SP,SP,#+4
    194            }
    195          }
   \   0000017C   F08FBDE8           POP      {R4-R11,PC}      ;; return
   \                     ??items_menu_iconhndl_2:
   \   00000180   ........           DC32     percent_d
   \   00000184   ........           DC32     ipc
   \   00000188   ........           DC32     ipc_my_name
    196          

   \                                 In segment DATA_C, align 4, align-sorted
    197          static const ML_MENU_DESC items_menu_desc=
   \                     items_menu_desc:
   \   00000000   08000000....       DC32 8, items_menu_onkey, items_menu_ghook, 0H, menusoftkeys, skt
   \              ............
   \              00000000....
   \              ............
   \   00000018   92000140....       DC32 1073807506, items_menu_iconhndl, 0H, 0H, 0, 1
   \              ....00000000
   \              000000000000
   \              000001000000
    198          {
    199            8,
    200            items_menu_onkey,
    201            items_menu_ghook,
    202            NULL,
    203            menusoftkeys,
    204            &skt,
    205            0x40010092, //0x40010092//0x80000083
    206            items_menu_iconhndl,
    207            NULL,   //Items
    208            NULL,   //Procs
    209            0,   //n
    210            1 //Добавочных строк  
    211          };
    212          
    213          //******************************************************************************

   \                                 In segment CODE, align 4, keep-with-next
    214          void RecountFriendsMenu()
    215          {
   \                     RecountFriendsMenu:
   \   00000000   30402DE9           PUSH     {R4,R5,LR}
    216            if (csm->friends_menu_gui_id)
   \   00000004   ........           LDR      R4,??DataTable11  ;; csm
   \   00000008   000094E5           LDR      R0,[R4, #+0]
   \   0000000C   3C0090E5           LDR      R0,[R0, #+60]
   \   00000010   000050E3           CMP      R0,#+0
   \   00000014   3080BD08           POPEQ    {R4,R5,PC}
    217            {
    218              GUI* gui=FindGUIbyId(csm->friends_menu_gui_id, NULL);
   \   00000018   0010A0E3           MOV      R1,#+0
   \   0000001C   090200EF           SWI      +521
   \   00000020   0050A0E1           MOV      R5,R0
    219              Menu_SetItemCountDyn(gui, CLIST_GetCount(csm->friends_list));
   \   00000024   000094E5           LDR      R0,[R4, #+0]
   \   00000028   500090E5           LDR      R0,[R0, #+80]
   \   0000002C   ........           _BLF     CLIST_GetCount,??CLIST_GetCount??rA
   \   00000030   0010A0E1           MOV      R1,R0
   \   00000034   0500A0E1           MOV      R0,R5
   \   00000038   E60100EF           SWI      +486
    220          
    221            }
    222          }
   \   0000003C   3080BDE8           POP      {R4,R5,PC}       ;; return
    223          
    224          //******************************************************************************
    225          

   \                                 In segment CODE, align 4, keep-with-next
    226          void CreateFriendsMenu()
    227          {
   \                     CreateFriendsMenu:
   \   00000000   F0402DE9           PUSH     {R4-R7,LR}
    228            void *ma=malloc_adr(); 
    229            void *mf= mfree_adr();
    230            void *gui=GetMultiLinesMenuGUI(ma, mf); 
    231            SetMenuToGUI(gui,&items_menu_desc); 
    232            SetMenuItemCount(gui, CLIST_GetCount(csm->friends_list));
   \   00000004   ........           LDR      R6,??DataTable11  ;; csm
    233            patch_header(&hdr);
   \   00000008   64709FE5           LDR      R7,??CreateFriendsMenu_0  ;; hdr
   \   0000000C   148000EF           SWI      +32788
   \   00000010   0040A0E1           MOV      R4,R0
   \   00000014   158000EF           SWI      +32789
   \   00000018   0010A0E1           MOV      R1,R0
   \   0000001C   0400A0E1           MOV      R0,R4
   \   00000020   A50200EF           SWI      +677
   \   00000024   4C109FE5           LDR      R1,??CreateFriendsMenu_0+0x4  ;; items_menu_desc
   \   00000028   0050A0E1           MOV      R5,R0
   \   0000002C   A70200EF           SWI      +679
   \   00000030   000096E5           LDR      R0,[R6, #+0]
   \   00000034   500090E5           LDR      R0,[R0, #+80]
   \   00000038   ........           _BLF     CLIST_GetCount,??CLIST_GetCount??rA
   \   0000003C   0010A0E1           MOV      R1,R0
   \   00000040   0500A0E1           MOV      R0,R5
   \   00000044   C30100EF           SWI      +451
   \   00000048   0700A0E1           MOV      R0,R7
   \   0000004C   ........           _BLF     patch_header,??patch_header??rA
    234            SetHeaderToMenu(gui,&hdr,ma); 
   \   00000050   0420A0E1           MOV      R2,R4
   \   00000054   0710A0E1           MOV      R1,R7
   \   00000058   0500A0E1           MOV      R0,R5
   \   0000005C   A60200EF           SWI      +678
    235            csm->friends_menu_gui_id=CreateGUI(gui); 
   \   00000060   0500A0E1           MOV      R0,R5
   \   00000064   370100EF           SWI      +311
   \   00000068   001096E5           LDR      R1,[R6, #+0]
   \   0000006C   3C0081E5           STR      R0,[R1, #+60]
    236          }
   \   00000070   F080BDE8           POP      {R4-R7,PC}       ;; return
   \                     ??CreateFriendsMenu_0:
   \   00000074   ........           DC32     hdr
   \   00000078   ........           DC32     items_menu_desc

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable6:
   \   00000000   ........           DC32     sock_keepalive

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable7:
   \   00000000   ........           DC32     HttpSendReq

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable9:
   \   00000000   ........           DC32     process

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable11:
   \   00000000   ........           DC32     csm

   \                                 In segment DATA_ID, align 4, align-sorted
   \                     `?<Initializer for hdr>`:
   \   00000000   000000000000       DC16 0, 0, 0, 0
   \              0000        
   \   00000008   000000000000       DC32 0H, 0, 2147483647
   \              0000FFFFFF7F

   \                                 In segment DATA_ID, align 4, align-sorted
   \                     `?<Initializer for sk>`:
   \   00000000   18000000           DC16 24, 0
   \   00000004   ........           DC32 `?<Constant "\\305\\371\\345+50">`
   \   00000008   01000000           DC16 1, 0
   \   0000000C   ........           DC32 `?<Constant "\\315\\340\\347\\340\\344">`
   \   00000010   3D000000           DC16 61, 0
   \   00000014   FBC0FF7F           DC32 2147467515

   \                                 In segment DATA_ID, align 4, align-sorted
   \                     `?<Initializer for skt>`:
   \   00000000   ........0000       DC32 sk, 0
   \              0000        

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant "\\305\\371\\345+50">`:
   \   00000000   C5F9E52B3530       DC8 "\305\371\345+50"
   \              00          
   \   00000007   00                 DC8 0

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant "\\315\\340\\347\\340\\344">`:
   \   00000000   CDE0E7E0E400       DC8 "\315\340\347\340\344"
   \   00000006   0000               DC8 0, 0
    237          
    238          

   Maximum stack usage in bytes:

     Function            CSTACK
     --------            ------
     CreateFriendsMenu      20
     RecountFriendsMenu     12
     items_menu_ghook       24
     items_menu_iconhndl    40
     items_menu_onkey       12
     patch_header            8


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     patch_header                     48
     percent_t                        32
     percent_d                         3
     hdr                              20
     hdr_ws                            4
     menusoftkeys                     12
     sk                               24
     skt                               8
     items_menu_onkey                260
     items_menu_ghook                308
     items_menu_iconhndl             396
     items_menu_desc                  48
     RecountFriendsMenu               64
     CreateFriendsMenu               124
     ??DataTable6                      4
     ??DataTable7                      4
     ??DataTable9                      4
     ??DataTable11                     4
     ?<Initializer for hdr>           20
     ?<Initializer for sk>            24
     ?<Initializer for skt>            8
     ?<Constant "\305\371\345+50">     8
     ?<Constant "\315\340\347\340\344">
                                       8
      Others                         212

 
 1 404 bytes in segment CODE
   111 bytes in segment DATA_C
    52 bytes in segment DATA_I
    52 bytes in segment DATA_ID
     4 bytes in segment DATA_Z
    24 bytes in segment INITTAB
 
 1 168 bytes of CODE  memory (+ 260 bytes shared)
   163 bytes of CONST memory
    56 bytes of DATA  memory

Errors: none
Warnings: none

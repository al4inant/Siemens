##############################################################################
#                                                                            #
# IAR ARM ANSI C/C++ Compiler V4.42A/W32 EVALUATION    14/Dec/2018  23:20:53 #
# Copyright 1999-2005 IAR Systems. All rights reserved.                      #
#                                                                            #
#    Cpu mode        =  interwork                                            #
#    Endian          =  little                                               #
#    Stack alignment =  4                                                    #
#    Source file     =  E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\MainMenu.c                                 #
#    Command line    =  E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\MainMenu.c -D NEWSGOLD -D DEVELOP -lCN     #
#                       E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\Releas_NSG\List\ -la                       #
#                       E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\Releas_NSG\List\ -o                        #
#                       E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\Releas_NSG\Obj\ -z9 --cpu_mode arm         #
#                       --endian little --cpu ARM926EJ-S --stack_align 4     #
#                       --interwork --diag_suppress Pe301 -e --fpu None      #
#                       --dlib_config E:\Users\alfinant\Documents\Siemens\IA #
#                       R\ARM\LIB\dl5tpainl8n.h -I                           #
#                       E:\Users\alfinant\Documents\Siemens\IAR\ARM\INC\     #
#                       --inline_threshold=2                                 #
#    List file       =  E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\Releas_NSG\List\MainMenu.lst               #
#    Object file     =  E:\Users\alfinant\Documents\Siemens\alfinant\src_iar #
#                       \VK.ELF_C\Releas_NSG\Obj\MainMenu.r79                #
#                                                                            #
#                                                                            #
##############################################################################

E:\Users\alfinant\Documents\Siemens\alfinant\src_iar\VK.ELF_C\MainMenu.c
      1          #include <siemens\swilib.h>
      2          #include "rect_patcher.h"

   \                                 In segment CODE, align 4, keep-with-next
   \   __??Code32?? __code __interwork __atpcs void patch_header(HEADER_DESC const *)
   \                     patch_header:
   \   00000000   10402DE9           PUSH     {R4,LR}
   \   00000004   0040A0E1           MOV      R4,R0
   \   00000008   0000A0E3           MOV      R0,#+0
   \   0000000C   B000C4E1           STRH     R0,[R4, #+0]
   \   00000010   B200C4E1           STRH     R0,[R4, #+2]
   \   00000014   888100EF           SWI      +33160
   \   00000018   010040E2           SUB      R0,R0,#+1
   \   0000001C   B400C4E1           STRH     R0,[R4, #+4]
   \   00000020   8A8100EF           SWI      +33162
   \   00000024   010040E2           SUB      R0,R0,#+1
   \   00000028   B600C4E1           STRH     R0,[R4, #+6]
   \   0000002C   1080BDE8           POP      {R4,PC}          ;; return
      3          #include "dyn_images.h"
      4          #include "dyn_theme.h"
      5          #include "process.h"
      6          #include "http.h"
      7          #include "vk_api.h"
      8          #include "DialogsMenu.h"
      9          #include "FriendsMenu.h"
     10          #include "GroupsMenu.h"
     11          #include "main.h"
     12          
     13          

   \                                 In segment DATA_C, align 4, align-sorted
     14          static const char percent_t[]="%t";
   \                     percent_t:
   \   00000000   257400             DC8 "%t"
   \   00000003   00                 DC8 0
   \   00000004   D1EEEEE1F9E5       DC8 "\321\356\356\341\371\345\355\350\377"
   \              EDE8FF00    
   \   0000000E   0000               DC8 0, 0
   \   00000010   C4F0F3E7FCFF       DC8 "\304\360\363\347\374\377"
   \              00          
   \   00000017   00                 DC8 0
   \   00000018   C3F0F3EFEFFB       DC8 "\303\360\363\357\357\373"
   \              00          
   \   0000001F   00                 DC8 0
   \   00000020   CEE120FDEBFC       DC8 "\316\341 \375\353\374\364\345"
   \              F4E500      
   \   00000029   000000             DC8 0, 0, 0
   \   0000002C   C2EAEEEDF2E0       DC8 "\302\352\356\355\362\340\352\362\345"
   \              EAF2E500    
   \   00000036   0000               DC8 0, 0
     15          static const char HEADER_TEXT[]="Вконтакте";
     16          
     17          extern int CreateDebugGUI();
     18          

   \                                 In segment DATA_I, align 4, align-sorted
     19          static HEADER_DESC hdr={0,0,0,0,NULL,NULL,LGP_NULL};
   \                     hdr:
   \   00000000                      DS8 20
   \   00000014                      REQUIRE `?<Initializer for hdr>`

   \                                 In segment DATA_Z, align 4, align-sorted
     20          static WSHDR* hdr_ws=NULL;
   \                     hdr_ws:
   \   00000000                      DS8 4
     21          

   \                                 In segment DATA_C, align 4, align-sorted
     22          static const int menusoftkeys[]={0,1,2};
   \                     menusoftkeys:
   \   00000000   000000000100       DC32 0, 1, 2
   \              000002000000
     23          

   \                                 In segment DATA_I, align 4, align-sorted
     24          static SOFTKEY_DESC sk[]=
   \                     sk:
   \   00000000                      DS8 24
   \   00000018                      REQUIRE `?<Initializer for sk>`
     25          {
     26            {0x0018,0x0000,(int)"Опции"},
     27            {0x0001,0x0000, (int)"Назад"},
     28            {0x003D,0x0000,(int)LGP_DOIT_PIC}
     29          };
     30          

   \                                 In segment DATA_I, align 4, align-sorted
     31          static SOFTKEYSTAB skt=
   \                     skt:
   \   00000000                      DS8 8
   \   00000008                      REQUIRE `?<Initializer for skt>`
     32          {
     33            sk,0
     34          };
     35          
     36          extern int OpenAboutMenu();
     37          

   \                                 In segment CODE, align 4, keep-with-next
     38          static int items_menu_onkey(void *gui, GUI_MSG *msg)
     39          { 
   \                     items_menu_onkey:
   \   00000000   10402DE9           PUSH     {R4,LR}
   \   00000004   0140A0E1           MOV      R4,R1
     40            int i=GetCurMenuItem(gui);
   \   00000008   8F0100EF           SWI      +399
     41            
     42            if ((msg->gbsmsg->msg==KEY_DOWN)||(msg->gbsmsg->msg==LONG_PRESS))
   \   0000000C   041094E5           LDR      R1,[R4, #+4]
   \   00000010   9330A0E3           MOV      R3,#+147
   \   00000014   042091E5           LDR      R2,[R1, #+4]
   \   00000018   403F83E3           ORR      R3,R3,#0x100
   \   0000001C   030052E1           CMP      R2,R3
   \   00000020   02308312           ADDNE    R3,R3,#+2
   \   00000024   03005211           CMPNE    R2,R3
   \   00000028   1200001A           BNE      ??items_menu_onkey_0
     43            { 
     44              switch(msg->gbsmsg->submess)
   \   0000002C   081091E5           LDR      R1,[R1, #+8]
   \   00000030   041051E2           SUBS     R1,R1,#+4
   \   00000034   0400000A           BEQ      ??items_menu_onkey_1
   \   00000038   071051E2           SUBS     R1,R1,#+7
   \   0000003C   0400000A           BEQ      ??items_menu_onkey_2
   \   00000040   0F1051E2           SUBS     R1,R1,#+15
   \   00000044   0400000A           BEQ      ??items_menu_onkey_3
   \   00000048   0A0000EA           B        ??items_menu_onkey_0
     45              {
     46              case RIGHT_SOFT:
     47                return(1);
   \                     ??items_menu_onkey_1:
   \   0000004C   0100A0E3           MOV      R0,#+1
   \   00000050   1080BDE8           POP      {R4,PC}
     48                
     49              case GREEN_BUTTON:
     50                CreateDebugGUI();
   \                     ??items_menu_onkey_2:
   \   00000054   ........           _BLF     CreateDebugGUI,??CreateDebugGUI??rA
   \   00000058   060000EA           B        ??items_menu_onkey_0
     51                break;
     52                
     53              case ENTER_BUTTON:
     54                if (i==0)
   \                     ??items_menu_onkey_3:
   \   0000005C   000050E3           CMP      R0,#+0
   \   00000060   0100001A           BNE      ??items_menu_onkey_4
     55                  CreateDialogsMenu();
   \   00000064   ........           _BLF     CreateDialogsMenu,??CreateDialogsMenu??rA
   \   00000068   020000EA           B        ??items_menu_onkey_0
     56                else
     57                  /*if (i==1)
     58                    CreateFriendsMenu();
     59                else
     60                  if (i==2)
     61                    CreateGroupsMenu();
     62                  else */
     63                    if (i==3)
   \                     ??items_menu_onkey_4:
   \   0000006C   030050E3           CMP      R0,#+3
   \   00000070   0000001A           BNE      ??items_menu_onkey_0
     64                      OpenAboutMenu();
   \   00000074   ........           _BLF     OpenAboutMenu,??OpenAboutMenu??rA
     65                  break;
     66              }
     67            }
     68            return (0); 
   \                     ??items_menu_onkey_0:
   \   00000078   0000A0E3           MOV      R0,#+0
   \   0000007C   1080BDE8           POP      {R4,PC}          ;; return
     69          }
     70          

   \                                 In segment CODE, align 4, keep-with-next
     71          static void items_menu_ghook(void *gui, int cmd)
     72          {
   \                     items_menu_ghook:
   \   00000000   70402DE9           PUSH     {R4-R6,LR}
     73            if (cmd==TI_CMD_CREATE)
   \   00000004   020051E3           CMP      R1,#+2
   \   00000008   1100001A           BNE      ??items_menu_ghook_0
     74            { 
     75              void* hdr_pointer=GetHeaderPointer(gui);
     76              hdr_ws=AllocWS(128);
   \   0000000C   98509FE5           LDR      R5,??items_menu_ghook_1  ;; hdr_ws
   \   00000010   AE0200EF           SWI      +686
   \   00000014   0040A0E1           MOV      R4,R0
   \   00000018   8000A0E3           MOV      R0,#+128
   \   0000001C   250100EF           SWI      +293
     77              wsprintf(hdr_ws, percent_t, HEADER_TEXT);
   \   00000020   ........           LDR      R1,??DataTable2  ;; percent_t
   \   00000024   000085E5           STR      R0,[R5, #+0]
   \   00000028   2C2081E2           ADD      R2,R1,#+44
   \   0000002C   240100EF           SWI      +292
     78              SetHeaderText(hdr_pointer, hdr_ws, malloc_adr(), mfree_adr());    
   \   00000030   158000EF           SWI      +32789
   \   00000034   0060A0E1           MOV      R6,R0
   \   00000038   148000EF           SWI      +32788
   \   0000003C   001095E5           LDR      R1,[R5, #+0]
   \   00000040   0020A0E1           MOV      R2,R0
   \   00000044   0630A0E1           MOV      R3,R6
   \   00000048   0400A0E1           MOV      R0,R4
   \   0000004C   AF0200EF           SWI      +687
   \   00000050   7080BDE8           POP      {R4-R6,PC}
     79            }
     80               
     81            if (cmd==TI_CMD_UNFOCUS)
   \                     ??items_menu_ghook_0:
   \   00000054   090051E3           CMP      R1,#+9
   \   00000058   0100001A           BNE      ??items_menu_ghook_2
     82            {
     83              //DisableDynImages();
     84              DisableDynTheme();
   \   0000005C   ........           _BLF     DisableDynTheme,??DisableDynTheme??rA
   \   00000060   7080BDE8           POP      {R4-R6,PC}
     85            }
     86            
     87            if (cmd==TI_CMD_FOCUS)
   \                     ??items_menu_ghook_2:
   \   00000064   0A0051E3           CMP      R1,#+10
   \   00000068   0300001A           BNE      ??items_menu_ghook_3
     88            {
     89              EnableDynImages();
   \   0000006C   ........           _BLF     EnableDynImages,??EnableDynImages??rA
     90              EnableDynTheme();  
   \   00000070   ........           _BLF     EnableDynTheme,??EnableDynTheme??rA
     91              DisableIDLETMR();
   \   00000074   7F0100EF           SWI      +383
   \   00000078   7080BDE8           POP      {R4-R6,PC}
     92            }  
     93            
     94            if (cmd==TI_CMD_REDRAW)
   \                     ??items_menu_ghook_3:
   \   0000007C   070051E3           CMP      R1,#+7
   \   00000080   0100001A           BNE      ??items_menu_ghook_4
     95            {
     96              EnableDynImages();
   \   00000084   ........           _BLF     EnableDynImages,??EnableDynImages??rA
   \   00000088   7080BDE8           POP      {R4-R6,PC}
     97            }
     98            
     99            if (cmd==TI_CMD_DESTROY)
   \                     ??items_menu_ghook_4:
   \   0000008C   030051E3           CMP      R1,#+3
   \   00000090   7080BD18           POPNE    {R4-R6,PC}
    100            {
    101              DisableDynTheme();
   \   00000094   ........           _BLF     DisableDynTheme,??DisableDynTheme??rA
    102              //DisableDynImages();
    103              csm->mainmenu_gui_id=NULL;
   \   00000098   ........           LDR      R0,??DataTable3  ;; csm
   \   0000009C   0010A0E3           MOV      R1,#+0
   \   000000A0   000090E5           LDR      R0,[R0, #+0]
   \   000000A4   341080E5           STR      R1,[R0, #+52]
    104            }
    105          }
   \   000000A8   7080BDE8           POP      {R4-R6,PC}       ;; return
   \                     ??items_menu_ghook_1:
   \   000000AC   ........           DC32     hdr_ws
    106          

   \                                 In segment CODE, align 4, keep-with-next
    107          static void items_menu_iconhndl(void *gui, int curitem, void *user_pointer)
    108          {
   \                     items_menu_iconhndl:
   \   00000000   F0402DE9           PUSH     {R4-R7,LR}
   \   00000004   0040A0E1           MOV      R4,R0
   \   00000008   0150A0E1           MOV      R5,R1
    109            WSHDR* ws=AllocMenuWS(gui,64);
   \   0000000C   4010A0E3           MOV      R1,#+64
   \   00000010   980100EF           SWI      +408
   \   00000014   0060A0E1           MOV      R6,R0
    110            void* item=AllocMenuItem(gui);
   \   00000018   0400A0E1           MOV      R0,R4
   \   0000001C   970100EF           SWI      +407
    111            
    112            switch(curitem)
   \   00000020   ........           LDR      R1,??DataTable2  ;; percent_t
   \   00000024   0070A0E1           MOV      R7,R0
   \   00000028   0500A0E1           MOV      R0,R5
   \   0000002C   030050E3           CMP      R0,#+3
   \   00000030   0C00008A           BHI      ??items_menu_iconhndl_1
   \   00000034   012F8FE2           ADR      R2,??items_menu_iconhndl_0
   \   00000038   0020D2E7           LDRB     R2,[R2, R0]
   \   0000003C   02F18FE0           ADD      PC,PC,R2, LSL #+2
   \                     ??items_menu_iconhndl_0:
   \   00000040   00020406           DC8      +0,+2,+4,+6
    113            {
    114            case 0:
    115              wsprintf(ws, percent_t, "Сообщения");
   \                     ??items_menu_iconhndl_2:
   \   00000044   042081E2           ADD      R2,R1,#+4
   \   00000048   040000EA           B        ??items_menu_iconhndl_3
    116              break;
    117            case 1:
    118              wsprintf(ws, percent_t, "Друзья");    
   \                     ??items_menu_iconhndl_4:
   \   0000004C   102081E2           ADD      R2,R1,#+16
   \   00000050   020000EA           B        ??items_menu_iconhndl_3
    119              break;
    120            case 2:
    121              wsprintf(ws, percent_t, "Группы");    
   \                     ??items_menu_iconhndl_5:
   \   00000054   182081E2           ADD      R2,R1,#+24
   \   00000058   000000EA           B        ??items_menu_iconhndl_3
    122              break;    
    123            case 3:
    124              wsprintf(ws, percent_t, "Об эльфе");
   \                     ??items_menu_iconhndl_6:
   \   0000005C   202081E2           ADD      R2,R1,#+32
   \                     ??items_menu_iconhndl_3:
   \   00000060   0600A0E1           MOV      R0,R6
   \   00000064   240100EF           SWI      +292
    125              break;
    126            }
    127          
    128            //SetMenuItemIconArray(gui, item, &i1_pic); //первым рисуется картинка из SetMenuItemIconArray
    129            SetMenuItemText(gui, item, ws, curitem);
   \                     ??items_menu_iconhndl_1:
   \   00000068   0530A0E1           MOV      R3,R5
   \   0000006C   0620A0E1           MOV      R2,R6
   \   00000070   0710A0E1           MOV      R1,R7
   \   00000074   0400A0E1           MOV      R0,R4
   \   00000078   9A0100EF           SWI      +410
    130          
    131          }
   \   0000007C   F080BDE8           POP      {R4-R7,PC}       ;; return
    132          

   \                                 In segment DATA_C, align 4, align-sorted
    133          static const MENU_DESC items_menu_desc=
   \                     items_menu_desc:
   \   00000000   08000000....       DC32 8, items_menu_onkey, items_menu_ghook, 0H, menusoftkeys, skt, 17
   \              ............
   \              00000000....
   \              ............
   \              11000000    
   \   0000001C   ........0000       DC32 items_menu_iconhndl, 0H, 0H, 0
   \              000000000000
   \              00000000    
    134          {
    135            8,
    136            items_menu_onkey,
    137            items_menu_ghook,
    138            NULL,
    139            menusoftkeys,
    140            &skt,
    141            0x11,
    142            items_menu_iconhndl,
    143            NULL,   //Items
    144            NULL,   //Procs
    145            0   //n
    146          };
    147          
    148          //******************************************************************************
    149          

   \                                 In segment CODE, align 4, keep-with-next
    150          int CreateMainMenu()
    151          {
   \                     CreateMainMenu:
   \   00000000   70402DE9           PUSH     {R4-R6,LR}
    152            void *ma=malloc_adr(); 
    153            void *mf=mfree_adr();
    154            void *gui=GetMenuGUI(ma, mf); 
    155            SetMenuToGUI(gui,&items_menu_desc); 
    156            SetMenuItemCount(gui, 4);
    157            patch_header(&hdr);
   \   00000004   5C609FE5           LDR      R6,??CreateMainMenu_0  ;; hdr
   \   00000008   148000EF           SWI      +32788
   \   0000000C   0040A0E1           MOV      R4,R0
   \   00000010   158000EF           SWI      +32789
   \   00000014   0010A0E1           MOV      R1,R0
   \   00000018   0400A0E1           MOV      R0,R4
   \   0000001C   A40200EF           SWI      +676
   \   00000020   44109FE5           LDR      R1,??CreateMainMenu_0+0x4  ;; items_menu_desc
   \   00000024   0050A0E1           MOV      R5,R0
   \   00000028   A70200EF           SWI      +679
   \   0000002C   0410A0E3           MOV      R1,#+4
   \   00000030   0500A0E1           MOV      R0,R5
   \   00000034   C30100EF           SWI      +451
   \   00000038   0600A0E1           MOV      R0,R6
   \   0000003C   ........           _BLF     patch_header,??patch_header??rA
    158            SetHeaderToMenu(gui,&hdr,ma); 
   \   00000040   0420A0E1           MOV      R2,R4
   \   00000044   0610A0E1           MOV      R1,R6
   \   00000048   0500A0E1           MOV      R0,R5
   \   0000004C   A60200EF           SWI      +678
    159            return csm->mainmenu_gui_id=CreateGUI(gui);
   \   00000050   0500A0E1           MOV      R0,R5
   \   00000054   370100EF           SWI      +311
   \   00000058   ........           LDR      R1,??DataTable3  ;; csm
   \   0000005C   001091E5           LDR      R1,[R1, #+0]
   \   00000060   340081E5           STR      R0,[R1, #+52]
   \   00000064   7080BDE8           POP      {R4-R6,PC}       ;; return
   \                     ??CreateMainMenu_0:
   \   00000068   ........           DC32     hdr
   \   0000006C   ........           DC32     items_menu_desc
    160          }

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable2:
   \   00000000   ........           DC32     percent_t

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable3:
   \   00000000   ........           DC32     csm

   \                                 In segment DATA_ID, align 4, align-sorted
   \                     `?<Initializer for hdr>`:
   \   00000000   000000000000       DC16 0, 0, 0, 0
   \              0000        
   \   00000008   000000000000       DC32 0H, 0, 2147483647
   \              0000FFFFFF7F

   \                                 In segment DATA_ID, align 4, align-sorted
   \                     `?<Initializer for sk>`:
   \   00000000   18000000           DC16 24, 0
   \   00000004   ........           DC32 `?<Constant "\\316\\357\\366\\350\\350">`
   \   00000008   01000000           DC16 1, 0
   \   0000000C   ........           DC32 `?<Constant "\\315\\340\\347\\340\\344">`
   \   00000010   3D000000           DC16 61, 0
   \   00000014   FBC0FF7F           DC32 2147467515

   \                                 In segment DATA_ID, align 4, align-sorted
   \                     `?<Initializer for skt>`:
   \   00000000   ........0000       DC32 sk, 0
   \              0000        

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant "\\316\\357\\366\\350\\350">`:
   \   00000000   CEEFF6E8E800       DC8 "\316\357\366\350\350"
   \   00000006   0000               DC8 0, 0

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant "\\315\\340\\347\\340\\344">`:
   \   00000000   CDE0E7E0E400       DC8 "\315\340\347\340\344"
   \   00000006   0000               DC8 0, 0
    161          
    162          

   Maximum stack usage in bytes:

     Function            CSTACK
     --------            ------
     CreateMainMenu         16
     items_menu_ghook       16
     items_menu_iconhndl    20
     items_menu_onkey        8
     patch_header            8


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     patch_header                     48
     percent_t                        56
     hdr                              20
     hdr_ws                            4
     menusoftkeys                     12
     sk                               24
     skt                               8
     items_menu_onkey                128
     items_menu_ghook                176
     items_menu_iconhndl             128
     items_menu_desc                  44
     CreateMainMenu                  112
     ??DataTable2                      4
     ??DataTable3                      4
     ?<Initializer for hdr>           20
     ?<Initializer for sk>            24
     ?<Initializer for skt>            8
     ?<Constant "\316\357\366\350\350">
                                       8
     ?<Constant "\315\340\347\340\344">
                                       8
      Others                         124

 
 700 bytes in segment CODE
 128 bytes in segment DATA_C
  52 bytes in segment DATA_I
  52 bytes in segment DATA_ID
   4 bytes in segment DATA_Z
  24 bytes in segment INITTAB
 
 552 bytes of CODE  memory (+ 172 bytes shared)
 180 bytes of CONST memory
  56 bytes of DATA  memory

Errors: none
Warnings: none
